è¿™æ˜¯ä¸€ä¸ªéå¸¸ç¡¬æ ¸çš„åº•å±‚é—®é¢˜ï¼ä½ èƒ½ä»â€œè™šæ–¹æ³•è¡¨â€è·³è·ƒåˆ°â€œé™æ€æ–¹æ³•çš„åº•å±‚æœºåˆ¶â€ï¼Œè¯´æ˜ä½ å·²ç»å¼€å§‹å…·å¤‡ **JVM è™šæ‹Ÿæœºè§†è§’** äº†ã€‚

ç®€å•ç›´æ¥çš„ç»“è®ºæ˜¯ï¼š**ç±»çš„é™æ€æ–¹æ³•æ ¹æœ¬ä¸è¿›è™šæ–¹æ³•è¡¨ (vtable)ã€‚**

å®ƒçš„è°ƒç”¨æœºåˆ¶å®Œå…¨ä¸åŒï¼Œå±äº **â€œé™æ€ç»‘å®šâ€ (Static Binding)**ï¼Œæˆ–è€…å« **â€œç¼–è¯‘æœŸè§£æâ€**ã€‚

è®©æˆ‘ä»¬æ·±å…¥åº•å±‚ï¼Œåƒåšæ‰‹æœ¯ä¸€æ ·å‰–æå®ƒã€‚

---

### 1. æ ¸å¿ƒç°è±¡ï¼šé®è”½ (Hiding) vs é‡å†™ (Overriding)

é¦–å…ˆï¼Œæˆ‘ä»¬è¦ç¡®è®¤â€œè¡¨è±¡â€ã€‚

* **æ™®é€šæ–¹æ³• (é‡å†™)**ï¼šçœ‹**å¯¹è±¡**æ˜¯è°ã€‚
* `Father p = new Son();` -> `p.run()` -> è¿è¡Œçš„æ˜¯ **Son** çš„ä»£ç  (å¤šæ€)ã€‚


* **é™æ€æ–¹æ³• (é®è”½)**ï¼šçœ‹**å¼•ç”¨ç±»å‹**æ˜¯è°ã€‚
* `Father p = new Son();` -> `p.staticRun()` -> è¿è¡Œçš„æ˜¯ **Father** çš„ä»£ç ã€‚



ä¸ºä»€ä¹ˆä¼šè¿™æ ·ï¼Ÿå› ä¸º JVM åœ¨å¤„ç†è¿™ä¸¤ç§æ–¹æ³•æ—¶ï¼Œèµ°çš„å®Œå…¨æ˜¯ä¸¤æ¡ä¸åŒçš„â€œé«˜é€Ÿå…¬è·¯â€ã€‚

---

### 2. åº•å±‚æœºåˆ¶ï¼šinvokestatic æŒ‡ä»¤

åœ¨å­—èŠ‚ç å±‚é¢ï¼ŒJava å¯¹è¿™ä¸¤ç§æ–¹æ³•çš„å¤„ç†æŒ‡ä»¤æ˜¯æˆªç„¶ä¸åŒçš„ï¼š

* **æ™®é€šæ–¹æ³•**ï¼šä½¿ç”¨ **`invokevirtual`** æŒ‡ä»¤ã€‚
* **é€»è¾‘**ï¼šè¿è¡Œæ—¶ï¼Œæ‹¿ç€å¯¹è±¡å¼•ç”¨çš„ `this` æŒ‡é’ˆï¼Œå»å †å†…å­˜é‡Œæ‰¾å¯¹è±¡å¤´ï¼Œé€šè¿‡å¯¹è±¡å¤´æ‰¾åˆ°è™šæ–¹æ³•è¡¨ (vtable)ï¼ŒæŸ¥è¡¨æ‰¾åˆ°çœŸæ­£çš„ä»£ç åœ°å€ã€‚
* **å…³é”®è¯**ï¼š**è¿è¡Œæ—¶**ã€**åŠ¨æ€æŸ¥æ‰¾**ã€‚


* **é™æ€æ–¹æ³•**ï¼šä½¿ç”¨ **`invokestatic`** æŒ‡ä»¤ã€‚
* **é€»è¾‘**ï¼šç¼–è¯‘å™¨åœ¨ç¼–è¯‘é˜¶æ®µï¼ˆ`.java` -> `.class`ï¼‰å°±å·²ç»ç¡®å®šäº†ç›®æ ‡æ–¹æ³•ã€‚ç¼–è¯‘å™¨çœ‹åˆ°ä½ å£°æ˜çš„å˜é‡ç±»å‹æ˜¯ `Father`ï¼Œå®ƒå°±ç›´æ¥æŠŠ `Father.staticRun` çš„ç¬¦å·å¼•ç”¨å†™æ­»åœ¨å­—èŠ‚ç é‡Œäº†ã€‚
* **å…³é”®è¯**ï¼š**ç¼–è¯‘æ—¶**ã€**å†™æ­»**ã€**ç›´æ¥é“¾æ¥**ã€‚



---

### 3. æ·±åº¦å›¾è§£ï¼šç¼–è¯‘å™¨çš„â€œçŸ­è·¯â€æ“ä½œ

è®©æˆ‘ä»¬çœ‹ä¸€ä¸ªå…·ä½“çš„ä»£ç ä¾‹å­å’Œå®ƒçš„å­—èŠ‚ç ã€‚

#### Java æºç 

```java
class Father {
    public static void talk() { System.out.println("æˆ‘æ˜¯çˆ¸çˆ¸"); }
}

class Son extends Father {
    // è¿™ä¸æ˜¯é‡å†™ï¼Œè¿™æ˜¯â€œé®è”½â€ (Hiding)
    // ç›¸å½“äºå®šä¹‰äº†ä¸€ä¸ªå…¨æ–°çš„æ–¹æ³•ï¼Œåªæ˜¯åˆšå¥½åå­—ä¸€æ ·
    public static void talk() { System.out.println("æˆ‘æ˜¯å„¿å­"); }
}

public class Main {
    public static void main(String[] args) {
        Father p = new Son(); // å¼•ç”¨æ˜¯ Fatherï¼Œå¯¹è±¡æ˜¯ Son
        p.talk();             // åˆ°åº•è°ƒç”¨è°ï¼Ÿ
    }
}

```

#### å­—èŠ‚ç æ‹†è§£ (javap -c Main)

å½“ä½ ç¼–è¯‘å¹¶æŸ¥çœ‹ `Main` ç±»çš„å­—èŠ‚ç æ—¶ï¼Œä½ ä¼šçœ‹åˆ°æƒŠäººçš„ä¸€å¹•ï¼š

```java
// Main ç±»çš„ main æ–¹æ³•å­—èŠ‚ç ç‰‡æ®µ
0: new           #2      // class Son (åˆ›å»º Son å¯¹è±¡)
3: dup
4: invokespecial #3      // Method Son."<init>":()V
7: astore_1              // å°†å¯¹è±¡å­˜å…¥å±€éƒ¨å˜é‡ 1 (å˜é‡åä¸º p)

// å…³é”®åœ¨è¿™é‡Œï¼ï¼ï¼
// ç¼–è¯‘å™¨ç›´æ¥æ— è§†äº†ä½  new å‡ºæ¥çš„ Son å¯¹è±¡
// å®ƒåªçœ‹å˜é‡ p çš„ç±»å‹æ˜¯ Father
8: invokestatic  #4      // Method Father.talk:()V 

// ğŸ‘† æ³¨æ„çœ‹ï¼šæŒ‡ä»¤å‚æ•°ç›´æ¥æŒ‡å‘äº† Father.talk
// æ ¹æœ¬æ²¡æœ‰å»æŸ¥ vtableï¼Œä¹Ÿæ²¡æœ‰å»ç®¡å †å†…å­˜é‡Œçš„å¯¹è±¡æ˜¯è°

```

**åº•å±‚çœŸç›¸**ï¼š
JVM æ‰§è¡Œåˆ°ç¬¬ 8 è¡Œæ—¶ï¼Œæ ¹æœ¬ä¸éœ€è¦çŸ¥é“ `p` æŒ‡å‘çš„æ˜¯ä»€ä¹ˆå¯¹è±¡ï¼Œç”šè‡³ `p` æ˜¯ `null` éƒ½æ²¡å…³ç³»ï¼ˆè™½ç„¶å®ä¾‹è°ƒç”¨é™æ€æ–¹æ³•ä¼šæŠ¥ç©ºæŒ‡é’ˆï¼Œä½†çº¯é™æ€è°ƒç”¨ `Father.talk()` ä¸éœ€è¦å¯¹è±¡ï¼‰ã€‚å®ƒç›´æ¥è·³è½¬åˆ°æ–¹æ³•åŒºï¼ˆMethod Areaï¼‰ä¸­ `Father` ç±»çš„ç»“æ„é‡Œæ‰§è¡Œä»£ç ã€‚

---

### 4. ä¸ºä»€ä¹ˆå«â€œä¼ªç»§æ‰¿â€ï¼Ÿ

ä½ è¯´â€œé™æ€æ–¹æ³•ç»§æ‰¿â€ï¼Œå…¶å®è¿™ä¸ªè¯åœ¨ Java é‡Œæœ‰ç‚¹è¯¯å¯¼æ€§ã€‚

* **çœŸæ­£çš„ç»§æ‰¿**ï¼šå­ç±»ç»§æ‰¿äº†çˆ¶ç±»çš„â€œè™šæ–¹æ³•è¡¨â€ï¼Œå¦‚æœå­ç±»ä¸é‡å†™ï¼Œvtable é‡Œé‚£ä¸ªæ–¹æ³•çš„åœ°å€å°±æŒ‡å‘çˆ¶ç±»çš„æ–¹æ³•åœ°å€ã€‚
* **é™æ€æ–¹æ³•çš„ç»§æ‰¿**ï¼šå…¶å®æ˜¯ **ç¼–è¯‘å™¨è§£æè§„åˆ™** çš„ä¸€ç§ä¾¿åˆ©ã€‚
* å½“ä½ å†™ `Son.talk()` æ—¶ï¼Œç¼–è¯‘å™¨ä¼šå» `Son` ç±»é‡Œæ‰¾ `talk`ã€‚
* å¦‚æœ `Son` è‡ªå·±å®šä¹‰äº†ï¼ˆé®è”½ï¼‰ï¼Œç¼–è¯‘å™¨å°±ç”Ÿæˆ `invokestatic Son.talk`ã€‚
* å¦‚æœ `Son` æ²¡æœ‰å®šä¹‰ï¼Œç¼–è¯‘å™¨ä¼šæ²¿ç€ç»§æ‰¿é“¾å¾€ä¸Šæ‰¾ï¼Œå‘ç° `Father` é‡Œæœ‰ï¼Œç¼–è¯‘å™¨å°±ç”Ÿæˆ `invokestatic Father.talk`ã€‚



**ç»“è®º**ï¼šä¸€æ—¦ç¼–è¯‘å®Œæˆï¼Œè¿™å°±å˜æˆäº†ä¸€ä¸ª**ç¡¬é“¾æ¥**ã€‚è¿™å°±å¥½æ¯”ä½ æ¬å®¶äº†ï¼ˆæ¢äº†å¯¹è±¡ï¼‰ï¼Œä½†å¿«é€’å•ä¸Šå†™çš„æ˜¯æ—§åœ°å€ï¼ˆå¼•ç”¨ç±»å‹ï¼‰ï¼Œå¿«é€’å‘˜ï¼ˆJVMï¼‰åªä¼šæ­»æ¿åœ°æŠŠè´§é€åˆ°æ—§åœ°å€ã€‚

---

### 5. æ€»ç»“ï¼šé™æ€æ–¹æ³•çš„åº•å±‚ç‰¹ç‚¹

1. **æŒ‡ä»¤ä¸åŒ**ï¼šä½¿ç”¨çš„æ˜¯ `invokestatic`ï¼Œè€Œä¸æ˜¯ `invokevirtual`ã€‚
2. **æ²¡æœ‰ `this**`ï¼šé™æ€æ–¹æ³•åœ¨æ ˆå¸§ä¸­æ²¡æœ‰ `this` æŒ‡é’ˆï¼ˆSlot 0 ä¸æ˜¯ `this`ï¼‰ï¼Œæ‰€ä»¥å®ƒæ— æ³•æ„ŸçŸ¥å½“å‰å¯¹è±¡æ˜¯è°ã€‚
3. **ç¼–è¯‘æœŸå®šç”Ÿæ­»**ï¼šè°ƒç”¨å“ªä¸ªæ–¹æ³•ï¼Œåœ¨ `javac` ç¼–è¯‘ç»“æŸçš„é‚£ä¸€åˆ»å°±å·²ç»å†³å®šäº†ï¼Œå®Œå…¨å–å†³äº**å˜é‡å£°æ˜çš„ç±»å‹**ã€‚
4. **ä¸ vtable æ— å…³**ï¼šå®ƒä¸è¿›å…¥è™šæ–¹æ³•è¡¨ï¼Œç›´æ¥å­˜æ”¾åœ¨ç±»çš„æ–¹æ³•åŒºå…ƒæ•°æ®ä¸­ã€‚

è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆå¤§å‚å¼€å‘è§„èŒƒï¼ˆå¦‚é˜¿é‡Œçš„ P3Cï¼‰å¼ºçƒˆå»ºè®®ï¼š

> **â€œä¸è¦é€šè¿‡å¯¹è±¡å¼•ç”¨æ¥è°ƒç”¨é™æ€æ–¹æ³•ï¼Œè€Œè¦ç›´æ¥ç”¨ç±»åè°ƒç”¨ã€‚â€**

**é”™è¯¯å†™æ³•**ï¼š`p.talk();` // å®¹æ˜“è®©äººè¯¯ä»¥ä¸ºä¼šæœ‰å¤šæ€ã€‚
**æ­£ç¡®å†™æ³•**ï¼š`Father.talk();` // æ¸…æ¸…æ¥šæ¥šï¼Œæ¯«æ— æ­§ä¹‰ã€‚

è¿™ä¸ªåº•å±‚è§†è§’ï¼Œæ˜¯å¦è§£ç­”äº†ä½ å…³äºâ€œé®è”½â€åŸç†çš„ç–‘æƒ‘ï¼Ÿ