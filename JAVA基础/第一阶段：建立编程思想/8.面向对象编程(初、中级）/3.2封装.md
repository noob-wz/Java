å¦‚æœè¯´ **è®¿é—®ä¿®é¥°ç¬¦** æ˜¯é”ï¼Œé‚£ä¹ˆ **å°è£…** å°±æ˜¯æˆ‘ä»¬ç²¾å¿ƒå»ºé€ çš„ **"å®‰å…¨å ¡å’"**ã€‚

å¾ˆå¤šåˆå­¦è€…è®¤ä¸ºå°è£…å°±æ˜¯ "æŠŠå˜é‡æ”¹æˆ privateï¼Œç„¶åè‡ªåŠ¨ç”Ÿæˆ Getter/Setter"ã€‚**è¿™æ˜¯å¤§é”™ç‰¹é”™çš„ï¼** çœŸæ­£çš„å·¥ç¨‹åŒ–å°è£…ï¼Œæ˜¯ä¸ºäº†**ä¿æŠ¤å¯¹è±¡çš„å°Šä¸¥**â€”â€”ç»ä¸å…è®¸è®©å¯¹è±¡å¤„äº"ä¸åˆæ³•"çš„çŠ¶æ€ã€‚

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

## ç¬¬1éƒ¨åˆ†ï¼šå»ºç«‹è®¤çŸ¥ï¼ˆWhat & Whyï¼‰

### ğŸ“¦ 1.1 ä»€ä¹ˆæ˜¯å°è£…ï¼Ÿ

**æ ¸å¿ƒå®šä¹‰**ï¼šå°è£…æ˜¯å°†å¯¹è±¡çš„**çŠ¶æ€ä¿¡æ¯ï¼ˆæ•°æ®ï¼‰éšè—åœ¨å¯¹è±¡å†…éƒ¨**ï¼Œä¸å…è®¸å¤–éƒ¨ç›´æ¥è®¿é—®ï¼Œè€Œæ˜¯é€šè¿‡è¯¥ç±»æä¾›çš„ **å…¬å¼€æ–¹æ³•ï¼ˆæ¥å£ï¼‰** æ¥å®ç°å¯¹å†…éƒ¨ä¿¡æ¯çš„æ“ä½œå’Œè®¿é—®ã€‚

ä½ å¯ä»¥æŠŠå®ƒæƒ³è±¡æˆä¸€é¢— **èƒ¶å›Š (Capsule)**ï¼š

* **å¤–å£³ (Public Methods)**ï¼šå…‰æ»‘ã€å®‰å…¨ï¼Œå…è®¸ä½ åå’½ï¼ˆè°ƒç”¨ï¼‰ã€‚
* **è¯ç²‰ (Private Fields)**ï¼šè‹¦æ¶©ã€å¤æ‚ã€åŒ–å­¦æˆåˆ†ä¸ç¨³å®šã€‚å¦‚æœæŠŠè¯ç²‰ç›´æ¥å€’åœ¨ä½ å˜´é‡Œï¼ˆç›´æ¥è®¿é—®å˜é‡ï¼‰ï¼Œå¯èƒ½ä¼šå‡ºå¤§é—®é¢˜ã€‚

### ğŸ’¡ 1.2 ä¸ºä»€ä¹ˆè¦å°è£…ï¼Ÿ

æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ª **"æ²¡æœ‰å°è£…"** çš„è£¸å¥”ä¸–ç•Œï¼š

```java
// âŒ è£¸å¥”çš„ä»£ç 
class User {
    public int age; // ä»»ä½•äººéƒ½èƒ½æ”¹
}

User u = new User();
u.age = -1000; // ğŸ˜± å®Œäº†ï¼å¹´é¾„å˜æˆè´Ÿæ•°äº†ï¼Œä¸šåŠ¡é€»è¾‘å´©å¡Œï¼

```

**å°è£…å¸¦æ¥çš„æ”¶ç›Š**ï¼š

1. **å®‰å…¨æ€§ (Safety)**ï¼šé˜²æ­¢æ•°æ®è¢«è®¾ç½®æˆéæ³•å€¼ï¼ˆæ¯”å¦‚å¹´é¾„ -100ï¼‰ã€‚
2. **å¯ç»´æŠ¤æ€§ (Maintainability)**ï¼šå¦‚æœæˆ‘æƒ³æŠŠ `age` çš„åº•å±‚å­˜å‚¨ä» `int` æ”¹æˆ `String`ï¼Œåªè¦æˆ‘ä¸æ”¹å…¬å¼€æ–¹æ³•çš„ç­¾åï¼Œè°ƒç”¨è€…æ ¹æœ¬ä¸éœ€è¦çŸ¥é“ï¼Œä¹Ÿä¸ä¼šæŠ¥é”™ã€‚

---

## ç¬¬2éƒ¨åˆ†ï¼šå·¥ç¨‹å®è·µï¼ˆHow to Do Rightï¼‰

### âœ… 2.1 æ ‡å‡†å†™æ³•ï¼šå®ˆé—¨å‘˜æœºåˆ¶ *ğŸ’¡ æ ¸å¿ƒå¿…å­¦*

æˆ‘ä»¬ç”¨å°è£…æ¥ä¿®å¤ä¸Šé¢çš„ `User` ç±»ã€‚

**æ ¸å¿ƒå…¬å¼**ï¼š

> **Private å­—æ®µ + Public æ–¹æ³• (å¸¦æ ¡éªŒé€»è¾‘)**

```java
public class User {
    // 1. å…³é—¨ï¼šæ‰€æœ‰å±æ€§å¿…é¡»ç§æœ‰
    private int age;

    // 2. å¼€çª—ï¼šæä¾› Setter æ–¹æ³•
    public void setAge(int age) {
        // ğŸ”¥ æ ¸å¿ƒä»·å€¼ï¼šåœ¨è¿™é‡Œè¿›è¡Œ"å®‰æ£€"
        if (age < 0 || age > 150) {
            throw new IllegalArgumentException("å¹´é¾„ä¸åˆæ³•: " + age);
        }
        this.age = age;
    }

    // 3. å¼€çª—ï¼šæä¾› Getter æ–¹æ³•
    public int getAge() {
        return this.age;
    }
}

```

**ç°åœ¨å†è¯•è¯•ç ´åå®ƒï¼Ÿ**

```java
User u = new User();
u.setAge(-1000); // ğŸ’¥ æŠ¥é”™ï¼IllegalArgumentException
// å¯¹è±¡çš„çŠ¶æ€ä¾ç„¶æ˜¯å®‰å…¨çš„ï¼ˆé»˜è®¤å€¼ 0ï¼‰ï¼Œæ²¡æœ‰è¢«æ±¡æŸ“ã€‚

```

---

## ç¬¬3éƒ¨åˆ†ï¼šé¿å‘è¿›é˜¶ï¼ˆWhat to Avoidï¼‰

è¿™æ˜¯ä»"ç å†œ"è¿›é˜¶åˆ°"å·¥ç¨‹å¸ˆ"çš„å…³é”®ä¸€æ­¥ã€‚è¯·ä»”ç»†é˜…è¯»ä»¥ä¸‹ä¸¤ä¸ªé™·é˜±ã€‚

### âš ï¸ 3.1 é™·é˜±ä¸€ï¼šæ— è„‘ Getter/Setter

**ç°è±¡**ï¼šå¾ˆå¤š IDE æä¾›"ä¸€é”®ç”Ÿæˆæ‰€æœ‰ Getter/Setter"çš„åŠŸèƒ½ã€‚
**é—®é¢˜**ï¼šå¦‚æœä½ ç»™æ‰€æœ‰å­—æ®µéƒ½åŠ äº† `public setXXX()`ï¼Œé‚£ä½ è™½ç„¶å†™äº† `private`ï¼Œä½†å®é™…ä¸Šå’Œ `public` è£¸å¥”æ²¡æœ‰ä»»ä½•åŒºåˆ«ï¼ä½ ä¾ç„¶æŠŠä¿®æ”¹æƒäº¤ç»™äº†å…¨ä¸–ç•Œã€‚

**å·¥ç¨‹åŸåˆ™**ï¼š

* **æŒ‰éœ€å¼€æ”¾**ï¼šåªæä¾›çœŸæ­£éœ€è¦ä¿®æ”¹çš„æ–¹æ³•ã€‚
* **åªè¯»å±æ€§**ï¼šå¦‚æœä¸€ä¸ªå±æ€§åˆå§‹åŒ–åå°±ä¸è¯¥å˜ï¼ˆæ¯”å¦‚ `id`ï¼‰ï¼Œ**åªç»™ Getterï¼Œä¸ç»™ Setter**ã€‚

```java
public class Order {
    private String orderId;
    private String status;

    // æ„é€ å™¨åˆå§‹åŒ– ID
    public Order(String orderId) {
        this.orderId = orderId;
        this.status = "CREATED";
    }

    // âœ… åªè¯»ï¼šID æ°¸è¿œä¸èƒ½æ”¹ï¼Œæ‰€ä»¥ä¸æä¾› setOrderId()
    public String getOrderId() {
        return orderId;
    }

    // âœ… ä¸šåŠ¡æ–¹æ³•ï¼šä¸è¦ç›´æ¥ç”¨ setStatusï¼Œè€Œæ˜¯ç”¨æœ‰ä¸šåŠ¡å«ä¹‰çš„æ–¹æ³•
    public void pay() {
        this.status = "PAID"; // å†…éƒ¨ä¿®æ”¹çŠ¶æ€
    }
}

```

---

### â˜ ï¸ 3.2 é™·é˜±äºŒï¼šå¼•ç”¨ç±»å‹æ³„éœ² (The Escaping Reference) *ğŸ”¥ é«˜é¢‘é¢è¯•é¢˜*

è¿™æ˜¯å°è£…æœ€å®¹æ˜“å¤±æ•ˆçš„åœ°æ–¹ã€‚å³ä½¿ä½ ç”¨äº† `private` å’Œ `getter`ï¼Œå¦‚æœå­—æ®µæ˜¯**å¼•ç”¨ç±»å‹**ï¼ˆå¦‚ `List`, `Date`, `Array`ï¼‰ï¼Œä¾ç„¶å¯èƒ½è¢«å¤–éƒ¨ä¿®æ”¹ã€‚

**é”™è¯¯ç¤ºèŒƒ**ï¼š

```java
public class Team {
    private List<String> members = new ArrayList<>();

    // âŒ å±é™©çš„ Getter
    public List<String> getMembers() {
        return members; // ç›´æ¥æŠŠè‡ªå®¶çš„é’¥åŒ™ï¼ˆå¼•ç”¨ï¼‰ç»™äº†åˆ«äººï¼
    }
}

// æ”»å‡»æ¼”ç¤º
Team team = new Team();
List<String> list = team.getMembers();
list.clear(); // ğŸ˜± å¤–éƒ¨çš„äººæŠŠ Team å†…éƒ¨çš„æ•°æ®æ¸…ç©ºäº†ï¼å°è£…å¤±æ•ˆï¼

```

**âœ… æ­£ç¡®åšæ³•ï¼šé˜²å¾¡æ€§å¤åˆ¶ (Defensive Copy)**

```java
public List<String> getMembers() {
    // è¿”å›ä¸€ä¸ªæ–°çš„ Listï¼ˆå‰¯æœ¬ï¼‰ï¼Œæˆ–è€…æ˜¯ä¸å¯ä¿®æ”¹çš„è§†å›¾
    // åˆ«äººéšä¾¿æ”¹å‰¯æœ¬ï¼Œä¸å½±å“æˆ‘å†…éƒ¨çš„æ•°æ®
    return new ArrayList<>(this.members); 
    // æˆ–è€…
    // return Collections.unmodifiableList(this.members);
}

```

---

### ğŸ“ å®æˆ˜æŒ‘æˆ˜

è¯·æ£€æŸ¥ä¸‹é¢è¿™æ®µä»£ç ï¼Œå®ƒæƒ³å°è£…ä¸€ä¸ª `Wallet`ï¼ˆé’±åŒ…ï¼‰ç±»ã€‚
è¯·æ‰¾å‡º **2 ä¸ª** ç ´åå°è£…æ€§çš„ä¸¥é‡é—®é¢˜ã€‚

```java
public class Wallet {
    private double balance;
    public double[] transactionHistory; // äº¤æ˜“è®°å½•æ•°ç»„

    public void setBalance(double balance) {
        this.balance = balance;
    }
}

```

ğŸ‘‰ **å›å¤ä½ çš„åˆ†æ**ï¼Œæˆ‘ä¼šå‘Šè¯‰ä½ å¦‚ä½•è®¾è®¡ä¸€ä¸ªæ»´æ°´ä¸æ¼çš„é‡‘èçº§å¯¹è±¡ã€‚

**å›ç­”ï¼š**     
ï¼ˆ1ï¼‰setBalanceæ²¡æœ‰è®¾ç½®æ ¡éªŒé€»è¾‘ï¼›      
ï¼ˆ2ï¼‰transactionHistoryæ˜¯publicçš„æ•°ç»„ï¼Œæ„å‘³ç€ä»»ä½•äººéƒ½å¯ä»¥è¿›è¡Œä¿®æ”¹

---

å®Œå…¨æ­£ç¡®ï¼ğŸ’¯

ä½ éå¸¸æ•é”åœ°æŠ“ä½äº†å°è£…çš„ä¸¤ä¸ªæ ¸å¿ƒæ­»ç©´ï¼š**ã€Œä¸šåŠ¡é€»è¾‘ç¼ºå¤±ã€** å’Œ **ã€Œå¼•ç”¨æ³„éœ²ã€**ã€‚

1. **å…³äº Balance**ï¼šä½™é¢æ˜¯è®¡ç®—å‡ºæ¥çš„ç»“æœï¼ˆå……å€¼ - æ¶ˆè´¹ï¼‰ï¼Œç»ä¸èƒ½æä¾›ç›´æ¥çš„ `set` æ–¹æ³•è®©å¤–éƒ¨éšæ„ç¯¡æ”¹ã€‚å¦åˆ™é»‘å®¢å¯ä»¥ç›´æ¥ `setBalance(99999999)`ï¼Œç¬é—´é¦–å¯Œã€‚
2. **å…³äº æ•°ç»„ Public**ï¼šè¿™æ˜¯æœ€ä¸¥é‡çš„æ¼æ´ã€‚ä»»ä½•äººéƒ½å¯ä»¥åœ¨å¤–éƒ¨æ‰§è¡Œ `wallet.transactionHistory[0] = 0`ï¼Œç”šè‡³ `wallet.transactionHistory = null`ï¼Œä½ çš„äº¤æ˜“æ—¥å¿—ç¬é—´å°±è¢«æŠ¹é™¤æˆ–ç¯¡æ”¹äº†ã€‚

---

### ğŸ›¡ï¸ é‡‘èçº§ä»£ç é‡æ„

è®©æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•æŠŠè¿™ä¸ªæ¼æ´ç™¾å‡ºçš„ `Wallet` å˜æˆä¸€ä¸ªæ»´æ°´ä¸æ¼çš„**é‡‘èçº§å¯¹è±¡**ã€‚

**è®¾è®¡æ€è·¯**ï¼š

1. **åªè¿›ä¸å‡º**ï¼šä¸æä¾› `setBalance`ï¼Œåªæä¾› `deposit`ï¼ˆå­˜ï¼‰å’Œ `withdraw`ï¼ˆå–ï¼‰æ–¹æ³•ã€‚
2. **é˜²å¾¡æ€§å¤åˆ¶**ï¼šå¯¹äºæ•°ç»„/é›†åˆï¼Œgetter å¿…é¡»è¿”å›å‰¯æœ¬ã€‚
3. **ä¸å¯å˜æ€§**ï¼šäº¤æ˜“è®°å½•ä¸€æ—¦äº§ç”Ÿï¼Œå°±ä¸åº”è¯¥èƒ½è¢«ä¿®æ”¹ã€‚

```java
import java.util.Arrays;

public class SecureWallet {
    // 1. ç§æœ‰åŒ–ï¼šå¿…é¡» private
    private double balance;
    private double[] history; 

    public SecureWallet() {
        this.balance = 0.0;
        this.history = new double[0];
    }

    // 2. æ‹’ç» setBalanceï¼Œæ”¹ç”¨ä¸šåŠ¡æ–¹æ³•
    public void deposit(double amount) {
        if (amount <= 0) {
            throw new IllegalArgumentException("å­˜æ¬¾é‡‘é¢å¿…é¡»å¤§äº0");
        }
        this.balance += amount;
        addHistory(amount);
    }

    public void withdraw(double amount) {
        if (amount <= 0 || amount > this.balance) {
            throw new IllegalArgumentException("ä½™é¢ä¸è¶³æˆ–é‡‘é¢éæ³•");
        }
        this.balance -= amount;
        addHistory(-amount);
    }

    // å†…éƒ¨è¾…åŠ©æ–¹æ³•ï¼šè®°å½•æµæ°´ (æ‰©å®¹å¹¶æ·»åŠ )
    private void addHistory(double amount) {
        // æ•°ç»„æ‰©å®¹ï¼šåˆ›å»ºä¸€ä¸ªå¤§ä¸€å·çš„æ–°æ•°ç»„
        double[] newHistory = Arrays.copyOf(this.history, this.history.length + 1);
        newHistory[this.history.length] = amount;
        this.history = newHistory;
    }

    // âœ… å®‰å…¨çš„ Getterï¼šåªè¯»
    public double getBalance() {
        return this.balance;
    }

    // âœ… é˜²å¾¡æ€§å¤åˆ¶ï¼šè¿™æ˜¯é˜²æ­¢å¼•ç”¨æ³„éœ²çš„å…³é”®ï¼
    // å¤–éƒ¨æ‹¿åˆ°çš„æ˜¯ä¸€ä»½å¤å°ä»¶ï¼Œä»–åœ¨å¤å°ä»¶ä¸Šä¹±æ¶‚ä¹±ç”»ï¼Œä¸å½±å“æˆ‘åŸä»¶ã€‚
    public double[] getHistory() {
        if (this.history == null) return new double[0];
        // è¿”å›ä¸€ä¸ªå…¨æ–°çš„æ•°ç»„å¯¹è±¡ï¼Œå†…å®¹æ‹·è´è¿‡å»
        return Arrays.copyOf(this.history, this.history.length);
    }
}

```

**ä»£ç è§£æ**ï¼š

* å½“è°ƒç”¨ `getHistory()` æ—¶ï¼ŒJVM åœ¨å †å†…å­˜ä¸­å¼€è¾Ÿäº†ä¸€å—**æ–°åŒºåŸŸ**ï¼ŒæŠŠæ•°æ®å¤åˆ¶è¿‡å»ï¼Œç„¶åæŠŠ**æ–°åŒºåŸŸçš„åœ°å€**ç»™äº†è°ƒç”¨è€…ã€‚
* è¿™æ ·ï¼Œå¤–éƒ¨æ€ä¹ˆä¿®æ”¹è¿™ä¸ªè¿”å›çš„æ•°ç»„ï¼Œéƒ½ä¼¤ä¸åˆ° `SecureWallet` å†…éƒ¨çœŸæ­£çš„ `history`ã€‚
