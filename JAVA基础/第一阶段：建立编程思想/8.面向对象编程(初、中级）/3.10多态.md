å¤šæ€æ˜¯é¢å‘å¯¹è±¡ç¼–ç¨‹ï¼ˆOOPï¼‰çš„çµé­‚ã€‚ç®€å•æ¥è¯´ï¼Œå®ƒçš„æ ¸å¿ƒä»·å€¼åœ¨äºï¼š**è®©åŒä¸€ä¸ªæ“ä½œä½œç”¨äºä¸åŒçš„å¯¹è±¡æ—¶ï¼Œäº§ç”Ÿä¸åŒçš„æ‰§è¡Œç»“æœã€‚**

## ç¬¬1éƒ¨åˆ†ï¼šå»ºç«‹è®¤çŸ¥ï¼ˆWhat & Whyï¼‰

### ğŸ“¦ 1.1 æ ¸å¿ƒè¯­æ³• *ğŸ’¡ æ ¸å¿ƒå¿…å­¦*

**ç›®æ ‡**ï¼šæŒæ¡å¤šæ€çš„ä¸‰å¤§å¿…è¦æ¡ä»¶â€”â€”**ç»§æ‰¿**ã€**é‡å†™**ã€**å‘ä¸Šè½¬å‹**ã€‚

å¤šæ€çš„å®ç°ä¾èµ–äºçˆ¶ç±»ï¼ˆæˆ–æ¥å£ï¼‰å¼•ç”¨æŒ‡å‘å­ç±»å¯¹è±¡ã€‚

```java
// 1. å®šä¹‰çˆ¶ç±»ï¼ˆæˆ–æ¥å£ï¼‰
// è¿™æ˜¯ä¸€ä¸ªæ™®é€šç±»ï¼Œå®šä¹‰äº†é€šç”¨çš„è¡Œä¸º
class Animal {
    // å…è®¸è¢«å­ç±»ä¿®æ”¹çš„æ–¹æ³•
    public void makeSound() {
        System.out.println("åŠ¨ç‰©å‘å‡ºæŸç§å£°éŸ³...");
    }
}

// 2. å®šä¹‰å­ç±»å¹¶ã€ç»§æ‰¿ã€‘
class Cat extends Animal {
    // 3. ã€é‡å†™ã€‘çˆ¶ç±»æ–¹æ³•
    // @Override æ˜¯æ³¨è§£ï¼ˆè¯¦è§1.2èŠ‚ï¼‰ï¼Œç”¨äºç¡®ä¿ä½ çœŸçš„åœ¨é‡å†™ï¼Œè€Œä¸æ˜¯å†™é”™äº†åå­—
    @Override
    public void makeSound() {
        System.out.println("å–µå–µå–µ");
    }
}

class Dog extends Animal {
    @Override
    public void makeSound() {
        System.out.println("æ±ªæ±ªæ±ª");
    }
}

public class PolymorphismDemo {
    public static void main(String[] args) {
        // 4. ã€å‘ä¸Šè½¬å‹ã€‘ (Upcasting)
        // è¯­æ³•é“å¾‹ï¼šçˆ¶ç±»å¼•ç”¨ = new å­ç±»å¯¹è±¡();
        Animal myPet = new Cat(); 
        
        // å…³é”®ç‚¹ï¼š
        // ç¼–è¯‘æ—¶çœ‹å·¦è¾¹ (Animal æœ‰æ²¡æœ‰ makeSound æ–¹æ³•ï¼Ÿæœ‰ï¼Œç¼–è¯‘é€šè¿‡)
        // è¿è¡Œæ—¶çœ‹å³è¾¹ (å®é™…å¯¹è±¡æ˜¯ Catï¼Œæ‰§è¡Œ Cat çš„é€»è¾‘)
        myPet.makeSound(); // è¾“å‡ºï¼šå–µå–µå–µ
    }
}

```

---

### ğŸ”— 1.2 å…³è”æ¦‚å¿µ *ğŸ’¡ æ ¸å¿ƒå¿…å­¦*

åœ¨ä½¿ç”¨å¤šæ€æ—¶ï¼Œå¿…é¡»ç†è§£ä»¥ä¸‹æ¦‚å¿µï¼š

**1. å‘ä¸Šè½¬å‹ (Upcasting)**

* **å®šä¹‰**ï¼šå°†å­ç±»å¯¹è±¡èµ‹å€¼ç»™çˆ¶ç±»å¼•ç”¨ã€‚
* **ç¼–è¯‘å™¨çš„éšå¼è¡Œä¸º**ï¼šç¼–è¯‘å™¨ä¼šè‡ªåŠ¨å¤„ç†ï¼Œæ— éœ€å¼ºåˆ¶è½¬æ¢ã€‚å› ä¸ºçŒ«ï¼ˆCatï¼‰ä¸€å®šæ˜¯åŠ¨ç‰©ï¼ˆAnimalï¼‰ï¼Œè¿™æ˜¯å®‰å…¨çš„ã€‚
* **é™åˆ¶**ï¼šä¸€æ—¦è½¬å‹ä¸ºçˆ¶ç±»å¼•ç”¨ï¼Œå°±**ä¸èƒ½**è°ƒç”¨å­ç±»ç‰¹æœ‰çš„æ–¹æ³•äº†ï¼ˆé™¤éå‘ä¸‹è½¬å‹ï¼Œè¯¦è§é˜¶æ®µ2ï¼‰ã€‚

**2. æ–¹æ³•é‡å†™ (Overriding)**

* **å…³é”®å­—**ï¼š`@Override`
* **ä½œç”¨**ï¼šå‘Šè¯‰ç¼–è¯‘å™¨â€œæˆ‘è¦è¦†ç›–çˆ¶ç±»çš„è¿™ä¸ªæ–¹æ³•â€ã€‚
* **è§„åˆ™**ï¼šæ–¹æ³•åã€å‚æ•°åˆ—è¡¨ã€è¿”å›ç±»å‹å¿…é¡»ä¸çˆ¶ç±»ä¸€è‡´ï¼ˆæˆ–å…¼å®¹ï¼‰ã€‚
* **ä¸ºä»€ä¹ˆéœ€è¦å®ƒ**ï¼šå¦‚æœæ²¡æœ‰é‡å†™ï¼Œå¤šæ€å°±å¤±å»äº†æ„ä¹‰ï¼ˆè°ƒç”¨çš„æ°¸è¿œæ˜¯çˆ¶ç±»çš„é€šç”¨é€»è¾‘ï¼‰ã€‚

**3. åŠ¨æ€ç»‘å®š (Dynamic Binding)**

* **åº•å±‚æœºåˆ¶**ï¼šJava åœ¨**è¿è¡ŒæœŸé—´**ï¼ˆRuntimeï¼‰æ‰å†³å®šè°ƒç”¨å“ªä¸ªå¯¹è±¡çš„æ–¹æ³•ï¼Œè€Œä¸æ˜¯åœ¨ç¼–è¯‘æœŸé—´ã€‚è¿™æ˜¯å¤šæ€ç”Ÿæ•ˆçš„ç‰©ç†åŸºç¡€ã€‚

---

### ğŸš€ 1.3 å¿«é€Ÿä¸Šæ‰‹ *ğŸ’¡ æ ¸å¿ƒå¿…å­¦*

**ç›®æ ‡**ï¼šç”¨ä¸€ä¸ªæ•°ç»„ç®¡ç†ä¸åŒå¯¹è±¡ï¼Œä½“éªŒâ€œç»Ÿä¸€è°ƒç”¨â€ã€‚

```java
public class ZooParty {
    public static void main(String[] args) {
        // åˆ›å»ºä¸€ä¸ªåŠ¨ç‰©åˆ—è¡¨ï¼ˆæ•°ç»„ç±»å‹æ˜¯çˆ¶ç±» Animalï¼‰
        Animal[] animals = new Animal[3];
        
        // æ”¾å…¥ä¸åŒçš„å­ç±»å¯¹è±¡ï¼ˆå‘ä¸Šè½¬å‹ï¼‰
        animals[0] = new Dog();
        animals[1] = new Cat();
        animals[2] = new Dog();
        
        System.out.println("=== åŠ¨ç‰©å›­å¼€é¥­äº† ===");
        
        // éå†åˆ—è¡¨ï¼Œç»Ÿä¸€è°ƒç”¨ makeSound()
        // æˆ‘ä»¬ä¸éœ€è¦çŸ¥é“å®ƒæ˜¯çŒ«è¿˜æ˜¯ç‹—ï¼Œåªéœ€è¦æŠŠå®ƒå½“åš "Animal" å¯¹å¾…
        for (Animal a : animals) {
            a.makeSound(); 
        }
    }
}
// é¢„æœŸè¾“å‡ºï¼š
// === åŠ¨ç‰©å›­å¼€é¥­äº† ===
// æ±ªæ±ªæ±ª
// å–µå–µå–µ
// æ±ªæ±ªæ±ª

```

---

### ğŸ’¡ 1.4 å®ƒè§£å†³äº†ä»€ä¹ˆé—®é¢˜ *ğŸ’¡ æ ¸å¿ƒå¿…å­¦*

**åœºæ™¯**ï¼šå¦‚æœä¸ä½¿ç”¨å¤šæ€ï¼Œè¦è®©ä¸€å †åŠ¨ç‰©å«ï¼Œä»£ç ä¼šå˜æˆä»€ä¹ˆæ ·ï¼Ÿ

**âŒ æ²¡æœ‰å¤šæ€çš„ç¾éš¾ (Anti-Pattern)**

```java
// ä¼ªä»£ç å±•ç¤º
if (obj instanceof Dog) {
    ((Dog) obj).bark(); // å¿…é¡»æ‰‹åŠ¨è½¬æˆç‹—ï¼Œè°ƒç”¨ç‹—çš„æ–¹æ³•
} else if (obj instanceof Cat) {
    ((Cat) obj).meow(); // å¿…é¡»æ‰‹åŠ¨è½¬æˆçŒ«ï¼Œè°ƒç”¨çŒ«çš„æ–¹æ³•
} 
// åæœï¼šæ¯æ–°å¢ä¸€ç§åŠ¨ç‰©ï¼Œéƒ½è¦å›æ¥ä¿®æ”¹è¿™é‡Œçš„ if-else ä»£ç ï¼
// è¿™è¿åäº† "å¼€é—­åŸåˆ™"ï¼ˆå¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å…³é—­ï¼‰ã€‚

```

**âœ… å¤šæ€çš„ä¼˜åŠ¿**

```java
// åªéœ€è¦ä¸€è¡Œä»£ç 
obj.makeSound(); 
// æ”¶ç›Šï¼šæ–°å¢ä¸€ç§ Bird ç±»ï¼Œè¿™è¡Œä»£ç å®Œå…¨ä¸ç”¨æ”¹ï¼Œè‡ªåŠ¨é€‚é…ã€‚
// å®ç°äº†è°ƒç”¨è€…ï¼ˆZooPartyï¼‰å’Œå…·ä½“å®ç°ï¼ˆDog/Catï¼‰çš„ã€è§£è€¦ã€‘ã€‚

```

---

### âš™ï¸ 1.5 åº•å±‚åŸç† *â­ è¿›é˜¶é€‰å­¦*

**ç›®æ ‡**ï¼šç†è§£å¼•ç”¨å˜é‡å’Œå®é™…å¯¹è±¡åœ¨å†…å­˜ä¸­çš„åˆ†ç¦»ã€‚

å½“æ‰§è¡Œ `Animal a = new Cat();` æ—¶ï¼ŒJVM å†…å­˜å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ

**å†…å­˜å¸ƒå±€ç¤ºæ„å›¾**ï¼š

```
   Stack (æ ˆå†…å­˜)                        Heap (å †å†…å­˜)
+------------------+                 +---------------------------+
| å˜é‡: a          |                 | å¯¹è±¡: Cat å®ä¾‹            |
| ç±»å‹: Animal     |Ref (å¼•ç”¨)       | ç±»å‹: Cat                 |
| [0x1234]      -------------------->| [Header]                  |
+------------------+                 | ------------------------- |
                                     | è™šæ–¹æ³•è¡¨ (vtable) æŒ‡é’ˆ    |--> [Catçš„æ–¹æ³•è¡¨]
                                     | field: name               |    | makeSound() -> Cat.makeSound
                                     +---------------------------+

```

**æ‰§è¡Œæµç¨‹è§£æ**ï¼š

1. **ç¼–è¯‘é˜¶æ®µ**ï¼šç¼–è¯‘å™¨æ£€æŸ¥ `a` çš„ç±»å‹æ˜¯ `Animal`ã€‚å®ƒå» `Animal` ç±»é‡Œæ‰¾æœ‰æ²¡æœ‰ `makeSound()`ã€‚æœ‰ï¼Œåˆ™ç¼–è¯‘é€šè¿‡ã€‚
2. **è¿è¡Œé˜¶æ®µ**ï¼š
   * JVM é¡ºç€å¼•ç”¨ `0x1234` æ‰¾åˆ°å †é‡Œçš„å¯¹è±¡ã€‚
   * å‘ç°è¿™ä¸ªå¯¹è±¡å¤´é‡Œæ ‡è®°çš„çœŸå®ç±»å‹æ˜¯ `Cat`ã€‚
   * JVM æŸ¥æ‰¾ `Cat` çš„æ–¹æ³•è¡¨ï¼ˆvtableï¼‰ã€‚
   * æ‰§è¡Œ `Cat` ç‰ˆæœ¬çš„ `makeSound()`ã€‚



**æ€»ç»“**ï¼š

* **å˜é‡ç±»å‹ï¼ˆAnimalï¼‰**ï¼šå†³å®šäº†ä½ **èƒ½è°ƒç”¨ä»€ä¹ˆæ–¹æ³•**ï¼ˆæƒé™ï¼‰ã€‚
* **å¯¹è±¡ç±»å‹ï¼ˆCatï¼‰**ï¼šå†³å®šäº†**å®é™…æ‰§è¡Œä»€ä¹ˆé€»è¾‘**ï¼ˆå®ç°ï¼‰ã€‚

---

## ç¬¬2éƒ¨åˆ†ï¼šå·¥ç¨‹å®è·µï¼ˆHow to Do Rightï¼‰

### ğŸ” å‰ç½®çŸ¥è¯†æ£€æŸ¥

```
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ğŸ“š å‰ç½®çŸ¥è¯†å›é¡¾
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
æœ¬é˜¶æ®µä¼šç”¨åˆ°ä»¥ä¸‹æ¦‚å¿µï¼ˆå·²åœ¨é˜¶æ®µ1å­¦è¿‡ï¼‰ï¼š
Â· ç»§æ‰¿ (extends/implements)
Â· æ–¹æ³•é‡å†™ (Overriding)
Â· å‘ä¸Šè½¬å‹ (çˆ¶ç±»å¼•ç”¨æŒ‡å‘å­ç±»å¯¹è±¡)

å¦‚æœä¸è®°å¾—äº†ï¼Œå»ºè®®å…ˆå›é¡¾ç¬¬1éƒ¨åˆ†ã€‚
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

```

---

### ğŸŒ 2.1 çœŸå®åœºæ™¯ï¼šç”µå•†æ”¯ä»˜æ¨¡å— *ğŸ’¡ æ ¸å¿ƒå¿…å­¦*

**ç›®æ ‡**ï¼šåˆ©ç”¨å¤šæ€æ¶ˆé™¤ä¸šåŠ¡ä»£ç ä¸­è‡ƒè‚¿çš„ `if-else` åˆ¤æ–­ã€‚

**åœºæ™¯æè¿°**ï¼š
åœ¨ä¸€ä¸ªç”µå•†ç³»ç»Ÿä¸­ï¼Œç”¨æˆ·ç»“ç®—æ—¶å¯ä»¥é€‰æ‹©å¤šç§æ”¯ä»˜æ–¹å¼ï¼ˆæ”¯ä»˜å®ã€å¾®ä¿¡ã€é“¶è”ï¼‰ã€‚

**âŒ é”™è¯¯åšæ³•ï¼šé¢å‘è¿‡ç¨‹çš„ If-Else åœ°ç‹±**
å¦‚æœä¸ä½¿ç”¨å¤šæ€ï¼Œæ¯å¢åŠ ä¸€ç§æ”¯ä»˜æ–¹å¼ï¼Œä½ éƒ½å¿…é¡»ä¿®æ”¹æ ¸å¿ƒçš„ `pay` æ–¹æ³•ã€‚

```java
public class PaymentService {
    public void pay(String type, double amount) {
        if ("ALIPAY".equals(type)) {
            // æ”¯ä»˜å®çš„å¤æ‚é€»è¾‘
            System.out.println("è°ƒç”¨æ”¯ä»˜å®APIæ”¯ä»˜: " + amount);
        } else if ("WECHAT".equals(type)) {
            // å¾®ä¿¡çš„å¤æ‚é€»è¾‘
            System.out.println("è°ƒç”¨å¾®ä¿¡APIæ”¯ä»˜: " + amount);
        } else if ("UNIONPAY".equals(type)) {
            // ... æ¯åŠ ä¸€ä¸ªï¼Œè¿™é‡Œå°±è¦æ”¹ä¸€æ¬¡ï¼
            // é£é™©ï¼šæ”¹è¿™é‡Œå¯èƒ½ä¼šä¸å°å¿ƒå¼„åä¸Šé¢çš„ä»£ç 
        }
    }
}

```

**âœ… æ­£ç¡®åšæ³•ï¼šåŸºäºå¤šæ€çš„ç­–ç•¥æ¨¡å¼**
æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªé€šç”¨çš„æ”¯ä»˜æ¥å£ï¼Œè®©å…·ä½“çš„æ”¯ä»˜æ–¹å¼å»å®ç°å®ƒã€‚

**æ•°æ®æµè½¬å›¾ (ASCII)**ï¼š

```
å®¢æˆ·ç«¯ (Client)
      |
      | 1. æŒæœ‰æ¥å£å¼•ç”¨ (PaymentChannel)
      v
[ æ¥å£: PaymentChannel ] <---------+
      | pay(amount)                |
      |                            |
      +---------------+            | å‘ä¸Šè½¬å‹
      |               |            |
      v               v            |
[ AliPayChannel ] [ WeChatPay ] ---+
  å®ç°å…·ä½“é€»è¾‘       å®ç°å…·ä½“é€»è¾‘

```

**ä»£ç å®ç°**ï¼š

```java
// 1. å®šä¹‰æŠ½è±¡ç­–ç•¥ï¼ˆå¯ä»¥æ˜¯æ¥å£æˆ–æŠ½è±¡ç±»ï¼‰
interface PaymentChannel {
    void processPayment(double amount);
}

// 2. å…·ä½“ç­–ç•¥ï¼šæ”¯ä»˜å®
class AliPayChannel implements PaymentChannel {
    @Override
    public void processPayment(double amount) {
        System.out.println("ğŸ¤– æ­£åœ¨è¿æ¥æ”¯ä»˜å®ç½‘å…³...æ‰£æ¬¾ " + amount);
    }
}

// 3. å…·ä½“ç­–ç•¥ï¼šå¾®ä¿¡
class WeChatPayChannel implements PaymentChannel {
    @Override
    public void processPayment(double amount) {
        System.out.println("ğŸŸ¢ æ­£åœ¨æ‹‰èµ·å¾®ä¿¡æ”¶é“¶å°...æ‰£æ¬¾ " + amount);
    }
}

// 4. ä¸šåŠ¡å±‚ï¼ˆå®Œå…¨ä¸å…³å¿ƒå…·ä½“æ˜¯å“ªç§æ”¯ä»˜æ–¹å¼ï¼‰
class OrderService {
    public void checkout(PaymentChannel channel, double amount) {
        // æ ¸å¿ƒï¼šè¿™é‡Œåªè°ƒç”¨æ¥å£æ–¹æ³•
        // æ— è®ºä¼ å…¥çš„æ˜¯ AliPay è¿˜æ˜¯ WeChatPayï¼Œè¿™é‡Œä»£ç éƒ½ä¸ç”¨æ”¹ï¼
        channel.processPayment(amount);
    }
}

```

---

### âœ… 2.2 å·¥ç¨‹è§„èŒƒ *ğŸ”¥ å®æˆ˜å¿…å¤‡*

åœ¨ä¸šç•Œå¼€å‘ä¸­ï¼Œå…³äºå¤šæ€æœ‰ä¸¤æ¡ä¸¥æ ¼çš„**çº¢ç»¿ç¯è§„èŒƒ**ï¼š

**ğŸ”´ REDï¼ˆå¼ºåˆ¶è§„èŒƒï¼‰ï¼šå¿…é¡»åŠ  @Override**

* **è§„èŒƒ**ï¼šæ‰€æœ‰é‡å†™çš„æ–¹æ³•ï¼Œå¿…é¡»åœ¨æ–¹æ³•ä¸Šæ–¹æ·»åŠ  `@Override` æ³¨è§£ã€‚
* **åæœ**ï¼šå¦‚æœä¸åŠ ï¼Œå½“ä½ ä¿®æ”¹çˆ¶ç±»æ–¹æ³•åï¼ˆå¦‚ `makeSound` æ”¹ä¸º `makeVoice`ï¼‰æ—¶ï¼Œå­ç±»é‚£ä¸ªåŒåæ–¹æ³•å°±å˜æˆäº†"æ–°å®šä¹‰çš„æ–¹æ³•"è€Œä¸æ˜¯"é‡å†™"ï¼Œå¤šæ€å¤±æ•ˆï¼Œä¸”ç¼–è¯‘å™¨ä¸ä¼šæŠ¥é”™ï¼Œæ’æŸ¥æå…¶å›°éš¾ã€‚

```java
// âŒ é”™è¯¯ç¤ºèŒƒ
class Cat extends Animal {
    // å¦‚æœçˆ¶ç±»å« makeSoundï¼Œä½ æ‰‹æ»‘å†™æˆäº† makeSoundd
    // ç¼–è¯‘å™¨ä»¥ä¸ºä½ åœ¨å®šä¹‰ä¸€ä¸ªæ–°æ–¹æ³•ï¼Œå¤šæ€å¤±æ•ˆï¼
    public void makeSoundd() { ... } 
}

// âœ… æ­£ç¡®ç¤ºèŒƒ
class Cat extends Animal {
    @Override // ç¼–è¯‘å™¨ä¼šå¸®ä½ æ£€æŸ¥ï¼šçˆ¶ç±»çœŸçš„æœ‰è¿™ä¸ªæ–¹æ³•å—ï¼Ÿ
    public void makeSound() { ... }
}

```

**ğŸŸ¢ GREENï¼ˆæ¨èé£æ ¼ï¼‰ï¼šå‘ä¸‹è½¬å‹å‰å¿…é¡»æ£€æŸ¥**

* **åœºæ™¯**ï¼šæœ‰æ—¶ä½ éœ€è¦è°ƒç”¨å­ç±»ç‰¹æœ‰çš„æ–¹æ³•ï¼ˆå¦‚çŒ«ä¼š `catchMouse`ï¼Œä½†åŠ¨ç‰©ä¸ä¼šï¼‰ã€‚è¿™æ—¶éœ€è¦**å‘ä¸‹è½¬å‹**ï¼ˆDowncastingï¼‰ã€‚
* **è§„èŒƒ**ï¼šåœ¨å¼ºè½¬ä¹‹å‰ï¼Œå¿…é¡»ä½¿ç”¨ `instanceof` å…³é”®å­—è¿›è¡Œåˆ¤æ–­ã€‚

```java
Animal pet = new Dog();

// âŒ å±é™©æ“ä½œï¼šç›´æ¥å¼ºè½¬
// Cat c = (Cat) pet; // è¿è¡Œæ—¶å´©æºƒï¼ClassCastException: Dog cannot be cast to Cat

// âœ… å®‰å…¨æ“ä½œï¼šå…ˆæ£€æŸ¥ï¼Œå†è½¬æ¢
if (pet instanceof Cat) {
    Cat c = (Cat) pet;
    c.catchMouse(); // è°ƒç”¨å­ç±»ç‰¹æœ‰æ–¹æ³•
}

```

---

### ğŸ”„ 2.3 ç‰ˆæœ¬æ¼”è¿›ï¼šJava 17 æ–°ç‰¹æ€§ *ğŸ’¡ æ ¸å¿ƒå¿…å­¦*

Java 14 å¼•å…¥å¹¶åœ¨ Java 16 æ­£å¼æ ‡å‡†åŒ–äº† **`instanceof` çš„æ¨¡å¼åŒ¹é… (Pattern Matching)**ï¼Œè¿™åœ¨ Java 17 LTS ä¸­æ˜¯æ ‡é…ã€‚

**ç›®æ ‡**ï¼šç®€åŒ–å‘ä¸‹è½¬å‹çš„ä»£ç ã€‚

| å¯¹æ¯”ç»´åº¦ | Java 8 (ä¼ ç»Ÿå†™æ³•) | Java 17 (ç°ä»£å†™æ³•) |
| --- | --- | --- |
| **ä»£ç è¡Œæ•°** | 3è¡Œ (åˆ¤æ–­ -> å¼ºè½¬ -> èµ‹å€¼) | 1è¡Œ (åˆ¤æ–­å¹¶èµ‹å€¼) |
| **å¯è¯»æ€§** | å•°å—¦ï¼Œéœ€é‡å¤å†™ç±»å | æ¸…æ™°ï¼Œç¬¦åˆç›´è§‰ |
| **å®‰å…¨æ€§** | å®¹æ˜“å¿˜è®°å¼ºè½¬æˆ–è½¬é”™ | ç¼–è¯‘å™¨è‡ªåŠ¨å¤„ç† |

**ä»£ç å¯¹æ¯”**ï¼š

```java
Object obj = "Hello Java";

// ğŸ‘´ ä¼ ç»Ÿå†™æ³• (Java 8 åŠä¹‹å‰)
if (obj instanceof String) {
    // å¿…é¡»æ‰‹åŠ¨å¼ºè½¬
    String s = (String) obj;
    // ç„¶åæ‰èƒ½ç”¨ String çš„æ–¹æ³•
    System.out.println(s.toUpperCase());
}

// ğŸ‘¶ ç°ä»£å†™æ³• (Java 17 LTS)
// è¯­æ³•è§£è¯»ï¼šå¦‚æœ obj æ˜¯ String ç±»å‹ï¼Œåˆ™ç›´æ¥å¼ºè½¬å¹¶èµ‹å€¼ç»™å˜é‡ s
if (obj instanceof String s) {
    // ç›´æ¥ä½¿ç”¨ sï¼Œå®ƒæ˜¯ String ç±»å‹
    System.out.println(s.toUpperCase());
}

```

**æ³¨æ„**ï¼šå˜é‡ `s` çš„ä½œç”¨åŸŸä»…åœ¨ `if` ä»£ç å—å†…æœ‰æ•ˆï¼ˆè¿™å¾ˆåˆç†ï¼Œå› ä¸ºå¦‚æœä¸æ˜¯ Stringï¼Œ`s` å°±ä¸å­˜åœ¨ï¼‰ã€‚

---

## ç¬¬3éƒ¨åˆ†ï¼šé¿å‘è¿›é˜¶ï¼ˆWhat to Avoid & Beyondï¼‰

### ğŸ” å‰ç½®çŸ¥è¯†æ£€æŸ¥

```
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ğŸ“š å‰ç½®çŸ¥è¯†å›é¡¾
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
æœ¬é˜¶æ®µä¼šç”¨åˆ°ä»¥ä¸‹æ¦‚å¿µï¼š
Â· å‘ä¸Šè½¬å‹ (1.1èŠ‚)
Â· åŠ¨æ€ç»‘å®š (1.2èŠ‚)
Â· æ¥å£ä¸å®ç° (2.1èŠ‚)

å¦‚æœä¸è®°å¾—äº†ï¼Œå»ºè®®å…ˆå›é¡¾ç›¸å…³ç« èŠ‚ã€‚
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

```

---

### âš ï¸ 3.1 å¸¸è§é™·é˜±åˆé›† *ğŸ”¥ å®æˆ˜å¿…å¤‡*

#### é™·é˜± 1ï¼šå­—æ®µä¸è®²å¤šæ€ï¼ˆField Hidingï¼‰

**ğŸ“š æ¶‰åŠæ¦‚å¿µ**ï¼š**é™æ€ç»‘å®š (Static Binding)**ã€‚
åœ¨ Java ä¸­ï¼Œ**æ–¹æ³•**æ˜¯å¤šæ€çš„ï¼ˆçœ‹å®é™…å¯¹è±¡ï¼‰ï¼Œä½†**æˆå‘˜å˜é‡ï¼ˆå­—æ®µï¼‰**ä¸æ˜¯å¤šæ€çš„ï¼ˆçœ‹å¼•ç”¨ç±»å‹ï¼‰ã€‚

**é”™è¯¯ä»£ç **ï¼š

```java
class SuperClass {
    public String name = "çˆ¶ç±»åå­—"; // å˜é‡
    public void sayHello() { 
        System.out.println("çˆ¶ç±»Hello"); 
    }
}

class SubClass extends SuperClass {
    public String name = "å­ç±»åå­—"; // âŒ è¿™é‡Œçš„ name é®è”½äº†çˆ¶ç±»çš„ name
    @Override
    public void sayHello() { 
        System.out.println("å­ç±»Hello"); 
    }
}

public class FieldTrap {
    public static void main(String[] args) {
        // å‘ä¸Šè½¬å‹
        SuperClass ref = new SubClass();
        
        // ğŸ˜± æƒŠæ‚šæ—¶åˆ»ï¼š
        // æ–¹æ³•è°ƒç”¨ï¼šçœ‹å³è¾¹ï¼ˆå­ç±»é€»è¾‘ï¼‰-> è¾“å‡º "å­ç±»Hello" (ç¬¦åˆé¢„æœŸ)
        ref.sayHello(); 
        
        // å˜é‡è®¿é—®ï¼šçœ‹å·¦è¾¹ï¼ˆçˆ¶ç±»ç±»å‹ï¼‰-> è¾“å‡º "çˆ¶ç±»åå­—" (ï¼ï¼ï¼)
        System.out.println(ref.name); 
    }
}

```

**ä»€ä¹ˆæƒ…å†µä¸‹ä¼šå‡ºé”™**ï¼š
å½“ä½ è¯•å›¾é€šè¿‡çˆ¶ç±»å¼•ç”¨å»ç›´æ¥è®¿é—®å­ç±»çš„æˆå‘˜å˜é‡æ—¶ã€‚

**ä¸ºä»€ä¹ˆä¼šè¿™æ ·**ï¼š
  * **æ–¹æ³•è°ƒç”¨**ï¼šè¿è¡Œæ—¶åŠ¨æ€ç»‘å®šï¼ˆDynamic Bindingï¼‰ï¼ŒJVM çŸ¥é“å¯¹è±¡å®é™…ä¸Šæ˜¯ `SubClass`ã€‚
  * **å­—æ®µè®¿é—®**ï¼šç¼–è¯‘æ—¶é™æ€ç»‘å®šï¼ˆStatic Bindingï¼‰ï¼Œç¼–è¯‘å™¨åªçœ‹åˆ° `ref` æ˜¯ `SuperClass` ç±»å‹ï¼Œæ‰€ä»¥ç›´æ¥é”å®šäº†çˆ¶ç±»çš„ `name` å­—æ®µã€‚

**âœ… ä¿®å¤æ–¹æ¡ˆ**ï¼š
**æ°¸è¿œä¸è¦ç›´æ¥å…¬å¼€ï¼ˆpublicï¼‰æˆå‘˜å˜é‡**ã€‚ä½¿ç”¨ `private` å˜é‡ + `public` çš„ Getter æ–¹æ³•ã€‚å› ä¸º Getter æ–¹æ³•æ˜¯æ–¹æ³•ï¼Œå®ƒä¼šèµ°å¤šæ€æœºåˆ¶ï¼

```java
class SubClass extends SuperClass {
    private String name = "å­ç±»åå­—";
    
    @Override
    public String getName() { // æ–¹æ³•æ˜¯å¤šæ€çš„
        return this.name;
    }
}
// è°ƒç”¨ ref.getName() å°±ä¼šæ­£ç¡®è¾“å‡º "å­ç±»åå­—"

```

---

### ğŸš€ 3.2 é«˜çº§æ¨¡å¼ï¼šç­–ç•¥æ¨¡å¼ (Strategy Pattern) *â­ è¿›é˜¶é€‰å­¦*

**ç›®æ ‡**ï¼šç”¨å¤šæ€å½»åº•æ¶ˆç­å¤æ‚çš„ `if-else` æˆ– `switch-case`ã€‚

**é—®é¢˜åœºæ™¯**ï¼š
ç”µå•†å¤§ä¿ƒï¼Œéœ€è¦è®¡ç®—æŠ˜æ‰£ã€‚æœ‰ VIP æŠ˜æ‰£ã€èŠ‚æ—¥æŠ˜æ‰£ã€æ— æŠ˜æ‰£ç­‰ã€‚

**âŒ ä¼ ç»Ÿå†™æ³•**ï¼š

```java
public double calculatePrice(String type, double price) {
    if (type.equals("VIP")) return price * 0.8;
    else if (type.equals("HOLIDAY")) return price * 0.9;
    else return price;
}

```

**âœ… ç­–ç•¥æ¨¡å¼å®ç°**ï¼š

```java
// 1. å®šä¹‰ç­–ç•¥æ¥å£
interface DiscountStrategy {
    double applyDiscount(double originalPrice);
}

// 2. å…·ä½“ç­–ç•¥å®ç°
class VipDiscount implements DiscountStrategy {
    @Override
    public double applyDiscount(double price) {
        return price * 0.8;
    }
}

class HolidayDiscount implements DiscountStrategy {
    @Override
    public double applyDiscount(double price) {
        return price * 0.9;
    }
}

// 3. ç­–ç•¥å·¥å‚ (ä½¿ç”¨ Map æ¶ˆé™¤ if-else)
class DiscountFactory {
    private static final Map<String, DiscountStrategy> strategies = new HashMap<>();
    
    static {
        strategies.put("VIP", new VipDiscount());
        strategies.put("HOLIDAY", new HolidayDiscount());
    }
    
    public static DiscountStrategy getStrategy(String type) {
        return strategies.getOrDefault(type, price -> price); // é»˜è®¤åŸä»·
    }
}

// 4. ä½¿ç”¨
public static void main(String[] args) {
    String userType = "VIP";
    double price = 100.0;
    
    // ä¸€è¡Œä»£ç å®Œæˆç­–ç•¥é€‰æ‹©å’Œæ‰§è¡Œ
    double finalPrice = DiscountFactory.getStrategy(userType).applyDiscount(price);
}

```

**æ”¶ç›Šåˆ†æ**ï¼š

| ç»´åº¦ | If-Else æ¨¡å¼ | ç­–ç•¥æ¨¡å¼ |
| --- | --- | --- |
| **æ‰©å±•æ€§** | å·®ï¼ˆéœ€ä¿®æ”¹åŸæœ‰ä»£ç ï¼‰ | ä¼˜ï¼ˆåªéœ€æ–°å¢ä¸€ä¸ªç±»ï¼‰ |
| **ä»£ç ç»“æ„** | è‡ƒè‚¿ã€é€»è¾‘æ··æ‚ | æ¸…æ™°ã€èŒè´£å•ä¸€ |
| **ç»´æŠ¤é£é™©** | æ”¹ä¸€ä¸ªå½±å“æ‰€æœ‰ | ç‹¬ç«‹äº’ä¸å¹²æ‰° |

---

### ğŸ“ 3.3 å®æˆ˜æŒ‘æˆ˜

**åœºæ™¯**ï¼šä½ æ­£åœ¨å¼€å‘ä¸€ä¸ª RPG æ¸¸æˆã€‚è‹±é›„ï¼ˆHeroï¼‰å¯ä»¥æ”»å‡»æ€ªç‰©ï¼Œä½†ä¸åŒçš„æ­¦å™¨é€ æˆçš„ä¼¤å®³è®¡ç®—æ–¹å¼ä¸åŒã€‚

**è¦æ±‚**ï¼š

1. ä¿®å¤ä»£ç ä¸­çš„â€œå­—æ®µé®è”½â€é™·é˜±ï¼Œç¡®ä¿ä¼¤å®³å€¼è®¡ç®—æ­£ç¡®ã€‚
2. åˆ©ç”¨å¤šæ€ï¼Œæ·»åŠ ä¸€ä¸ªæ–°çš„æ­¦å™¨ `MagicWand`ï¼ˆé­”æ–ï¼‰ï¼Œä¼¤å®³æ˜¯ï¼ˆåŸºç¡€æ”»å‡»åŠ› * 2ï¼‰ã€‚
3. åœ¨ `main` æ–¹æ³•ä¸­æ¼”ç¤ºè‹±é›„åˆ‡æ¢æ­¦å™¨è¿›è¡Œæ”»å‡»ã€‚

**è¯·ä¿®å¤å¹¶å®Œæˆä»¥ä¸‹ä»£ç **ï¼š

```java
// åŸºç¡€æ­¦å™¨ç±»
class Weapon {
    public int damage = 10; // âš ï¸ é™·é˜±ï¼šè¿™é‡Œä½¿ç”¨äº† public å­—æ®µ
    
    public void attack() {
        System.out.println("æ™®é€šæ”»å‡»ï¼Œé€ æˆ " + damage + " ç‚¹ä¼¤å®³");
    }
}

// å®å‰‘
class Sword extends Weapon {
    public int damage = 50; // âš ï¸ å­ç±»è¯•å›¾è¦†ç›–çˆ¶ç±»å­—æ®µ
    
    @Override
    public void attack() {
        System.out.println("æŒ¥èˆå®å‰‘ï¼Œé€ æˆ " + damage + " ç‚¹ä¼¤å®³");
    }
}

// è‹±é›„
class Hero {
    public void useWeapon(Weapon w) {
        // è¿™é‡Œçš„ä¸šåŠ¡é€»è¾‘éœ€è¦æ‰“å°å…·ä½“çš„ä¼¤å®³æ•°å€¼
        System.out.println("è‹±é›„å‘èµ·æ”»å‡»...");
        w.attack();
        // ğŸ› Bug é¢„è­¦ï¼šå¦‚æœæˆ‘æƒ³åœ¨è¿™é‡Œç›´æ¥è·å–ä¼¤å®³å€¼è®¡ç®—å¸è¡€é‡ï¼š
        // int lifeSteal = w.damage / 10; 
        // System.out.println("å¸è¡€: " + lifeSteal);
    }
}

public class GameRun {
    public static void main(String[] args) {
        // TODO: å®Œæˆå®æˆ˜æŒ‘æˆ˜
    }
}

```

**ä¿®æ”¹é€»è¾‘ï¼š**   
1. **å•ä¸€æ•°æ®æºï¼š** åˆ©ç”¨ç»§æ‰¿ + æ„é€ å™¨ã€‚æ”¶ç›Šï¼šæ— è®ºä½ åœ¨ä»£ç çš„ä»»ä½•è§’è½ï¼ˆçˆ¶ç±»æ–¹æ³•é‡Œã€å­ç±»æ–¹æ³•é‡Œã€å¤–éƒ¨ç±»é‡Œï¼‰è®¿é—® getDamage()ï¼Œæ‹¿åˆ°çš„æ°¸è¿œæ˜¯åŒä¸€ä¸ªå€¼ã€‚
2. **å°è£…ï¼šç§æœ‰æ•°æ®ï¼Œå…¬å¼€æ–¹æ³•ã€‚** å°è£…çš„ä½è€¦åˆï¼Œæœ€å¤§çš„å·¥ç¨‹ä»·å€¼æ˜¯ï¼š**è®©ä¸åŒçš„ç±»ä¹‹é—´å½¼æ­¤ç‹¬ç«‹ï¼ˆé¿å…ä¸€ä¸ªç±»ä¸­æ•°æ®ä¿®æ”¹ï¼Œå¦ä¸€ä¸ªç±»ä¹Ÿè¦ä¿®æ”¹ï¼‰ï¼Œä¿æŠ¤äº†è°ƒç”¨è€…ï¼ˆHeroï¼‰å…å—è¢«è°ƒç”¨è€…ï¼ˆWeaponï¼‰å˜åŒ–çš„å½±å“**
3. ç»§æ‰¿è§£å†³**ä»£ç å¤ç”¨ï¼ˆé‡å¤çš„é€šç”¨é€»è¾‘ï¼‰** ä»¥åŠ **ç±»å‹æŠ½è±¡ï¼ˆå¤šæ€å‘ç”Ÿçš„å‰æï¼Œå­ç±»å¯¹è±¡å¯ä»¥èµ‹ç»™çˆ¶ç±»çš„å¼•ç”¨ï¼‰**ï¼Œ**å¤šæ€è§£å†³å¤šæ ·åŒ–ï¼ˆç‰¹æ®Šé€»è¾‘ï¼‰**

[è§GameRun.java](ä»£ç /GameRun.java)