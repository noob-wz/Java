# Javaç±»åŠ è½½ä¸å¯¹è±¡åˆå§‹åŒ–å®Œå…¨æŒ‡å—

> **é€‚ç”¨ç‰ˆæœ¬ï¼š** Java 8+
---

## ç›®å½•

1. [æ ¸å¿ƒæ¦‚å¿µ](#æ ¸å¿ƒæ¦‚å¿µ)
2. [ç±»åŠ è½½å®Œæ•´æµç¨‹](#ç±»åŠ è½½å®Œæ•´æµç¨‹)
3. [å¯¹è±¡åˆå§‹åŒ–å®Œæ•´æµç¨‹](#å¯¹è±¡åˆå§‹åŒ–å®Œæ•´æµç¨‹)
4. [ç»§æ‰¿ä½“ç³»ä¸­çš„åŠ è½½é¡ºåº](#ç»§æ‰¿ä½“ç³»ä¸­çš„åŠ è½½é¡ºåº)
5. [å®Œæ•´æ‰§è¡Œé¡ºåºæ€»ç»“](#å®Œæ•´æ‰§è¡Œé¡ºåºæ€»ç»“)
6. [å†…å­˜åˆ†é…è¯¦è§£](#å†…å­˜åˆ†é…è¯¦è§£)
7. [å¸¸è§é™·é˜±ä¸æ³¨æ„äº‹é¡¹](#å¸¸è§é™·é˜±ä¸æ³¨æ„äº‹é¡¹)
8. [å®æˆ˜ç¤ºä¾‹](#å®æˆ˜ç¤ºä¾‹)

---

## æ ¸å¿ƒæ¦‚å¿µ

### 1.1 ä¸¤ä¸ªå…³é”®è¿‡ç¨‹

| è¿‡ç¨‹ | è¯´æ˜ | è§¦å‘æ—¶æœº | æ‰§è¡Œæ¬¡æ•° |
|------|------|----------|----------|
| **ç±»åŠ è½½ï¼ˆ`<clinit>`ï¼‰** | ç±»çº§åˆ«çš„åˆå§‹åŒ– | é¦–æ¬¡ä½¿ç”¨ç±»æ—¶ | **æ¯ä¸ªç±»åªæ‰§è¡Œä¸€æ¬¡** |
| **å¯¹è±¡åˆå§‹åŒ–ï¼ˆ`<init>`ï¼‰** | å®ä¾‹çº§åˆ«çš„åˆå§‹åŒ– | æ¯æ¬¡newå¯¹è±¡æ—¶ | **æ¯ä¸ªå¯¹è±¡å®ä¾‹éƒ½æ‰§è¡Œä¸€æ¬¡** |

### 1.2 å…³é”®æœ¯è¯­

- **`<clinit>`**ï¼šç±»åˆå§‹åŒ–æ–¹æ³•ï¼Œç”±ç¼–è¯‘å™¨è‡ªåŠ¨æ”¶é›†ç±»ä¸­çš„é™æ€å˜é‡èµ‹å€¼å’Œé™æ€ä»£ç å—
- **`<init>`**ï¼šå®ä¾‹åˆå§‹åŒ–æ–¹æ³•ï¼Œç”±ç¼–è¯‘å™¨è‡ªåŠ¨æ”¶é›†å®ä¾‹å˜é‡èµ‹å€¼ã€å®ä¾‹ä»£ç å—å’Œæ„é€ å™¨ä»£ç 
- **é›¶å€¼/é»˜è®¤å€¼**ï¼šint=0, boolean=false, å¼•ç”¨ç±»å‹=null
- **æ˜¾å¼åˆå§‹åŒ–**ï¼šä»£ç ä¸­æ˜ç¡®å†™å‡ºçš„èµ‹å€¼æ“ä½œ

---

## ç±»åŠ è½½å®Œæ•´æµç¨‹

### 2.1 ç±»åŠ è½½çš„è§¦å‘æ—¶æœºï¼ˆé¦–æ¬¡ä¸»åŠ¨ä½¿ç”¨ï¼‰

```
âœ… ä¼šè§¦å‘ç±»åŠ è½½çš„æƒ…å†µï¼š
â”œâ”€ 1. åˆ›å»ºç±»çš„å®ä¾‹ï¼ˆnewã€åå°„ã€å…‹éš†ã€ååºåˆ—åŒ–ï¼‰
â”œâ”€ 2. è®¿é—®ç±»çš„é™æ€å˜é‡ï¼ˆfinalå¸¸é‡é™¤å¤–ï¼‰
â”œâ”€ 3. è°ƒç”¨ç±»çš„é™æ€æ–¹æ³•
â”œâ”€ 4. ä½¿ç”¨åå°„å¯¹ç±»è¿›è¡Œæ“ä½œï¼ˆClass.forNameï¼‰
â”œâ”€ 5. åˆå§‹åŒ–å­ç±»æ—¶ï¼ˆä¼šå…ˆåŠ è½½çˆ¶ç±»ï¼‰
â””â”€ 6. JVMå¯åŠ¨æ—¶çš„ä¸»ç±»ï¼ˆåŒ…å«mainæ–¹æ³•çš„ç±»ï¼‰

âŒ ä¸ä¼šè§¦å‘ç±»åŠ è½½çš„æƒ…å†µï¼š
â”œâ”€ 1. è®¿é—®é™æ€finalå¸¸é‡ï¼ˆç¼–è¯‘æœŸå¸¸é‡ï¼‰
â”œâ”€ 2. é€šè¿‡å­ç±»å¼•ç”¨çˆ¶ç±»çš„é™æ€å­—æ®µï¼ˆåªä¼šåŠ è½½çˆ¶ç±»ï¼‰
â”œâ”€ 3. å®šä¹‰ç±»çš„æ•°ç»„ï¼ˆString[] arr = new String[10]ï¼‰
â””â”€ 4. ä½¿ç”¨ClassLoaderåŠ è½½ä½†ä¸åˆå§‹åŒ–
```

### 2.2 ç±»åŠ è½½çš„äº”ä¸ªé˜¶æ®µ

```
åŠ è½½ â†’ éªŒè¯ â†’ å‡†å¤‡ â†’ è§£æ â†’ åˆå§‹åŒ–
  â†“      â†“      â†“      â†“       â†“
 Load  Verify Prepare Resolve <clinit>
```

#### é˜¶æ®µ1ï¼šåŠ è½½ï¼ˆLoadingï¼‰
```
åŠŸèƒ½ï¼š
â”œâ”€ é€šè¿‡ç±»çš„å…¨é™å®šåè·å–äºŒè¿›åˆ¶å­—èŠ‚æµ
â”œâ”€ å°†å­—èŠ‚æµè½¬åŒ–ä¸ºæ–¹æ³•åŒºçš„è¿è¡Œæ—¶æ•°æ®ç»“æ„
â””â”€ åœ¨å †ä¸­ç”Ÿæˆjava.lang.Classå¯¹è±¡ï¼ˆç±»çš„å…¥å£ï¼‰
```

#### é˜¶æ®µ2ï¼šéªŒè¯ï¼ˆVerificationï¼‰
```
åŠŸèƒ½ï¼šç¡®ä¿Classæ–‡ä»¶çš„å­—èŠ‚æµç¬¦åˆJVMè§„èŒƒ
â”œâ”€ æ–‡ä»¶æ ¼å¼éªŒè¯ï¼ˆé­”æ•°ã€ç‰ˆæœ¬å·ç­‰ï¼‰
â”œâ”€ å…ƒæ•°æ®éªŒè¯ï¼ˆè¯­ä¹‰æ£€æŸ¥ï¼‰
â”œâ”€ å­—èŠ‚ç éªŒè¯ï¼ˆæ•°æ®æµå’Œæ§åˆ¶æµåˆ†æï¼‰
â””â”€ ç¬¦å·å¼•ç”¨éªŒè¯
```

#### é˜¶æ®µ3ï¼šå‡†å¤‡ï¼ˆPreparationï¼‰â­
```
åŠŸèƒ½ï¼šä¸ºç±»çš„é™æ€å˜é‡åˆ†é…å†…å­˜å¹¶è®¾ç½®é»˜è®¤é›¶å€¼

ä½ç½®ï¼šJava 8+ï¼Œåœ¨å †ä¸­çš„Classå¯¹è±¡ä¸­åˆ†é…ç©ºé—´

ç¤ºä¾‹ï¼š
  public static int count = 10;
  public static String name = "Java";
  
å‡†å¤‡é˜¶æ®µåï¼š
  count = 0        â† intçš„é›¶å€¼
  name = null      â† å¼•ç”¨ç±»å‹çš„é›¶å€¼
  
æ³¨æ„ï¼š
  âœ… åªå¤„ç†é™æ€å˜é‡
  âŒ ä¸å¤„ç†å®ä¾‹å˜é‡ï¼ˆå®ä¾‹å˜é‡åœ¨å¯¹è±¡åˆ›å»ºæ—¶å¤„ç†ï¼‰
  âŒ æ­¤æ—¶è¿˜ä¸ä¼šæ‰§è¡Œæ˜¾å¼åˆå§‹åŒ–ï¼ˆcount=10è¦ç­‰åˆ°åˆå§‹åŒ–é˜¶æ®µï¼‰
  âœ… static finalå¸¸é‡ä¼šåœ¨æ­¤é˜¶æ®µç›´æ¥èµ‹å€¼ï¼ˆç¼–è¯‘æœŸå¸¸é‡ï¼‰
```

#### é˜¶æ®µ4ï¼šè§£æï¼ˆResolutionï¼‰
```
åŠŸèƒ½ï¼šå°†ç¬¦å·å¼•ç”¨è½¬æ¢ä¸ºç›´æ¥å¼•ç”¨
â”œâ”€ ç±»æˆ–æ¥å£çš„è§£æ
â”œâ”€ å­—æ®µè§£æ
â”œâ”€ æ–¹æ³•è§£æ
â””â”€ æ¥å£æ–¹æ³•è§£æ
```

#### é˜¶æ®µ5ï¼šåˆå§‹åŒ–ï¼ˆInitializationï¼‰â­â­â­
```
åŠŸèƒ½ï¼šæ‰§è¡Œ<clinit>æ–¹æ³•ï¼ŒçœŸæ­£æ‰§è¡Œç±»çš„åˆå§‹åŒ–ä»£ç 

æ‰§è¡Œå†…å®¹ï¼š
â”œâ”€ é™æ€å˜é‡çš„æ˜¾å¼åˆå§‹åŒ–
â””â”€ é™æ€ä»£ç å—

æ‰§è¡Œé¡ºåºï¼šä¸¥æ ¼æŒ‰ç…§ä»£ç å£°æ˜é¡ºåºä»ä¸Šåˆ°ä¸‹æ‰§è¡Œ
```

### 2.3 `<clinit>`æ–¹æ³•è¯¦è§£

#### åŸºæœ¬è§„åˆ™

```java
public class Example {
    // 1ï¸âƒ£ é™æ€å˜é‡å£°æ˜
    private static int a = 10;
    
    // 2ï¸âƒ£ é™æ€ä»£ç å—
    static {
        b = 20;
    }
    
    // 3ï¸âƒ£ é™æ€å˜é‡å£°æ˜
    private static int b = 30;
    
    // <clinit>ç­‰ä»·äºï¼š
    // a = 10;
    // b = 20;
    // b = 30;  â† æœ€ç»ˆb=30
}
```

#### âš ï¸ å…³é”®ç‰¹æ€§

```
1. æ‰§è¡Œé¡ºåºï¼šä¸¥æ ¼æŒ‰ç…§ä»£ç ä¸­çš„å£°æ˜é¡ºåº
2. çº¿ç¨‹å®‰å…¨ï¼šJVMä¿è¯<clinit>åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹è¢«æ­£ç¡®åŠ é”åŒæ­¥
3. æ‰§è¡Œæ¬¡æ•°ï¼šæ¯ä¸ªç±»åªæ‰§è¡Œä¸€æ¬¡
4. çˆ¶ç±»ä¼˜å…ˆï¼šå­ç±»<clinit>æ‰§è¡Œå‰ï¼Œçˆ¶ç±»<clinit>å¿…å®šå·²æ‰§è¡Œå®Œæ¯•
5. éå¿…éœ€ï¼šå¦‚æœæ²¡æœ‰é™æ€å˜é‡å’Œé™æ€ä»£ç å—ï¼Œä¸ä¼šç”Ÿæˆ<clinit>
6. å¯åµŒå¥—ï¼šé™æ€å˜é‡åˆå§‹åŒ–è¿‡ç¨‹ä¸­å¯èƒ½è§¦å‘å¯¹è±¡åˆ›å»ºï¼ˆ<init>ï¼‰
```

#### ğŸ”¥ åµŒå¥—æ‰§è¡Œï¼ˆé‡è¦ï¼‰

```java
public class Nested {
    // æ­¥éª¤1ï¼šå‡†å¤‡é˜¶æ®µ
    // singleton = null, count = 0
    
    // æ­¥éª¤2ï¼šåˆå§‹åŒ–é˜¶æ®µå¼€å§‹æ‰§è¡Œ<clinit>
    private static Nested singleton = new Nested();  // â† è§¦å‘<init>
    
    // <clinit>æš‚åœï¼Œæ‰§è¡Œ<init>
    {
        count++;  // count: 0 â†’ 1
    }
    private Nested() {}
    // <init>å®Œæˆï¼Œè¿”å›<clinit>
    
    // æ­¥éª¤3ï¼šç»§ç»­æ‰§è¡Œå‰©ä½™çš„<clinit>
    public static int count = 0;  // â† æ˜¾å¼èµ‹å€¼ï¼Œcount: 1 â†’ 0
    
    // æœ€ç»ˆç»“æœï¼šcount = 0
}
```

**æµç¨‹å›¾ï¼š**
```
<clinit>å¼€å§‹
    â”œâ”€ singleton = new Nested()
    â”‚   â””â”€â†’ æš‚åœ<clinit>ï¼Œè½¬è€Œæ‰§è¡Œ<init>
    â”‚       â”œâ”€ å®ä¾‹ä»£ç å—ï¼šcount++  (0â†’1)
    â”‚       â””â”€ æ„é€ å™¨
    â”‚   â†â”€â”€â”€ <init>å®Œæˆï¼Œç»§ç»­<clinit>
    â””â”€ count = 0  (1â†’0ï¼Œæ˜¾å¼èµ‹å€¼è¦†ç›–)
<clinit>ç»“æŸ
```

---

## å¯¹è±¡åˆå§‹åŒ–å®Œæ•´æµç¨‹

### 3.1 å¯¹è±¡åˆ›å»ºçš„è§¦å‘æ–¹å¼

```
1. newå…³é”®å­—           â† æœ€å¸¸ç”¨
2. åå°„               â† Class.newInstance(), Constructor.newInstance()
3. clone()æ–¹æ³•        â† å¯¹è±¡å…‹éš†
4. ååºåˆ—åŒ–           â† ObjectInputStream.readObject()
```

### 3.2 å¯¹è±¡åˆ›å»ºçš„æ­¥éª¤

```
æ­¥éª¤1ï¼šç±»åŠ è½½æ£€æŸ¥
    â””â”€ æ£€æŸ¥ç±»æ˜¯å¦å·²åŠ è½½ã€è§£æã€åˆå§‹åŒ–
    â””â”€ å¦‚æœæ²¡æœ‰ï¼Œå…ˆæ‰§è¡Œç±»åŠ è½½æµç¨‹

æ­¥éª¤2ï¼šåˆ†é…å†…å­˜ï¼ˆåœ¨å †ä¸­ï¼‰
    â”œâ”€ æŒ‡é’ˆç¢°æ’ï¼ˆå†…å­˜è§„æ•´æ—¶ï¼‰
    â””â”€ ç©ºé—²åˆ—è¡¨ï¼ˆå†…å­˜ä¸è§„æ•´æ—¶ï¼‰

æ­¥éª¤3ï¼šå†…å­˜æ¸…é›¶
    â””â”€ å°†åˆ†é…çš„å†…å­˜ç©ºé—´åˆå§‹åŒ–ä¸ºé›¶å€¼
    â””â”€ è¿™å°±æ˜¯ä¸ºä»€ä¹ˆå®ä¾‹å˜é‡æœ‰é»˜è®¤å€¼

æ­¥éª¤4ï¼šè®¾ç½®å¯¹è±¡å¤´
    â”œâ”€ å¯¹è±¡çš„å“ˆå¸Œç 
    â”œâ”€ GCåˆ†ä»£å¹´é¾„
    â”œâ”€ é”çŠ¶æ€æ ‡å¿—
    â”œâ”€ çº¿ç¨‹æŒæœ‰çš„é”
    â””â”€ ç±»å…ƒæ•°æ®æŒ‡é’ˆ

æ­¥éª¤5ï¼šæ‰§è¡Œ<init>æ–¹æ³• â­
    â””â”€ è§ä¸‹æ–‡è¯¦è§£
```

### 3.3 `<init>`æ–¹æ³•è¯¦è§£

#### æ‰§è¡Œé¡ºåºï¼ˆå•ç±»ï¼Œæ— ç»§æ‰¿ï¼‰

```
1. å®ä¾‹å˜é‡èµ‹é›¶å€¼ï¼ˆå·²åœ¨æ­¥éª¤3å®Œæˆï¼‰
2. æŒ‰å£°æ˜é¡ºåºæ‰§è¡Œï¼š
   â”œâ”€ å®ä¾‹å˜é‡çš„æ˜¾å¼åˆå§‹åŒ–
   â””â”€ å®ä¾‹ä»£ç å—
3. æ‰§è¡Œæ„é€ å™¨ä»£ç 
```

#### ç¤ºä¾‹

```java
public class Person {
    // å‡†å¤‡é˜¶æ®µåï¼ˆå†…å­˜æ¸…é›¶ï¼‰ï¼š
    // name = null, age = 0
    
    // 1ï¸âƒ£ å®ä¾‹å˜é‡æ˜¾å¼åˆå§‹åŒ–
    private String name = "Unknown";
    private int age = 18;
    
    // 2ï¸âƒ£ å®ä¾‹ä»£ç å—
    {
        System.out.println("å®ä¾‹ä»£ç å—1");
        age = 20;
    }
    
    // 3ï¸âƒ£ å®ä¾‹å˜é‡ï¼ˆç»§ç»­æŒ‰é¡ºåºï¼‰
    private String id = generateId();
    
    // 4ï¸âƒ£ å®ä¾‹ä»£ç å—
    {
        System.out.println("å®ä¾‹ä»£ç å—2");
    }
    
    // 5ï¸âƒ£ æ„é€ å™¨
    public Person() {
        System.out.println("æ„é€ å™¨");
        age = 25;
    }
    
    private String generateId() {
        System.out.println("ç”ŸæˆID");
        return "ID-001";
    }
}

// æ‰§è¡Œé¡ºåºï¼š
// name = "Unknown"
// age = 18
// å®ä¾‹ä»£ç å—1
// age = 20
// ç”ŸæˆID
// id = "ID-001"
// å®ä¾‹ä»£ç å—2
// æ„é€ å™¨
// age = 25
// æœ€ç»ˆï¼šname="Unknown", age=25, id="ID-001"
```

#### âš ï¸ å…³é”®è§„åˆ™

```
1. å®ä¾‹å˜é‡å’Œå®ä¾‹ä»£ç å—ï¼šä¸¥æ ¼æŒ‰ç…§ä»£ç å£°æ˜é¡ºåºæ‰§è¡Œ
2. æ„é€ å™¨ï¼šæ°¸è¿œæœ€åæ‰§è¡Œ
3. å˜é‡å¯è¢«å¤šæ¬¡èµ‹å€¼ï¼šåé¢çš„èµ‹å€¼ä¼šè¦†ç›–å‰é¢çš„å€¼
4. ä¸è¦åœ¨æ„é€ å™¨ä¹‹å‰çš„ä»£ç å—ä¸­è®¿é—®è¿˜æœªå£°æ˜çš„å˜é‡
```

---

## ç»§æ‰¿ä½“ç³»ä¸­çš„åŠ è½½é¡ºåº

### 4.1 å®Œæ•´æ‰§è¡Œé¡ºåºï¼ˆçˆ¶ç±»+å­ç±»ï¼‰

```
é˜¶æ®µ1ï¼šç±»åŠ è½½é˜¶æ®µ
â”œâ”€ 1. åŠ è½½çˆ¶ç±»ï¼ˆå¦‚æœæœªåŠ è½½ï¼‰
â”‚   â”œâ”€ çˆ¶ç±»å‡†å¤‡é˜¶æ®µï¼šé™æ€å˜é‡èµ‹é›¶å€¼
â”‚   â””â”€ çˆ¶ç±»<clinit>ï¼šé™æ€å˜é‡åˆå§‹åŒ–ã€é™æ€ä»£ç å—
â”œâ”€ 2. åŠ è½½å­ç±»
â”‚   â”œâ”€ å­ç±»å‡†å¤‡é˜¶æ®µï¼šé™æ€å˜é‡èµ‹é›¶å€¼
â”‚   â””â”€ å­ç±»<clinit>ï¼šé™æ€å˜é‡åˆå§‹åŒ–ã€é™æ€ä»£ç å—

é˜¶æ®µ2ï¼šå¯¹è±¡åˆ›å»ºé˜¶æ®µï¼ˆnew å­ç±»å¯¹è±¡ï¼‰
â”œâ”€ 1. åœ¨å †ä¸­åˆ†é…å†…å­˜
â”œâ”€ 2. æ‰€æœ‰å®ä¾‹å˜é‡ï¼ˆçˆ¶ç±»+å­ç±»ï¼‰èµ‹é›¶å€¼
â”œâ”€ 3. æ‰§è¡Œçˆ¶ç±»<init>
â”‚   â”œâ”€ çˆ¶ç±»å®ä¾‹å˜é‡åˆå§‹åŒ–
â”‚   â”œâ”€ çˆ¶ç±»å®ä¾‹ä»£ç å—
â”‚   â””â”€ çˆ¶ç±»æ„é€ å™¨
â””â”€ 4. æ‰§è¡Œå­ç±»<init>
    â”œâ”€ å­ç±»å®ä¾‹å˜é‡åˆå§‹åŒ–
    â”œâ”€ å­ç±»å®ä¾‹ä»£ç å—
    â””â”€ å­ç±»æ„é€ å™¨
```

### 4.2 è®°å¿†å£è¯€

```
çˆ¶ç±»é™æ€ â†’ å­ç±»é™æ€ï¼ˆç±»åŠ è½½ï¼Œåªæ‰§è¡Œä¸€æ¬¡ï¼‰
    â†“
çˆ¶ç±»å®ä¾‹ â†’ çˆ¶ç±»æ„é€  â†’ å­ç±»å®ä¾‹ â†’ å­ç±»æ„é€ ï¼ˆå¯¹è±¡åˆ›å»ºï¼Œæ¯æ¬¡newéƒ½æ‰§è¡Œï¼‰
```

### 4.3 è¯¦ç»†ç¤ºä¾‹

```java
class Parent {
    // ç±»åŠ è½½é˜¶æ®µ
    private static int staticParent = getStaticParent();
    static {
        System.out.println("1. çˆ¶ç±»é™æ€ä»£ç å—");
    }
    
    // å¯¹è±¡åˆ›å»ºé˜¶æ®µ
    private int instanceParent = getInstanceParent();
    {
        System.out.println("3. çˆ¶ç±»å®ä¾‹ä»£ç å—");
    }
    
    public Parent() {
        System.out.println("4. çˆ¶ç±»æ„é€ å™¨");
    }
    
    private static int getStaticParent() {
        System.out.println("0. çˆ¶ç±»é™æ€å˜é‡åˆå§‹åŒ–");
        return 1;
    }
    
    private int getInstanceParent() {
        System.out.println("2. çˆ¶ç±»å®ä¾‹å˜é‡åˆå§‹åŒ–");
        return 1;
    }
}

class Child extends Parent {
    // ç±»åŠ è½½é˜¶æ®µ
    private static int staticChild = getStaticChild();
    static {
        System.out.println("6. å­ç±»é™æ€ä»£ç å—");
    }
    
    // å¯¹è±¡åˆ›å»ºé˜¶æ®µ
    private int instanceChild = getInstanceChild();
    {
        System.out.println("8. å­ç±»å®ä¾‹ä»£ç å—");
    }
    
    public Child() {
        System.out.println("9. å­ç±»æ„é€ å™¨");
    }
    
    private static int getStaticChild() {
        System.out.println("5. å­ç±»é™æ€å˜é‡åˆå§‹åŒ–");
        return 1;
    }
    
    private int getInstanceChild() {
        System.out.println("7. å­ç±»å®ä¾‹å˜é‡åˆå§‹åŒ–");
        return 1;
    }
}

// æµ‹è¯•
public class Test {
    public static void main(String[] args) {
        System.out.println("===== ç¬¬ä¸€æ¬¡åˆ›å»ºå¯¹è±¡ =====");
        Child c1 = new Child();
        
        System.out.println("\n===== ç¬¬äºŒæ¬¡åˆ›å»ºå¯¹è±¡ =====");
        Child c2 = new Child();
    }
}

/* è¾“å‡ºç»“æœï¼š
===== ç¬¬ä¸€æ¬¡åˆ›å»ºå¯¹è±¡ =====
0. çˆ¶ç±»é™æ€å˜é‡åˆå§‹åŒ–
1. çˆ¶ç±»é™æ€ä»£ç å—
5. å­ç±»é™æ€å˜é‡åˆå§‹åŒ–
6. å­ç±»é™æ€ä»£ç å—
2. çˆ¶ç±»å®ä¾‹å˜é‡åˆå§‹åŒ–
3. çˆ¶ç±»å®ä¾‹ä»£ç å—
4. çˆ¶ç±»æ„é€ å™¨
7. å­ç±»å®ä¾‹å˜é‡åˆå§‹åŒ–
8. å­ç±»å®ä¾‹ä»£ç å—
9. å­ç±»æ„é€ å™¨

===== ç¬¬äºŒæ¬¡åˆ›å»ºå¯¹è±¡ =====
2. çˆ¶ç±»å®ä¾‹å˜é‡åˆå§‹åŒ–
3. çˆ¶ç±»å®ä¾‹ä»£ç å—
4. çˆ¶ç±»æ„é€ å™¨
7. å­ç±»å®ä¾‹å˜é‡åˆå§‹åŒ–
8. å­ç±»å®ä¾‹ä»£ç å—
9. å­ç±»æ„é€ å™¨
*/
```

### 4.4 æ„é€ å™¨ä¸­çš„super()å’Œthis()

```java
class Parent {
    public Parent() {
        System.out.println("çˆ¶ç±»æ— å‚æ„é€ ");
    }
    
    public Parent(String name) {
        System.out.println("çˆ¶ç±»æœ‰å‚æ„é€ ï¼š" + name);
    }
}

class Child extends Parent {
    {
        System.out.println("å­ç±»å®ä¾‹ä»£ç å—");
    }
    
    public Child() {
        // ç¼–è¯‘å™¨è‡ªåŠ¨æ·»åŠ ï¼šsuper();
        // å®ä¾‹ä»£ç å—å’Œå®ä¾‹å˜é‡åˆå§‹åŒ–åœ¨super()ä¹‹åæ‰§è¡Œ
        System.out.println("å­ç±»æ— å‚æ„é€ ");
    }
    
    public Child(String name) {
        super(name);  // å¿…é¡»æ˜¯ç¬¬ä¸€è¡Œ
        System.out.println("å­ç±»æœ‰å‚æ„é€ ");
    }
    
    public Child(int age) {
        this("Child");  // è°ƒç”¨æœ¬ç±»çš„å…¶ä»–æ„é€ å™¨ï¼Œå¿…é¡»æ˜¯ç¬¬ä¸€è¡Œ
        System.out.println("å­ç±»intæ„é€ ");
    }
}

// è¾“å‡ºåˆ†æï¼š
new Child();
// çˆ¶ç±»æ— å‚æ„é€ 
// å­ç±»å®ä¾‹ä»£ç å—
// å­ç±»æ— å‚æ„é€ 

new Child("Test");
// çˆ¶ç±»æœ‰å‚æ„é€ ï¼šTest
// å­ç±»å®ä¾‹ä»£ç å—
// å­ç±»æœ‰å‚æ„é€ 

new Child(18);
// çˆ¶ç±»æœ‰å‚æ„é€ ï¼šChild
// å­ç±»å®ä¾‹ä»£ç å—
// å­ç±»æœ‰å‚æ„é€ 
// å­ç±»intæ„é€ 
```

**å…³é”®ç‚¹ï¼š**
```
1. super()æˆ–this()å¿…é¡»æ˜¯æ„é€ å™¨çš„ç¬¬ä¸€è¡Œ
2. å®ä¾‹å˜é‡åˆå§‹åŒ–å’Œå®ä¾‹ä»£ç å—åœ¨super()ä¹‹åã€æ„é€ å™¨ä»£ç ä¹‹å‰æ‰§è¡Œ
3. ä¸èƒ½åŒæ—¶ä½¿ç”¨super()å’Œthis()
4. å¦‚æœæ²¡æœ‰æ˜¾å¼è°ƒç”¨super()ï¼Œç¼–è¯‘å™¨ä¼šè‡ªåŠ¨æ·»åŠ super()
```

---

## å®Œæ•´æ‰§è¡Œé¡ºåºæ€»ç»“

### 5.1 å®Œæ•´æµç¨‹å›¾

```
ç¨‹åºå¯åŠ¨/é¦–æ¬¡ä½¿ç”¨ç±»
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç±»åŠ è½½é˜¶æ®µï¼ˆæ¯ä¸ªç±»åªæ‰§è¡Œä¸€æ¬¡ï¼‰   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1. åŠ è½½ï¼ˆLoadingï¼‰              â”‚
â”‚ 2. éªŒè¯ï¼ˆVerificationï¼‰         â”‚
â”‚ 3. å‡†å¤‡ï¼ˆPreparationï¼‰          â”‚
â”‚    â””â”€ é™æ€å˜é‡èµ‹é›¶å€¼ï¼ˆClasså¯¹è±¡ï¼‰â”‚
â”‚ 4. è§£æï¼ˆResolutionï¼‰           â”‚
â”‚ 5. åˆå§‹åŒ–ï¼ˆInitializationï¼‰     â”‚
â”‚    â”œâ”€ çˆ¶ç±»<clinit>ï¼ˆå¦‚æœ‰ï¼‰      â”‚
â”‚    â””â”€ æœ¬ç±»<clinit>             â”‚
â”‚       â”œâ”€ é™æ€å˜é‡æ˜¾å¼åˆå§‹åŒ–      â”‚
â”‚       â””â”€ é™æ€ä»£ç å—             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
åˆ›å»ºå¯¹è±¡ï¼ˆnew/åå°„/å…‹éš†/ååºåˆ—åŒ–ï¼‰
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å¯¹è±¡åˆ›å»ºé˜¶æ®µï¼ˆæ¯ä¸ªå¯¹è±¡éƒ½æ‰§è¡Œï¼‰   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1. åˆ†é…å †å†…å­˜                   â”‚
â”‚ 2. å®ä¾‹å˜é‡èµ‹é›¶å€¼ï¼ˆçˆ¶ç±»+å­ç±»ï¼‰   â”‚
â”‚ 3. è®¾ç½®å¯¹è±¡å¤´                   â”‚
â”‚ 4. æ‰§è¡Œçˆ¶ç±»<init>ï¼ˆå¦‚æœ‰ï¼‰       â”‚
â”‚    â”œâ”€ super()                  â”‚
â”‚    â”œâ”€ çˆ¶ç±»å®ä¾‹å˜é‡åˆå§‹åŒ–        â”‚
â”‚    â”œâ”€ çˆ¶ç±»å®ä¾‹ä»£ç å—            â”‚
â”‚    â””â”€ çˆ¶ç±»æ„é€ å™¨ä»£ç             â”‚
â”‚ 5. æ‰§è¡Œæœ¬ç±»<init>              â”‚
â”‚    â”œâ”€ æœ¬ç±»å®ä¾‹å˜é‡åˆå§‹åŒ–        â”‚
â”‚    â”œâ”€ æœ¬ç±»å®ä¾‹ä»£ç å—            â”‚
â”‚    â””â”€ æœ¬ç±»æ„é€ å™¨ä»£ç             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
å¯¹è±¡åˆ›å»ºå®Œæˆï¼Œè¿”å›å¼•ç”¨
```

### 5.2 ä¼˜å…ˆçº§æ€»ç»“è¡¨

| ä¼˜å…ˆçº§ | æ‰§è¡Œå†…å®¹ | æ‰§è¡Œæ—¶æœº | æ¬¡æ•° |
|--------|---------|----------|------|
| **1** | çˆ¶ç±»é™æ€å˜é‡ã€é™æ€ä»£ç å— | çˆ¶ç±»é¦–æ¬¡åŠ è½½ | 1æ¬¡/ç±» |
| **2** | å­ç±»é™æ€å˜é‡ã€é™æ€ä»£ç å— | å­ç±»é¦–æ¬¡åŠ è½½ | 1æ¬¡/ç±» |
| **3** | çˆ¶ç±»å®ä¾‹å˜é‡ã€å®ä¾‹ä»£ç å— | æ¯æ¬¡åˆ›å»ºå­ç±»å¯¹è±¡ | 1æ¬¡/å¯¹è±¡ |
| **4** | çˆ¶ç±»æ„é€ å™¨ | æ¯æ¬¡åˆ›å»ºå­ç±»å¯¹è±¡ | 1æ¬¡/å¯¹è±¡ |
| **5** | å­ç±»å®ä¾‹å˜é‡ã€å®ä¾‹ä»£ç å— | æ¯æ¬¡åˆ›å»ºå­ç±»å¯¹è±¡ | 1æ¬¡/å¯¹è±¡ |
| **6** | å­ç±»æ„é€ å™¨ | æ¯æ¬¡åˆ›å»ºå­ç±»å¯¹è±¡ | 1æ¬¡/å¯¹è±¡ |

### 5.3 è®°å¿†æŠ€å·§

```
æ¨ªå‘ï¼šé™æ€ â†’ å®ä¾‹ â†’ æ„é€ 
çºµå‘ï¼šçˆ¶ç±» â†’ å­ç±»
æ¬¡æ•°ï¼šé™æ€åªä¸€æ¬¡ï¼Œå®ä¾‹æ¯æ¬¡éƒ½
é¡ºåºï¼šä»£ç å£°æ˜é¡ºåº
```

---

## å†…å­˜åˆ†é…è¯¦è§£

### 6.1 Java 8å‰åçš„å˜åŒ–

#### Java 7åŠä¹‹å‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   å †ï¼ˆHeapï¼‰     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ - æ™®é€šå¯¹è±¡å®ä¾‹   â”‚
â”‚ - Classå¯¹è±¡     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ°¸ä¹…ä»£ï¼ˆPermGenï¼‰â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ - ç±»å…ƒæ•°æ®       â”‚
â”‚ - é™æ€å˜é‡ â­    â”‚
â”‚ - å­—ç¬¦ä¸²å¸¸é‡æ±    â”‚
â”‚ - è¿è¡Œæ—¶å¸¸é‡æ±    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Java 8åŠä¹‹å

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   å †ï¼ˆHeapï¼‰         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ - æ™®é€šå¯¹è±¡å®ä¾‹       â”‚
â”‚ - Classå¯¹è±¡         â”‚
â”‚   â””â”€ é™æ€å˜é‡ â­    â”‚  â† ç§»åˆ°è¿™é‡Œ
â”‚ - å­—ç¬¦ä¸²å¸¸é‡æ±  â­    â”‚  â† ç§»åˆ°è¿™é‡Œ
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å…ƒç©ºé—´ï¼ˆMetaspaceï¼‰  â”‚
â”‚ ï¼ˆæœ¬åœ°å†…å­˜ï¼‰         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ - ç±»å…ƒæ•°æ®           â”‚
â”‚ - è¿è¡Œæ—¶å¸¸é‡æ±        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.2 å„ç±»å˜é‡çš„å­˜å‚¨ä½ç½®ï¼ˆJava 8+ï¼‰

| å˜é‡ç±»å‹ | å˜é‡æœ¬èº«å­˜å‚¨ä½ç½® | å¼•ç”¨çš„å¯¹è±¡å­˜å‚¨ä½ç½® |
|---------|----------------|------------------|
| **é™æ€å˜é‡** | å †ä¸­çš„Classå¯¹è±¡ | å † |
| **å®ä¾‹å˜é‡** | å †ä¸­çš„å¯¹è±¡å®ä¾‹ | å † |
| **å±€éƒ¨å˜é‡** | æ ˆå¸§çš„å±€éƒ¨å˜é‡è¡¨ | å † |

#### ç¤ºä¾‹è¯´æ˜

```java
public class Demo {
    private static String staticStr = "static";  
    // staticStrå¼•ç”¨ â†’ å­˜å‚¨åœ¨å †çš„Classå¯¹è±¡ä¸­
    // "static"å­—ç¬¦ä¸²å¯¹è±¡ â†’ å­˜å‚¨åœ¨å †çš„å­—ç¬¦ä¸²å¸¸é‡æ± 
    
    private String instanceStr = "instance";
    // instanceStrå¼•ç”¨ â†’ å­˜å‚¨åœ¨å †çš„Demoå¯¹è±¡ä¸­
    // "instance"å­—ç¬¦ä¸²å¯¹è±¡ â†’ å­˜å‚¨åœ¨å †çš„å­—ç¬¦ä¸²å¸¸é‡æ± 
    
    public void method() {
        String localStr = "local";
        // localStrå¼•ç”¨ â†’ å­˜å‚¨åœ¨æ ˆå¸§çš„å±€éƒ¨å˜é‡è¡¨
        // "local"å­—ç¬¦ä¸²å¯¹è±¡ â†’ å­˜å‚¨åœ¨å †çš„å­—ç¬¦ä¸²å¸¸é‡æ± 
    }
}
```

### 6.3 å†…å­˜åˆ†é…è¿‡ç¨‹

```
ç±»åŠ è½½æ—¶ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å…ƒç©ºé—´ï¼ˆMetaspaceï¼‰â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Demoç±»å…ƒæ•°æ®      â”‚  â† ç±»çš„ç»“æ„ä¿¡æ¯
â”‚ - å­—æ®µæè¿°ç¬¦      â”‚
â”‚ - æ–¹æ³•æè¿°ç¬¦      â”‚
â”‚ - ...            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å †ï¼ˆHeapï¼‰        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Demo.classå¯¹è±¡   â”‚
â”‚ â”œâ”€ staticStrå¼•ç”¨ â”‚  â† é™æ€å˜é‡
â”‚ â””â”€ å…¶ä»–ç±»ä¿¡æ¯     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

å¯¹è±¡åˆ›å»ºæ—¶ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å †ï¼ˆHeapï¼‰        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Demoå®ä¾‹å¯¹è±¡1    â”‚
â”‚ â””â”€ instanceStrå¼•ç”¨â”‚  â† å®ä¾‹å˜é‡
â”‚                  â”‚
â”‚ Demoå®ä¾‹å¯¹è±¡2    â”‚
â”‚ â””â”€ instanceStrå¼•ç”¨â”‚  â† å®ä¾‹å˜é‡
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## å¸¸è§é™·é˜±ä¸æ³¨æ„äº‹é¡¹

### 7.1 é™æ€å˜é‡åˆå§‹åŒ–é¡ºåºé™·é˜±

#### é™·é˜±1ï¼šå¾ªç¯ä¾èµ–

```java
public class Trap1 {
    private static int a = b + 1;  // âŒ éæ³•å‰å‘å¼•ç”¨
    private static int b = 1;
}

// ç¼–è¯‘é”™è¯¯ï¼šillegal forward reference
```

**è§£å†³æ–¹æ¡ˆï¼š**
```java
public class Trap1Fix {
    private static int b = 1;      // âœ… å…ˆå£°æ˜b
    private static int a = b + 1;  // âœ… å†ä½¿ç”¨b
}
```

#### é™·é˜±2ï¼šé™æ€å˜é‡è¢«è¦†ç›–

```java
public class Trap2 {
    private static Trap2 instance = new Trap2();
    private static int count = 0;  // â† è¦†ç›–æ„é€ å™¨ä¸­çš„ä¿®æ”¹
    
    public Trap2() {
        count++;  // count: 0 â†’ 1
    }
    
    // æœ€ç»ˆcount = 0ï¼ˆè¢«æ˜¾å¼èµ‹å€¼è¦†ç›–ï¼‰
}
```

**è§£å†³æ–¹æ¡ˆï¼š**
```java
public class Trap2Fix {
    private static int count = 0;  // âœ… å…ˆå£°æ˜
    private static Trap2 instance = new Trap2();  // âœ… åä½¿ç”¨
    
    public Trap2Fix() {
        count++;  // count: 0 â†’ 1
    }
    
    // æœ€ç»ˆcount = 1
}
```

### 7.2 å®ä¾‹å˜é‡åˆå§‹åŒ–é™·é˜±

#### é™·é˜±3ï¼šåœ¨æ„é€ å™¨å‰è®¿é—®æœªåˆå§‹åŒ–çš„å˜é‡

```java
public class Trap3 {
    {
        System.out.println(name);  // âŒ è¾“å‡ºnullï¼ˆè€Œé"Unknown"ï¼‰
    }
    
    private String name = "Unknown";
    
    public Trap3() {
        System.out.println(name);  // âœ… è¾“å‡º"Unknown"
    }
}
```

**åŸå› ï¼š** å®ä¾‹ä»£ç å—åœ¨å®ä¾‹å˜é‡æ˜¾å¼åˆå§‹åŒ–ä¹‹å‰æ‰§è¡Œ

### 7.3 ç»§æ‰¿ä¸­çš„é™·é˜±

#### é™·é˜±4ï¼šçˆ¶ç±»æ„é€ å™¨è°ƒç”¨è¢«å­ç±»é‡å†™çš„æ–¹æ³•

```java
class Parent {
    public Parent() {
        show();  // â† è°ƒç”¨çš„æ˜¯å­ç±»çš„show()
    }
    
    public void show() {
        System.out.println("Parent");
    }
}

class Child extends Parent {
    private int value = 10;
    
    @Override
    public void show() {
        System.out.println("Child: " + value);  // âŒ è¾“å‡ºï¼šChild: 0
    }
}

new Child();
// è¾“å‡ºï¼šChild: 0ï¼ˆè€ŒéChild: 10ï¼‰
```

**åŸå› ï¼š**
```
1. çˆ¶ç±»æ„é€ å™¨æ‰§è¡Œæ—¶ï¼Œå­ç±»å®ä¾‹å˜é‡è¿˜æœªåˆå§‹åŒ–ï¼ˆä»æ˜¯é›¶å€¼ï¼‰
2. å¤šæ€å¯¼è‡´è°ƒç”¨çš„æ˜¯å­ç±»çš„show()æ–¹æ³•
3. æ­¤æ—¶value = 0ï¼ˆé›¶å€¼ï¼‰
```

**å»ºè®®ï¼š** é¿å…åœ¨æ„é€ å™¨ä¸­è°ƒç”¨å¯è¢«é‡å†™çš„æ–¹æ³•

### 7.4 å•ä¾‹æ¨¡å¼é™·é˜±

#### é™·é˜±5ï¼šé¥¿æ±‰å¼çš„åˆå§‹åŒ–é¡ºåºé—®é¢˜

```java
public class Singleton {
    private static Singleton instance = new Singleton();
    private static int count1;
    private static int count2 = 0;
    
    {
        count1++;
        count2++;
    }
    
    private Singleton() {}
    
    // æœ€ç»ˆï¼šcount1=1, count2=0
}
```

**æœ€ä½³å®è·µï¼š**
```java
public class SingletonBest {
    private static int count1;
    private static int count2 = 0;
    private static SingletonBest instance = new SingletonBest();
    
    {
        count1++;
        count2++;
    }
    
    private SingletonBest() {}
    
    // æœ€ç»ˆï¼šcount1=1, count2=1
}

// æˆ–ä½¿ç”¨æ‡’æ±‰å¼ï¼ˆæ¨èï¼‰
public class SingletonLazy {
    private static volatile SingletonLazy instance;
    
    private SingletonLazy() {}
    
    public static SingletonLazy getInstance() {
        if (instance == null) {
            synchronized (SingletonLazy.class) {
                if (instance == null) {
                    instance = new SingletonLazy();
                }
            }
        }
        return instance;
    }
}
```

### 7.5 finalå˜é‡çš„ç‰¹æ®Šæ€§

```java
public class FinalTest {
    // ç¼–è¯‘æœŸå¸¸é‡ï¼šç±»åŠ è½½çš„å‡†å¤‡é˜¶æ®µå°±èµ‹å€¼
    public static final int CONST1 = 100;
    public static final String CONST2 = "Hello";
    
    // éç¼–è¯‘æœŸå¸¸é‡ï¼šåˆå§‹åŒ–é˜¶æ®µæ‰èµ‹å€¼
    public static final int CONST3 = new Random().nextInt();
    public static final String CONST4 = new String("World");
}
```

**åŒºåˆ«ï¼š**
```
ç¼–è¯‘æœŸå¸¸é‡ï¼š
  âœ… åœ¨å‡†å¤‡é˜¶æ®µç›´æ¥èµ‹å€¼
  âœ… è®¿é—®æ—¶ä¸ä¼šè§¦å‘ç±»åˆå§‹åŒ–
  âœ… ä¼šè¢«å†…è”åˆ°ä½¿ç”¨çš„åœ°æ–¹

éç¼–è¯‘æœŸå¸¸é‡ï¼š
  âŒ åœ¨åˆå§‹åŒ–é˜¶æ®µæ‰èµ‹å€¼
  âŒ è®¿é—®æ—¶ä¼šè§¦å‘ç±»åˆå§‹åŒ–
  âŒ ä¸ä¼šè¢«å†…è”
```

---

## å®æˆ˜ç¤ºä¾‹

### 8.1 ç»¼åˆç¤ºä¾‹ï¼šå®Œæ•´æ‰§è¡Œé¡ºåº

```java
class GrandParent {
    static {
        System.out.println("1. GrandParenté™æ€ä»£ç å—");
    }
    
    {
        System.out.println("4. GrandParentå®ä¾‹ä»£ç å—");
    }
    
    public GrandParent() {
        System.out.println("5. GrandParentæ„é€ å™¨");
    }
}

class Parent extends GrandParent {
    private static int staticVar = getStaticVar();
    
    static {
        System.out.println("3. Parenté™æ€ä»£ç å—");
    }
    
    private int instanceVar = getInstanceVar();
    
    {
        System.out.println("7. Parentå®ä¾‹ä»£ç å—");
    }
    
    public Parent() {
        System.out.println("8. Parentæ„é€ å™¨");
    }
    
    private static int getStaticVar() {
        System.out.println("2. Parenté™æ€å˜é‡åˆå§‹åŒ–");
        return 1;
    }
    
    private int getInstanceVar() {
        System.out.println("6. Parentå®ä¾‹å˜é‡åˆå§‹åŒ–");
        return 1;
    }
}

class Child extends Parent {
    private static int staticVar = getStaticVar();
    
    static {
        System.out.println("10. Childé™æ€ä»£ç å—");
    }
    
    private int instanceVar = getInstanceVar();
    
    {
        System.out.println("12. Childå®ä¾‹ä»£ç å—");
    }
    
    public Child() {
        System.out.println("13. Childæ„é€ å™¨");
    }
    
    private static int getStaticVar() {
        System.out.println("9. Childé™æ€å˜é‡åˆå§‹åŒ–");
        return 1;
    }
    
    private int getInstanceVar() {
        System.out.println("11. Childå®ä¾‹å˜é‡åˆå§‹åŒ–");
        return 1;
    }
}

public class Test {
    public static void main(String[] args) {
        System.out.println("===== ç¬¬ä¸€æ¬¡åˆ›å»ºå¯¹è±¡ =====");
        new Child();
        
        System.out.println("\n===== ç¬¬äºŒæ¬¡åˆ›å»ºå¯¹è±¡ =====");
        new Child();
    }
}

/* è¾“å‡ºï¼š
===== ç¬¬ä¸€æ¬¡åˆ›å»ºå¯¹è±¡ =====
1. GrandParenté™æ€ä»£ç å—
2. Parenté™æ€å˜é‡åˆå§‹åŒ–
3. Parenté™æ€ä»£ç å—
9. Childé™æ€å˜é‡åˆå§‹åŒ–
10. Childé™æ€ä»£ç å—
4. GrandParentå®ä¾‹ä»£ç å—
5. GrandParentæ„é€ å™¨
6. Parentå®ä¾‹å˜é‡åˆå§‹åŒ–
7. Parentå®ä¾‹ä»£ç å—
8. Parentæ„é€ å™¨
11. Childå®ä¾‹å˜é‡åˆå§‹åŒ–
12. Childå®ä¾‹ä»£ç å—
13. Childæ„é€ å™¨

===== ç¬¬äºŒæ¬¡åˆ›å»ºå¯¹è±¡ =====
4. GrandParentå®ä¾‹ä»£ç å—
5. GrandParentæ„é€ å™¨
6. Parentå®ä¾‹å˜é‡åˆå§‹åŒ–
7. Parentå®ä¾‹ä»£ç å—
8. Parentæ„é€ å™¨
11. Childå®ä¾‹å˜é‡åˆå§‹åŒ–
12. Childå®ä¾‹ä»£ç å—
13. Childæ„é€ å™¨
*/
```

### 8.2 å®æˆ˜ï¼šå•ä¾‹æ¨¡å¼çš„æ­£ç¡®å†™æ³•

```java
/**
 * æ–¹å¼1ï¼šé¥¿æ±‰å¼ï¼ˆçº¿ç¨‹å®‰å…¨ï¼Œæ¨èç”¨äºç®€å•åœºæ™¯ï¼‰
 */
public class Singleton1 {
    // ç±»åŠ è½½æ—¶å°±åˆ›å»ºå®ä¾‹
    private static final Singleton1 INSTANCE = new Singleton1();
    
    private Singleton1() {}
    
    public static Singleton1 getInstance() {
        return INSTANCE;
    }
}

/**
 * æ–¹å¼2ï¼šæ‡’æ±‰å¼ - åŒé‡æ£€æŸ¥é”ï¼ˆæ¨èï¼‰
 */
public class Singleton2 {
    // volatileé˜²æ­¢æŒ‡ä»¤é‡æ’åº
    private static volatile Singleton2 instance;
    
    private Singleton2() {}
    
    public static Singleton2 getInstance() {
        if (instance == null) {  // ç¬¬ä¸€æ¬¡æ£€æŸ¥
            synchronized (Singleton2.class) {
                if (instance == null) {  // ç¬¬äºŒæ¬¡æ£€æŸ¥
                    instance = new Singleton2();
                }
            }
        }
        return instance;
    }
}

/**
 * æ–¹å¼3ï¼šé™æ€å†…éƒ¨ç±»ï¼ˆæ¨èï¼Œæœ€ä¼˜é›…ï¼‰
 */
public class Singleton3 {
    private Singleton3() {}
    
    // é™æ€å†…éƒ¨ç±»åªæœ‰åœ¨è¢«ä½¿ç”¨æ—¶æ‰ä¼šåŠ è½½
    private static class Holder {
        private static final Singleton3 INSTANCE = new Singleton3();
    }
    
    public static Singleton3 getInstance() {
        return Holder.INSTANCE;  // è§¦å‘Holderç±»åŠ è½½
    }
}

/**
 * æ–¹å¼4ï¼šæšä¸¾ï¼ˆæœ€å®‰å…¨ï¼Œé˜²æ­¢åå°„å’Œåºåˆ—åŒ–æ”»å‡»ï¼‰
 */
public enum Singleton4 {
    INSTANCE;
    
    public void doSomething() {
        // ä¸šåŠ¡æ–¹æ³•
    }
}
```

### 8.3 æ€§èƒ½ä¼˜åŒ–å»ºè®®

```java
// âŒ ä¸å¥½çš„åšæ³•ï¼šç±»åŠ è½½æ—¶åšå¤§é‡åˆå§‹åŒ–
public class BadPractice {
    private static final List<String> DATA = loadHugeData();
    
    private static List<String> loadHugeData() {
        // è€—æ—¶æ“ä½œï¼Œå³ä½¿ä¸ä½¿ç”¨ä¹Ÿä¼šæ‰§è¡Œ
        return loadFromDatabase();
    }
}

// âœ… å¥½çš„åšæ³•ï¼šå»¶è¿Ÿåˆå§‹åŒ–
public class GoodPractice {
    private static volatile List<String> data;
    
    public static List<String> getData() {
        if (data == null) {
            synchronized (GoodPractice.class) {
                if (data == null) {
                    data = loadHugeData();
                }
            }
        }
        return data;
    }
    
    private static List<String> loadHugeData() {
        return loadFromDatabase();
    }
}
```

---

