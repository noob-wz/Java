<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Javaç±»åŠ è½½ä¸å¯¹è±¡åˆå§‹åŒ– - å¯è§†åŒ–æ¼”ç¤ºç³»ç»Ÿï¼ˆInstanceKlass / Class / Klass Pointer å…³è”ç‰ˆï¼‰</title>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;500;600;700&family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-dark: #0d1117;
            --bg-darker: #010409;
            --bg-card: #161b22;
            --bg-elevated: #1c2128;
            --border-subtle: #30363d;
            --border-muted: #21262d;

            --text-primary: #e6edf3;
            --text-secondary: #8b949e;
            --text-muted: #6e7681;

            --accent-blue: #58a6ff;
            --accent-purple: #bc8cff;
            --accent-green: #3fb950;
            --accent-orange: #f78166;
            --accent-yellow: #d29922;
            --accent-red: #ff7b72;

            --shadow-sm: 0 0 0 1px var(--border-subtle);
            --shadow-md: 0 3px 6px rgba(0,0,0,0.3);
            --shadow-lg: 0 8px 24px rgba(0,0,0,0.5);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-darker);
            color: var(--text-primary);
            line-height: 1.6;
            overflow-x: hidden;
        }

        /* Header Section */
        .header {
            background: linear-gradient(180deg, var(--bg-dark) 0%, var(--bg-darker) 100%);
            border-bottom: 1px solid var(--border-subtle);
            padding: 2rem 0;
            position: sticky;
            top: 0;
            z-index: 100;
            backdrop-filter: blur(10px);
        }

        .header-content {
            max-width: 1600px;
            margin: 0 auto;
            padding: 0 2rem;
        }

        .title-section { text-align: center; margin-bottom: 2rem; }

        h1 {
            font-size: 2.5rem;
            font-weight: 900;
            background: linear-gradient(120deg, var(--accent-blue), var(--accent-purple));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 0.5rem;
            letter-spacing: -0.02em;
        }

        .subtitle { color: var(--text-secondary); font-size: 1rem; }

        .legend {
            margin-top: 0.75rem;
            display: flex;
            justify-content: center;
            gap: 0.75rem;
            flex-wrap: wrap;
            color: var(--text-secondary);
            font-size: 0.85rem;
        }
        .legend-item {
            display: flex;
            align-items: center;
            gap: 0.35rem;
            padding: 0.25rem 0.6rem;
            border-radius: 999px;
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
        }
        .legend-icon { font-size: 0.95rem; }

        /* Control Panel */
        .control-panel {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 0;
        }

        .controls-row {
            display: grid;
            grid-template-columns: auto 1fr auto;
            gap: 2rem;
            align-items: center;
        }

        .btn-group { display: flex; gap: 0.5rem; }

        button {
            background: var(--bg-elevated);
            color: var(--text-primary);
            border: 1px solid var(--border-subtle);
            padding: 0.625rem 1.25rem;
            border-radius: 6px;
            font-family: 'Inter', sans-serif;
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        button:hover:not(:disabled) {
            background: var(--bg-dark);
            border-color: var(--accent-blue);
        }

        button:disabled { opacity: 0.5; cursor: not-allowed; }

        .btn-primary {
            background: var(--accent-blue);
            color: var(--bg-dark);
            border-color: var(--accent-blue);
        }

        .btn-primary:hover:not(:disabled) { background: #4493e6; border-color: #4493e6; }

        /* Progress Section */
        .progress-section { flex: 1; }

        .progress-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
            font-size: 0.875rem;
        }

        .current-phase { color: var(--accent-blue); font-weight: 600; }
        .step-count { color: var(--text-muted); }

        .progress-bar {
            height: 6px;
            background: var(--bg-elevated);
            border-radius: 3px;
            overflow: hidden;
            position: relative;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-blue), var(--accent-purple));
            transition: width 0.3s ease;
            box-shadow: 0 0 10px rgba(88, 166, 255, 0.5);
        }

        .timeline { margin-top: 0.75rem; position: relative; height: 24px; }
        .timeline-track {
            position: absolute; top: 50%; transform: translateY(-50%);
            width: 100%; height: 2px; background: var(--border-subtle);
        }
        .timeline-markers { position: relative; display: flex; justify-content: space-between; width: 100%; }

        .timeline-marker {
            width: 12px; height: 12px; border-radius: 50%;
            background: var(--bg-elevated);
            border: 2px solid var(--border-subtle);
            cursor: pointer; transition: all 0.2s; position: relative;
        }

        .timeline-marker:hover { transform: scale(1.3); border-color: var(--accent-blue); }
        .timeline-marker.completed { background: var(--accent-green); border-color: var(--accent-green); }
        .timeline-marker.active {
            background: var(--accent-blue);
            border-color: var(--accent-blue);
            box-shadow: 0 0 0 4px rgba(88, 166, 255, 0.2);
            transform: scale(1.5);
        }
        .timeline-marker.key-point::after {
            content: 'â­'; position: absolute; top: -20px; left: 50%;
            transform: translateX(-50%); font-size: 10px;
        }

        /* Main Content */
        .main-container { max-width: 1600px; margin: 0 auto; padding: 2rem; }
        .content-grid { display: grid; grid-template-columns: 600px 1fr; gap: 2rem; margin-bottom: 2rem; }

        /* Code Panel */
        .code-panel {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 12px;
            overflow: hidden;
            position: sticky;
            top: 180px;
            height: fit-content;
            max-height: calc(100vh - 200px);
            display: flex;
            flex-direction: column;
        }

        .code-header {
            background: var(--bg-elevated);
            padding: 1rem 1.5rem;
            border-bottom: 1px solid var(--border-subtle);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .window-controls { display: flex; gap: 0.5rem; }
        .window-btn { width: 12px; height: 12px; border-radius: 50%; }
        .btn-close { background: #ff5f56; }
        .btn-minimize { background: #ffbd2e; }
        .btn-maximize { background: #27c93f; }

        .file-name {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.875rem;
            color: var(--text-secondary);
            margin-left: auto;
        }

        .code-content {
            overflow-y: auto;
            padding: 1.5rem;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.875rem;
            line-height: 1.8;
            flex: 1;
        }

        .code-line {
            display: flex;
            padding: 0.25rem 0.75rem;
            border-radius: 4px;
            transition: all 0.3s ease;
            position: relative;
        }

        .line-num {
            color: var(--text-muted);
            width: 3rem;
            text-align: right;
            user-select: none;
            flex-shrink: 0;
            padding-right: 1.5rem;
        }

        .line-code { color: var(--text-primary); white-space: pre; }

        .code-line.active {
            background: rgba(88, 166, 255, 0.15);
            border-left: 3px solid var(--accent-blue);
            box-shadow: 0 0 20px rgba(88, 166, 255, 0.1);
            margin-left: -0.75rem;
            padding-left: calc(0.75rem - 3px);
        }

        .code-line.active::before {
            content: 'â–¶';
            position: absolute;
            left: -1.5rem;
            color: var(--accent-blue);
            font-size: 0.75rem;
            animation: blink 1s ease-in-out infinite;
        }

        @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0.3; } }
        .code-line.executed { opacity: 0.4; }

        /* Memory Visualization */
        .memory-container { display: flex; flex-direction: column; gap: 1.5rem; }

        .memory-region {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 12px;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .memory-region.highlight {
            border-color: var(--accent-blue);
            box-shadow: 0 0 0 1px var(--accent-blue), 0 4px 12px rgba(88, 166, 255, 0.2);
        }

        .region-header {
            background: var(--bg-elevated);
            padding: 1rem 1.5rem;
            border-bottom: 1px solid var(--border-subtle);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .region-title {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-weight: 600;
            font-size: 1rem;
        }

        .region-icon {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.125rem;
        }

        .icon-metaspace { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .icon-heap { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); }
        .icon-stack { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); }

        .region-badge {
            font-size: 0.75rem;
            padding: 0.25rem 0.75rem;
            border-radius: 12px;
            background: var(--bg-dark);
            color: var(--text-muted);
            font-weight: 500;
        }

        .region-content { padding: 1.5rem; min-height: 120px; }
        .empty-message { text-align: center; color: var(--text-muted); padding: 2rem; font-size: 0.875rem; }

        /* Memory Objects */
        .meta-klass {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.12) 0%, rgba(118, 75, 162, 0.12) 100%);
            border: 2px solid rgba(102, 126, 234, 0.35);
            border-radius: 8px;
            padding: 1.25rem;
            margin-bottom: 1rem;
            position: relative;
            overflow: hidden;
        }
        .meta-klass::before {
            content: '';
            position: absolute; top: 0; left: 0; width: 4px; height: 100%;
            background: linear-gradient(180deg, #667eea, #764ba2);
        }

        .class-object {
            background: linear-gradient(135deg, rgba(240, 147, 251, 0.1) 0%, rgba(245, 87, 108, 0.1) 100%);
            border: 2px solid rgba(240, 147, 251, 0.3);
            border-radius: 8px;
            padding: 1.25rem;
            margin-bottom: 1rem;
            position: relative;
            overflow: hidden;
        }

        .class-object::before {
            content: '';
            position: absolute; top: 0; left: 0; width: 4px; height: 100%;
            background: linear-gradient(180deg, #f093fb, #f5576c);
        }

        .object-instance {
            background: linear-gradient(135deg, rgba(79, 172, 254, 0.1) 0%, rgba(0, 242, 254, 0.1) 100%);
            border: 2px solid rgba(79, 172, 254, 0.3);
            border-radius: 8px;
            padding: 1.25rem;
            margin-bottom: 1rem;
            position: relative;
            overflow: hidden;
        }

        .object-instance::before {
            content: '';
            position: absolute; top: 0; left: 0; width: 4px; height: 100%;
            background: linear-gradient(180deg, #4facfe, #00f2fe);
        }

        .object-header {
            font-family: 'JetBrains Mono', monospace;
            font-weight: 600;
            color: var(--accent-purple);
            margin-bottom: 1rem;
            font-size: 0.9375rem;
        }

        .memory-item {
            padding: 0.75rem 1rem;
            background: var(--bg-elevated);
            border-radius: 6px;
            margin-bottom: 0.5rem;
            display: grid;
            grid-template-columns: 1fr 1fr auto;
            gap: 1rem;
            align-items: center;
            border-left: 3px solid transparent;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            opacity: 0;
            transform: translateX(-10px);
        }

        .memory-item.appear { opacity: 1; transform: translateX(0); }

        .memory-item.new { border-left-color: var(--accent-green); animation: flash-green 0.6s ease; }
        .memory-item.modified { border-left-color: var(--accent-orange); animation: flash-orange 0.6s ease; }

        @keyframes flash-green { 0%, 100% { background: var(--bg-elevated); } 50% { background: rgba(63, 185, 80, 0.2); } }
        @keyframes flash-orange { 0%, 100% { background: var(--bg-elevated); } 50% { background: rgba(247, 129, 102, 0.2); } }

        .item-name { font-family: 'JetBrains Mono', monospace; font-weight: 500; color: var(--accent-blue); font-size: 0.875rem; white-space: nowrap; }
        .item-value { font-family: 'JetBrains Mono', monospace; color: var(--text-primary); font-size: 0.875rem; text-align: center; white-space: nowrap; }
        .item-type { color: var(--text-muted); font-size: 0.75rem; text-align: right; white-space: nowrap; }

        .stack-frame {
            background: var(--bg-elevated);
            border-radius: 6px;
            padding: 1rem;
            margin-bottom: 0.5rem;
            border-left: 3px solid var(--accent-blue);
            transition: all 0.4s ease;
            opacity: 0;
            transform: translateY(-10px);
        }

        .stack-frame.appear { opacity: 1; transform: translateY(0); }
        .stack-frame.new { animation: flash-blue 0.6s ease; }

        @keyframes flash-blue { 0%, 100% { background: var(--bg-elevated); } 50% { background: rgba(88, 166, 255, 0.2); } }

        .frame-name { font-family: 'JetBrains Mono', monospace; font-weight: 500; color: var(--accent-blue); margin-bottom: 0.25rem; }
        .frame-detail { color: var(--text-secondary); font-size: 0.875rem; }

        /* Description Panel */
        .description-panel {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 12px;
            padding: 2rem;
        }

        .phase-header { display: flex; align-items: center; gap: 1rem; margin-bottom: 1.5rem; }

        .phase-number {
            width: 48px; height: 48px; border-radius: 12px;
            background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple));
            color: white; display: flex; align-items: center; justify-content: center;
            font-weight: 700; font-size: 1.25rem;
        }

        .phase-title {
            font-size: 1.75rem;
            font-weight: 700;
            background: linear-gradient(120deg, var(--accent-blue), var(--accent-purple));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .phase-description {
            color: var(--text-secondary);
            font-size: 1rem;
            line-height: 1.7;
            margin-bottom: 1.5rem;
        }

        .phase-details {
            background: var(--bg-elevated);
            border-radius: 8px;
            padding: 1.5rem;
            border-left: 3px solid var(--accent-blue);
        }

        .detail-list { list-style: none; }
        .detail-list li { padding: 0.5rem 0; color: var(--text-secondary); position: relative; padding-left: 1.5rem; }
        .detail-list li::before { content: 'â†’'; position: absolute; left: 0; color: var(--accent-blue); font-weight: bold; }

        /* Settings Panel */
        .settings { display: flex; align-items: center; gap: 1rem; }
        .setting-label { color: var(--text-secondary); font-size: 0.875rem; }

        select {
            background: var(--bg-elevated);
            color: var(--text-primary);
            border: 1px solid var(--border-subtle);
            padding: 0.5rem 1rem;
            border-radius: 6px;
            font-family: 'Inter', sans-serif;
            font-size: 0.875rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        select:hover { border-color: var(--accent-blue); }
        select:focus { outline: none; border-color: var(--accent-blue); }

        /* Scrollbar */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: var(--bg-elevated); }
        ::-webkit-scrollbar-thumb { background: var(--border-subtle); border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--text-muted); }

        /* Tooltip */
        .tooltip { position: relative; }
        .tooltip::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: var(--bg-dark);
            color: var(--text-primary);
            padding: 0.5rem 0.75rem;
            border-radius: 6px;
            font-size: 0.75rem;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.2s;
            margin-bottom: 0.5rem;
            box-shadow: var(--shadow-lg);
        }
        .tooltip:hover::after { opacity: 1; }

        /* SVG Arrows */
        #connectionSvg {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            pointer-events: none;
            z-index: 80;
        }
        .arrow {
            fill: none;
            stroke: var(--accent-blue);
            stroke-width: 2;
            opacity: 0;
            transition: opacity 0.35s ease;
        }
        .arrow.visible { opacity: 0.65; }
        .arrow-label {
            fill: var(--accent-blue);
            font-size: 12px;
            font-weight: 700;
            opacity: 0;
            transition: opacity 0.35s ease;
        }
        .arrow-label.visible { opacity: 1; }

        /* Responsive */
        @media (max-width: 1400px) {
            .content-grid { grid-template-columns: 1fr; }
            .code-panel { position: relative; top: 0; max-height: 600px; }
        }
    </style>
</head>
<body>
<header class="header">
    <div class="header-content">
        <div class="title-section">
            <h1>Java ç±»åŠ è½½ä¸å¯¹è±¡åˆå§‹åŒ–å¯è§†åŒ–</h1>
            <p class="subtitle">âœ… å·²å…³è”ï¼šInstanceKlassï¼ˆå…ƒç©ºé—´ï¼‰ â†” Classå¯¹è±¡ï¼ˆå †ï¼‰ â†” å®ä¾‹å¯¹è±¡å¤´Klass Pointer</p>
            <div class="legend">
                <div class="legend-item"><span class="legend-icon">âœ…</span>å·²å»ºç«‹/å·²å®Œæˆ</div>
                <div class="legend-item"><span class="legend-icon">ğŸ”—</span>ç¬¦å·å¼•ç”¨</div>
                <div class="legend-item"><span class="legend-icon">â³</span>æœªå»ºç«‹/æœªåˆ†é…</div>
            </div>
        </div>

        <div class="control-panel">
            <div class="controls-row">
                <div class="btn-group">
                    <button id="resetBtn" class="tooltip" data-tooltip="é‡ç½®åˆ°å¼€å§‹ (R)">
                        <span>â†º</span>
                    </button>
                    <button id="prevBtn" class="tooltip" data-tooltip="ä¸Šä¸€æ­¥ (â†)">
                        <span>â—€</span>
                    </button>
                    <button id="playBtn" class="btn-primary tooltip" data-tooltip="æ’­æ”¾/æš‚åœ (Space)">
                        <span id="playIcon">â–¶</span>
                        <span id="playText">æ’­æ”¾</span>
                    </button>
                    <button id="nextBtn" class="tooltip" data-tooltip="ä¸‹ä¸€æ­¥ (â†’)">
                        <span>â–¶</span>
                    </button>
                </div>

                <div class="progress-section">
                    <div class="progress-info">
                        <span class="current-phase" id="currentPhase">å‡†å¤‡å¼€å§‹</span>
                        <span class="step-count" id="stepCount">æ­¥éª¤ 0/21</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill"></div>
                    </div>
                    <div class="timeline">
                        <div class="timeline-track"></div>
                        <div class="timeline-markers" id="timelineMarkers"></div>
                    </div>
                </div>

                <div class="settings">
                    <span class="setting-label">æ’­æ”¾é€Ÿåº¦</span>
                    <select id="speedSelect">
                        <option value="2000">æ…¢é€Ÿ</option>
                        <option value="1200" selected>æ­£å¸¸</option>
                        <option value="600">å¿«é€Ÿ</option>
                        <option value="300">æé€Ÿ</option>
                    </select>
                </div>
            </div>
        </div>
    </div>
</header>

<main class="main-container">
    <div class="content-grid">
        <div class="code-panel">
            <div class="code-header">
                <div class="window-controls">
                    <div class="window-btn btn-close"></div>
                    <div class="window-btn btn-minimize"></div>
                    <div class="window-btn btn-maximize"></div>
                </div>
                <span class="file-name">UltimateBlock.java</span>
            </div>
            <div class="code-content" id="codeContent"></div>
        </div>

        <div class="memory-container">
            <div class="memory-region" id="metaspaceRegion">
                <div class="region-header">
                    <div class="region-title">
                        <div class="region-icon icon-metaspace">ğŸ“¦</div>
                        <span>å…ƒç©ºé—´ (Metaspace)</span>
                    </div>
                    <span class="region-badge">Klass / InstanceKlass</span>
                </div>
                <div class="region-content" id="metaspaceContent">
                    <div class="empty-message">ç­‰å¾…ç±»åŠ è½½...</div>
                </div>
            </div>

            <div class="memory-region" id="heapRegion">
                <div class="region-header">
                    <div class="region-title">
                        <div class="region-icon icon-heap">ğŸ’</div>
                        <span>å † (Heap)</span>
                    </div>
                    <span class="region-badge">Classå¯¹è±¡ / å®ä¾‹</span>
                </div>
                <div class="region-content" id="heapContent">
                    <div class="empty-message">ç­‰å¾…å¯¹è±¡åˆ›å»º...</div>
                </div>
            </div>

            <div class="memory-region" id="stackRegion">
                <div class="region-header">
                    <div class="region-title">
                        <div class="region-icon icon-stack">ğŸ“š</div>
                        <span>æ ˆ (Stack)</span>
                    </div>
                    <span class="region-badge">çº¿ç¨‹ç§æœ‰</span>
                </div>
                <div class="region-content" id="stackContent">
                    <div class="empty-message">ç­‰å¾…æ–¹æ³•è°ƒç”¨...</div>
                </div>
            </div>
        </div>
    </div>

    <div class="description-panel">
        <div class="phase-header">
            <div class="phase-number" id="phaseNumber">0</div>
            <h2 class="phase-title" id="phaseTitle">å‡†å¤‡å¼€å§‹æ¼”ç¤º</h2>
        </div>
        <p class="phase-description" id="phaseDescription">
            ç‚¹å‡»"æ’­æ”¾"æŒ‰é’®å¼€å§‹æ¼”ç¤ºå®Œæ•´çš„Javaç±»åŠ è½½å’Œå¯¹è±¡åˆå§‹åŒ–è¿‡ç¨‹ã€‚ä½ å°†çœ‹åˆ°å†…å­˜çš„å®æ—¶å˜åŒ–ã€ä»£ç çš„æ‰§è¡Œæµç¨‹ï¼Œä»¥åŠå…³é”®æ¦‚å¿µçš„è¯¦ç»†è§£é‡Šã€‚
        </p>
        <div class="phase-details">
            <ul class="detail-list" id="detailList">
                <li>è·Ÿè¸ªä»£ç æ‰§è¡Œçš„æ¯ä¸€æ­¥</li>
                <li>è§‚å¯Ÿä¸‰å¤§å†…å­˜åŒºåŸŸçš„å˜åŒ–</li>
                <li>ç†è§£é™æ€åˆå§‹åŒ–ä¸å®ä¾‹åˆå§‹åŒ–çš„é¡ºåº</li>
                <li>æŒæ¡ &lt;clinit&gt; ä¸ &lt;init&gt; çš„åµŒå¥—æ‰§è¡Œ</li>
                <li>âœ… çœ‹æ¸…ï¼šå®ä¾‹å¯¹è±¡å¤´çš„ Klass Pointer æŒ‡å‘ InstanceKlassï¼ˆå…ƒç©ºé—´ï¼‰</li>
                <li>âœ… çœ‹æ¸…ï¼šjava.lang.Class æ˜¯ InstanceKlass çš„ mirrorï¼ˆå †ä¸­ï¼‰</li>
                <li>âœ… å›¾ä¾‹ï¼šâœ…å·²å»ºç«‹ ğŸ”—ç¬¦å·å¼•ç”¨ â³æœªå»ºç«‹/æœªåˆ†é…ï¼ˆHotSpotè§†è§’ï¼‰</li>
            </ul>
        </div>
    </div>
</main>

<!-- SVGï¼šç”¨äºç”»å…³è”ç®­å¤´ -->
<svg id="connectionSvg">
    <defs>
        <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
            <polygon points="0 0, 10 3, 0 6" fill="var(--accent-blue)"></polygon>
        </marker>
    </defs>
</svg>

<script>
    // Javaæºä»£ç 
    const sourceCode = `public class UltimateBlock {

// 1. é™æ€å˜é‡ singleton
private static UltimateBlock singleton = new UltimateBlock();

// 2. é™æ€å˜é‡ count1
public static int count1;

// 3. é™æ€å˜é‡ count2
public static int count2 = 0;

// 4. å®ä¾‹ä»£ç å—
{
    count1++;
    count2++;
}

// 5. æ„é€ å™¨
private UltimateBlock() {
    // æ„é€ å™¨ä»£ç 
}

// 6. é™æ€æ–¹æ³•
public static UltimateBlock getInstance() {
    return singleton;
}

public static void main(String[] args) {
    UltimateBlock obj = UltimateBlock.getInstance();
    System.out.println("count1=" + obj.count1);
    System.out.println("count2=" + obj.count2);
}
}`;

    /**
     * âœ… å…³é”®ï¼šç»Ÿä¸€ id è®©ç®­å¤´èƒ½â€œè¿èµ·æ¥â€
     * metaspace: "UltimateBlock.InstanceKlass"
     * heap class: "UltimateBlock.class"
     * heap instance: "UltimateBlock@instance"
     */
    const IDS = {
        IK: "UltimateBlock.InstanceKlass",
        CLS: "UltimateBlock.class",
        INS: "UltimateBlock@instance"
    };

    // InstanceKlass å„é˜¶æ®µçŠ¶æ€ï¼ˆHotSpotè§†è§’ï¼‰
    const mkField = (name, value, fieldType, status = '') => ({ name, value, fieldType, status });
    const IK_STATE = {
        loading: [
            mkField("_super", "ğŸ”— Objectï¼ˆç¬¦å·å¼•ç”¨ï¼‰", "Klass Symbol", "new"),
            mkField("_interfaces", "âœ… []", "Array<Klass*>", "new"),
            mkField("_fields", "âœ… [singleton, count1, count2]", "Array<FieldInfo>", "new"),
            mkField("_methods", "âœ… [<clinit>, <init>, main, ...]", "Array<Method*>", "new"),
            mkField("_constant_pool", "âœ… å·²åŠ è½½ï¼ˆç¬¦å·å¼•ç”¨ä¸ºä¸»ï¼‰", "ConstantPool", "new"),
            mkField("vtable/itable", "â³ æœªå»ºç«‹", "Dispatch Tables", "new"),
            mkField("field_layout", "â³ æœªè®¡ç®—", "Layout", "new"),
            mkField("mirror", "âœ… â†” UltimateBlock.class", "oop (mirror)", "new"),
            mkField("state", "å·²åŠ è½½", "LinkState", "new")
        ],
        verified: [
            mkField("_super", "ğŸ”— Objectï¼ˆç¬¦å·å¼•ç”¨ï¼‰", "Klass Symbol"),
            mkField("_interfaces", "âœ… []", "Array<Klass*>"),
            mkField("_fields", "âœ… [singleton, count1, count2]", "Array<FieldInfo>"),
            mkField("_methods", "âœ… [<clinit>, <init>, main, ...]", "Array<Method*>"),
            mkField("_constant_pool", "âœ… å·²åŠ è½½ï¼ˆç¬¦å·å¼•ç”¨ä¸ºä¸»ï¼‰", "ConstantPool"),
            mkField("vtable/itable", "â³ æœªå»ºç«‹", "Dispatch Tables"),
            mkField("field_layout", "â³ æœªè®¡ç®—", "Layout"),
            mkField("mirror", "âœ… â†” UltimateBlock.class", "oop (mirror)"),
            mkField("verify", "âœ… é€šè¿‡", "Verifier", "modified"),
            mkField("state", "å·²éªŒè¯", "LinkState", "modified")
        ],
        prepared: [
            mkField("_super", "ğŸ”— Objectï¼ˆç¬¦å·å¼•ç”¨ï¼‰", "Klass Symbol"),
            mkField("_interfaces", "âœ… []", "Array<Klass*>"),
            mkField("_fields", "âœ… [singleton, count1, count2]", "Array<FieldInfo>"),
            mkField("_methods", "âœ… [<clinit>, <init>, main, ...]", "Array<Method*>"),
            mkField("_constant_pool", "âœ… å·²åŠ è½½ï¼ˆç¬¦å·å¼•ç”¨ä¸ºä¸»ï¼‰", "ConstantPool"),
            mkField("vtable/itable", "â³ æœªå»ºç«‹", "Dispatch Tables"),
            mkField("field_layout", "âœ… å·²è®¡ç®—", "Layout", "modified"),
            mkField("mirror", "âœ… â†” UltimateBlock.class", "oop (mirror)"),
            mkField("state", "å‡†å¤‡å®Œæˆ", "LinkState", "modified")
        ],
        resolved: [
            mkField("_super", "âœ… â†’ Object.InstanceKlass", "Klass*", "modified"),
            mkField("_interfaces", "âœ… []", "Array<Klass*>"),
            mkField("_fields", "âœ… [singleton, count1, count2]", "Array<FieldInfo>"),
            mkField("_methods", "âœ… [<clinit>, <init>, main, ...]", "Array<Method*>"),
            mkField("_constant_pool", "âœ… éƒ¨åˆ†å·²è§£æä¸ºç›´æ¥å¼•ç”¨", "ConstantPool", "modified"),
            mkField("vtable/itable", "âœ… å·²æ„å»º", "Dispatch Tables", "modified"),
            mkField("field_layout", "âœ… å·²è®¡ç®—", "Layout"),
            mkField("mirror", "âœ… â†” UltimateBlock.class", "oop (mirror)"),
            mkField("resolve", "å®Œæˆ âœ“", "Linker", "modified"),
            mkField("state", "è§£æå®Œæˆ", "LinkState", "modified")
        ],
        initRunning: [
            mkField("_super", "âœ… â†’ Object.InstanceKlass", "Klass*"),
            mkField("_interfaces", "âœ… []", "Array<Klass*>"),
            mkField("_fields", "âœ… [singleton, count1, count2]", "Array<FieldInfo>"),
            mkField("_methods", "âœ… [<clinit>, <init>, main, ...]", "Array<Method*>"),
            mkField("_constant_pool", "âœ… å·²è§£æä¸ºç›´æ¥å¼•ç”¨", "ConstantPool"),
            mkField("vtable/itable", "âœ… å·²æ„å»º", "Dispatch Tables"),
            mkField("field_layout", "âœ… å·²è®¡ç®—", "Layout"),
            mkField("mirror", "âœ… â†” UltimateBlock.class", "oop (mirror)"),
            mkField("init", "<clinit> æ‰§è¡Œä¸­â€¦", "InitState", "modified"),
            mkField("state", "åˆå§‹åŒ–ä¸­", "InitState", "modified")
        ],
        initPaused: [
            mkField("_super", "âœ… â†’ Object.InstanceKlass", "Klass*"),
            mkField("_interfaces", "âœ… []", "Array<Klass*>"),
            mkField("_fields", "âœ… [singleton, count1, count2]", "Array<FieldInfo>"),
            mkField("_methods", "âœ… [<clinit>, <init>, main, ...]", "Array<Method*>"),
            mkField("_constant_pool", "âœ… å·²è§£æä¸ºç›´æ¥å¼•ç”¨", "ConstantPool"),
            mkField("vtable/itable", "âœ… å·²æ„å»º", "Dispatch Tables"),
            mkField("field_layout", "âœ… å·²è®¡ç®—", "Layout"),
            mkField("mirror", "âœ… â†” UltimateBlock.class", "oop (mirror)"),
            mkField("init", "<clinit> æš‚åœ", "InitState", "modified"),
            mkField("state", "åˆå§‹åŒ–ä¸­", "InitState", "modified")
        ],
        initialized: [
            mkField("_super", "âœ… â†’ Object.InstanceKlass", "Klass*"),
            mkField("_interfaces", "âœ… []", "Array<Klass*>"),
            mkField("_fields", "âœ… [singleton, count1, count2]", "Array<FieldInfo>"),
            mkField("_methods", "âœ… [<clinit>, <init>, main, ...]", "Array<Method*>"),
            mkField("_constant_pool", "âœ… å·²è§£æä¸ºç›´æ¥å¼•ç”¨", "ConstantPool"),
            mkField("vtable/itable", "âœ… å·²æ„å»º", "Dispatch Tables"),
            mkField("field_layout", "âœ… å·²è®¡ç®—", "Layout"),
            mkField("mirror", "âœ… â†” UltimateBlock.class", "oop (mirror)"),
            mkField("state", "åˆå§‹åŒ–å®Œæˆ âœ“", "InitState", "modified")
        ]
    };

    // æ¼”ç¤ºæ­¥éª¤é…ç½®ï¼ˆåœ¨ä½ åŸ steps çš„åŸºç¡€ä¸Šï¼šè¡¥äº† InstanceKlass / mirror / Klass Pointer / arrowsï¼‰
    const steps = [
        {
            line: 0,
            phase: "ç¨‹åºå¯åŠ¨",
            description: "JVMå¯åŠ¨ï¼Œå‡†å¤‡æ‰§è¡Œmainæ–¹æ³•ã€‚æ­¤æ—¶éœ€è¦å…ˆåŠ è½½UltimateBlockç±»ã€‚",
            keyPoint: true,
            details: [
                "JVMå®Œæˆåˆå§‹åŒ–",
                "å‡†å¤‡æ‰§è¡Œä¸»ç±»çš„mainæ–¹æ³•",
                "è§¦å‘UltimateBlockç±»çš„åŠ è½½æµç¨‹"
            ],
            memory: {
                metaspace: [],
                heap: [],
                stack: [
                    { name: 'main çº¿ç¨‹', detail: 'å¯åŠ¨ä¸­...', type: 'new' }
                ]
            },
            arrows: []
        },
        {
            line: 0,
            phase: "ç±»åŠ è½½ - åŠ è½½é˜¶æ®µ",
            description: "ç±»åŠ è½½å™¨è¯»å–UltimateBlock.classå­—èŠ‚ç ï¼Œæ„å»ºInstanceKlassä¸Class mirrorã€‚æ­¤æ—¶å·²å»ºç«‹å¸¸é‡æ± /å­—æ®µ/æ–¹æ³•ç­‰åŸºç¡€ç»“æ„ï¼Œä½†éªŒè¯ã€å‡†å¤‡ã€è§£æå°šæœªå®Œæˆã€‚",
            keyPoint: true,
            details: [
                "è§£æ class æ–‡ä»¶ç»“æ„ï¼šå¸¸é‡æ± ã€å­—æ®µè¡¨ã€æ–¹æ³•è¡¨",
                "InstanceKlassï¼š_fields/_methods âœ…ï¼Œ_super ğŸ”—ï¼Œvtable/itable â³",
                "è®°å½•çˆ¶ç±»/æ¥å£ç¬¦å·å¼•ç”¨ï¼ˆè§£æåœ¨é“¾æ¥é˜¶æ®µå®Œæˆï¼‰",
                "å…ƒç©ºé—´åˆ›å»º InstanceKlassï¼ˆKlass å…ƒæ•°æ®ï¼‰",
                "å †ä¸­åˆ›å»º java.lang.Classï¼ˆmirrorï¼‰",
                "âš ï¸ é™æ€å­—æ®µå­˜å‚¨å°šæœªåˆ†é…ï¼ˆå‡†å¤‡é˜¶æ®µæ‰åˆ†é…å¹¶ç½®é›¶ï¼‰",
                "vtable/itable å°šæœªæ„å»ºï¼ˆlinking é˜¶æ®µï¼‰"
            ],
            memory: {
                metaspace: [
                    {
                        kind: "instanceKlass",
                        id: IDS.IK,
                        name: "UltimateBlock.InstanceKlass",
                        fields: IK_STATE.loading
                    }
                ],
                heap: [
                    {
                        type: "class",
                        id: IDS.CLS,
                        name: "UltimateBlock.class",
                        fields: [
                            { name: "name", value: "\"UltimateBlock\"", fieldType: "String", status: "new" },
                            { name: "static storage", value: "æœªåˆ†é…ï¼ˆå‡†å¤‡é˜¶æ®µï¼‰", fieldType: "Static Fields", status: "new" },
                            { name: "mirror/metadata", value: "â†” UltimateBlock.InstanceKlass", fieldType: "Klass*", status: "new" }
                        ]
                    }
                ],
                stack: [
                    { name: 'main çº¿ç¨‹', detail: 'ç±»åŠ è½½ä¸­', type: '' }
                ]
            },
            arrows: [
                { from: IDS.CLS, to: IDS.IK, label: "mirror" }
            ]
        },
        {
            line: 0,
            phase: "ç±»åŠ è½½ - éªŒè¯é˜¶æ®µ",
            description: "éªŒè¯å­—èŠ‚ç çš„æ­£ç¡®æ€§å’Œå®‰å…¨æ€§ï¼Œç¡®ä¿ç¬¦åˆJVMè§„èŒƒã€‚",
            details: [
                "æ–‡ä»¶æ ¼å¼éªŒè¯ - æ£€æŸ¥é­”æ•°ã€ç‰ˆæœ¬å·",
                "å…ƒæ•°æ®éªŒè¯ - è¯­ä¹‰åˆ†æ",
                "å­—èŠ‚ç éªŒè¯ - æ•°æ®æµå’Œæ§åˆ¶æµåˆ†æ",
                "ç¬¦å·å¼•ç”¨éªŒè¯ - ç¡®ä¿å¯ä»¥æ­£ç¡®è§£æ",
                "ç»“æ„ä¸å˜ï¼š_super ä»ä¸º ğŸ”—ï¼Œvtable/itable ä» â³"
            ],
            memory: {
                metaspace: [
                    {
                        kind: "instanceKlass",
                        id: IDS.IK,
                        name: "UltimateBlock.InstanceKlass",
                        fields: IK_STATE.verified
                    }
                ],
                heap: [
                    {
                        type: "class",
                        id: IDS.CLS,
                        name: "UltimateBlock.class",
                        fields: [
                            { name: "name", value: "\"UltimateBlock\"", fieldType: "String", status: "" },
                            { name: "static storage", value: "æœªåˆ†é…ï¼ˆå‡†å¤‡é˜¶æ®µï¼‰", fieldType: "Static Fields", status: "" },
                            { name: "mirror/metadata", value: "â†” UltimateBlock.InstanceKlass", fieldType: "Klass*", status: "" }
                        ]
                    }
                ],
                stack: [
                    { name: 'main çº¿ç¨‹', detail: 'éªŒè¯é˜¶æ®µ', type: '' }
                ]
            },
            arrows: [
                { from: IDS.CLS, to: IDS.IK, label: "mirror" }
            ]
        },
        {
            line: 0,
            phase: "ç±»åŠ è½½ - å‡†å¤‡é˜¶æ®µ",
            description: "ä¸ºé™æ€å˜é‡åˆ†é…å­˜å‚¨å¹¶è®¾ç½®é›¶å€¼ï¼ŒåŒæ—¶è®¡ç®—å­—æ®µå¸ƒå±€/åç§»ï¼ˆå®ä¾‹å¤§å°ç¡®å®šï¼‰ã€‚é™æ€å­—æ®µå­˜æ”¾åœ¨ Class mirror ä¸­ã€‚",
            keyPoint: true,
            details: [
                "ä¸º static å­—æ®µåˆ†é…å­˜å‚¨ï¼ˆClass mirrorï¼‰",
                "è®¾ç½®é›¶å€¼ï¼šsingleton=nullï¼Œcount1=0ï¼Œcount2=0",
                "è®¡ç®—å®ä¾‹å­—æ®µå¸ƒå±€/åç§»ï¼ˆå¯¹è±¡å¤§å°ç¡®å®šï¼Œfield_layout âœ…ï¼‰",
                "âš ï¸ è¿™é‡Œåªæ˜¯èµ‹é›¶å€¼ï¼Œä¸æ‰§è¡Œæ˜¾å¼åˆå§‹åŒ–ï¼ˆ<clinit> æœªå¼€å§‹ï¼‰"
            ],
            memory: {
                metaspace: [
                    {
                        kind: "instanceKlass",
                        id: IDS.IK,
                        name: "UltimateBlock.InstanceKlass",
                        fields: IK_STATE.prepared
                    }
                ],
                heap: [
                    {
                        type: 'class',
                        id: IDS.CLS,
                        name: 'UltimateBlock.class',
                        fields: [
                            { name: 'mirror/metadata', value: 'â†” UltimateBlock.InstanceKlass', fieldType: 'Klass*', status: '' },
                            { name: 'singleton', value: 'null', fieldType: 'static UltimateBlock', status: 'new' },
                            { name: 'count1', value: '0', fieldType: 'static int', status: 'new' },
                            { name: 'count2', value: '0', fieldType: 'static int', status: 'new' }
                        ]
                    }
                ],
                stack: [
                    { name: 'main çº¿ç¨‹', detail: 'å‡†å¤‡é˜¶æ®µ', type: '' }
                ]
            },
            arrows: [
                { from: IDS.CLS, to: IDS.IK, label: "mirror" }
            ]
        },
        {
            line: 0,
            phase: "ç±»åŠ è½½ - è§£æé˜¶æ®µ",
            description: "å°†ç¬¦å·å¼•ç”¨è½¬æ¢ä¸ºç›´æ¥å¼•ç”¨ï¼Œå»ºç«‹å®é™…çš„å†…å­˜åœ°å€é“¾æ¥ï¼ˆç®€åŒ–å±•ç¤ºï¼‰ã€‚è§£æåœ¨JVMé‡Œå¯èƒ½æ˜¯å»¶è¿Ÿçš„ï¼Œè¿™é‡Œç»Ÿä¸€å±•ç¤ºä¸ºå®Œæˆã€‚",
            details: [
                "è§£æç±»/å­—æ®µ/æ–¹æ³•ç¬¦å·å¼•ç”¨",
                "çˆ¶ç±»/æ¥å£ç¬¦å·å¼•ç”¨è§£æä¸ºç›´æ¥å¼•ç”¨",
                "æ„å»º vtable/itableï¼ˆç”¨äºè™šæ–¹æ³•/æ¥å£æ–¹æ³•åˆ†æ´¾ï¼‰",
                "å»ºç«‹ç›´æ¥å¼•ç”¨ï¼ˆå¯èƒ½æŒ‰éœ€å»¶è¿Ÿï¼Œè¿™é‡Œç»Ÿä¸€å±•ç¤ºï¼‰",
                "_super ğŸ”—â†’âœ…ï¼Œvtable/itable âœ…"
            ],
            memory: {
                metaspace: [
                    {
                        kind: "instanceKlass",
                        id: IDS.IK,
                        name: "UltimateBlock.InstanceKlass",
                        fields: IK_STATE.resolved
                    }
                ],
                heap: [
                    {
                        type: 'class',
                        id: IDS.CLS,
                        name: 'UltimateBlock.class',
                        fields: [
                            { name: 'mirror/metadata', value: 'â†” UltimateBlock.InstanceKlass', fieldType: 'Klass*', status: '' },
                            { name: 'singleton', value: 'null', fieldType: 'static UltimateBlock', status: '' },
                            { name: 'count1', value: '0', fieldType: 'static int', status: '' },
                            { name: 'count2', value: '0', fieldType: 'static int', status: '' }
                        ]
                    }
                ],
                stack: [
                    { name: 'main çº¿ç¨‹', detail: 'è§£æé˜¶æ®µ', type: '' }
                ]
            },
            arrows: [
                { from: IDS.CLS, to: IDS.IK, label: "mirror" }
            ]
        },
        {
            line: 4,
            phase: "ç±»åˆå§‹åŒ– - <clinit> å¼€å§‹",
            description: "å¼€å§‹æ‰§è¡Œ <clinit>ã€‚æŒ‰å£°æ˜é¡ºåºåˆå§‹åŒ–é™æ€å˜é‡ï¼šsingleton = new UltimateBlock()ï¼ˆè§¦å‘å¯¹è±¡åˆ›å»ºï¼‰ã€‚",
            keyPoint: true,
            details: [
                "<clinit> ç”±ç¼–è¯‘å™¨ç”Ÿæˆ",
                "æŒ‰å£°æ˜é¡ºåºæ‰§è¡Œé™æ€åˆå§‹åŒ–",
                "é‡åˆ° new â†’ è§¦å‘å®ä¾‹åˆ›å»º",
                "ç¨åå†å›åˆ° <clinit>",
                "ç±»çŠ¶æ€ï¼šåˆå§‹åŒ–ä¸­ï¼ˆInstanceKlass å·²è§£æå®Œæˆï¼‰"
            ],
            memory: {
                metaspace: [
                    {
                        kind: "instanceKlass",
                        id: IDS.IK,
                        name: "UltimateBlock.InstanceKlass",
                        fields: IK_STATE.initRunning
                    }
                ],
                heap: [
                    {
                        type: 'class',
                        id: IDS.CLS,
                        name: 'UltimateBlock.class',
                        fields: [
                            { name: 'mirror/metadata', value: 'â†” UltimateBlock.InstanceKlass', fieldType: 'Klass*', status: '' },
                            { name: 'singleton', value: 'null', fieldType: 'static UltimateBlock', status: '' },
                            { name: 'count1', value: '0', fieldType: 'static int', status: '' },
                            { name: 'count2', value: '0', fieldType: 'static int', status: '' }
                        ]
                    }
                ],
                stack: [
                    { name: 'main çº¿ç¨‹ â†’ <clinit>', detail: 'ç±»åˆå§‹åŒ–æ–¹æ³•', type: 'new' }
                ]
            },
            arrows: [
                { from: IDS.CLS, to: IDS.IK, label: "mirror" }
            ]
        },
        {
            line: 4,
            phase: "å¯¹è±¡åˆ›å»º - æš‚åœ <clinit>",
            description: "new UltimateBlock() è§¦å‘å¯¹è±¡åˆ›å»ºã€‚<clinit> æš‚åœï¼Œè½¬è€Œæ‰§è¡Œ <init>ï¼ˆå¯¹è±¡åˆå§‹åŒ–ï¼‰ã€‚",
            keyPoint: true,
            details: [
                "é‡åˆ° new â†’ åˆ›å»ºå®ä¾‹",
                "<clinit> æš‚åœï¼ˆåµŒå¥—è°ƒç”¨ï¼‰",
                "æ‰§è¡Œ <init>ï¼šå®ä¾‹ä»£ç å— + æ„é€ å™¨"
            ],
            memory: {
                metaspace: [
                    {
                        kind: "instanceKlass",
                        id: IDS.IK,
                        name: "UltimateBlock.InstanceKlass",
                        fields: IK_STATE.initPaused
                    }
                ],
                heap: [
                    {
                        type: 'class',
                        id: IDS.CLS,
                        name: 'UltimateBlock.class',
                        fields: [
                            { name: 'mirror/metadata', value: 'â†” UltimateBlock.InstanceKlass', fieldType: 'Klass*', status: '' },
                            { name: 'singleton', value: 'null', fieldType: 'static UltimateBlock', status: '' },
                            { name: 'count1', value: '0', fieldType: 'static int', status: '' },
                            { name: 'count2', value: '0', fieldType: 'static int', status: '' }
                        ]
                    }
                ],
                stack: [
                    { name: 'main çº¿ç¨‹ â†’ <clinit>', detail: 'æš‚åœæ‰§è¡Œ', type: '' },
                    { name: 'main çº¿ç¨‹ â†’ <init>', detail: 'å¯¹è±¡åˆå§‹åŒ–æ–¹æ³•', type: 'new' }
                ]
            },
            arrows: [
                { from: IDS.CLS, to: IDS.IK, label: "mirror" }
            ]
        },
        {
            line: 4,
            phase: "å¯¹è±¡åˆ›å»º - åˆ†é…å†…å­˜",
            description: "åœ¨å †ä¸­ä¸ºæ–°å¯¹è±¡åˆ†é…å†…å­˜ã€‚å…³é”®ï¼šå¯¹è±¡å¤´é‡Œä¼šè®¾ç½® Klass Pointer â†’ æŒ‡å‘å…ƒç©ºé—´çš„ InstanceKlassã€‚",
            keyPoint: true,
            details: [
                "å †ä¸Šåˆ†é…å®ä¾‹å†…å­˜",
                "åˆå§‹åŒ–å¯¹è±¡å¤´ï¼šMark Word + Klass Pointer",
                "Klass Pointer æŒ‡å‘å…ƒç©ºé—´çš„ UltimateBlock.InstanceKlass",
                "è¿™å°±æ˜¯å®ä¾‹ä¸ç±»å…ƒæ•°æ®çš„çœŸå®è¿æ¥ç‚¹ï¼ˆHotSpotï¼‰"
            ],
            memory: {
                metaspace: [
                    { kind: "instanceKlass", id: IDS.IK, name: "UltimateBlock.InstanceKlass", fields: IK_STATE.initPaused }
                ],
                heap: [
                    {
                        type: 'class',
                        id: IDS.CLS,
                        name: 'UltimateBlock.class',
                        fields: [
                            { name: 'mirror/metadata', value: 'â†” UltimateBlock.InstanceKlass', fieldType: 'Klass*', status: '' },
                            { name: 'singleton', value: 'null', fieldType: 'static UltimateBlock', status: '' },
                            { name: 'count1', value: '0', fieldType: 'static int', status: '' },
                            { name: 'count2', value: '0', fieldType: 'static int', status: '' }
                        ]
                    },
                    {
                        type: 'instance',
                        id: IDS.INS,
                        name: 'UltimateBlock@instance',
                        fields: [
                            { name: 'å¯¹è±¡å¤´.Mark Word', value: 'åˆ†é…ä¸­â€¦', fieldType: 'MarkWord', status: 'new' },
                            { name: 'å¯¹è±¡å¤´.Klass Pointer', value: 'â†’ UltimateBlock.InstanceKlass', fieldType: 'Klass*', status: 'new' }
                        ]
                    }
                ],
                stack: [
                    { name: 'main çº¿ç¨‹ â†’ <clinit>', detail: 'æš‚åœæ‰§è¡Œ', type: '' },
                    { name: 'main çº¿ç¨‹ â†’ <init>', detail: 'åˆ†é…å†…å­˜', type: '' }
                ]
            },
            arrows: [
                { from: IDS.CLS, to: IDS.IK, label: "mirror" },
                { from: IDS.INS, to: IDS.IK, label: "Klass Pointer" }
            ]
        },

        // ä¸‹é¢æ­¥éª¤ï¼šä¸ºèŠ‚çœç¯‡å¹…ï¼ˆåŒæ—¶ä¿æŒä½ åŸæ¥çš„è¯­ä¹‰ï¼‰ï¼Œæˆ‘åªåœ¨â€œæœ‰å¯¹è±¡/ç±»å…ƒæ•°æ®å…³ç³»å˜åŒ–çš„å…³é”®æ­¥éª¤â€ç»§ç»­å¸¦ arrowsã€‚
        // å…¶ä½™æ­¥éª¤æ²¿ç”¨ä½ åŸé€»è¾‘ï¼šcount1/count2å˜åŒ–ã€æ ˆå¸§å˜åŒ–ç­‰ã€‚

        {
            line: 4,
            phase: "å¯¹è±¡åˆ›å»º - å†…å­˜æ¸…é›¶",
            description: "å°†åˆ†é…çš„å†…å­˜åˆå§‹åŒ–ä¸ºé›¶å€¼ï¼ˆé»˜è®¤å€¼ï¼‰ã€‚å¯¹è±¡å¤´é‡Œçš„ Klass Pointer å·²ç»æŒ‡å‘ InstanceKlassã€‚",
            details: [
                "å®ä¾‹å­—æ®µæ¸…é›¶ï¼šå¼•ç”¨=nullï¼ŒåŸºæœ¬ç±»å‹=0/false",
                "å¯¹è±¡å¤´ä¿æŒï¼šMark Word + Klass Pointer",
                "ç¡®ä¿å¯¹è±¡å†…å­˜å®‰å…¨"
            ],
            memory: {
                metaspace: [
                    { kind: "instanceKlass", id: IDS.IK, name: "UltimateBlock.InstanceKlass", fields: IK_STATE.initPaused }
                ],
                heap: [
                    { type: 'class', id: IDS.CLS, name: 'UltimateBlock.class', fields: [
                        { name: 'mirror/metadata', value: 'â†” UltimateBlock.InstanceKlass', fieldType: 'Klass*', status: '' },
                        { name: 'singleton', value: 'null', fieldType: 'static UltimateBlock', status: '' },
                        { name: 'count1', value: '0', fieldType: 'static int', status: '' },
                        { name: 'count2', value: '0', fieldType: 'static int', status: '' }
                    ] },
                    { type: 'instance', id: IDS.INS, name: 'UltimateBlock@instance', fields: [
                        { name: 'å¯¹è±¡å¤´.Mark Word', value: 'å·²è®¾ç½®', fieldType: 'MarkWord', status: 'modified' },
                        { name: 'å¯¹è±¡å¤´.Klass Pointer', value: 'â†’ UltimateBlock.InstanceKlass', fieldType: 'Klass*', status: '' }
                    ] }
                ],
                stack: [
                    { name: 'main çº¿ç¨‹ â†’ <clinit>', detail: 'æš‚åœæ‰§è¡Œ', type: '' },
                    { name: 'main çº¿ç¨‹ â†’ <init>', detail: 'å†…å­˜æ¸…é›¶å®Œæˆ', type: '' }
                ]
            },
            arrows: [
                { from: IDS.CLS, to: IDS.IK, label: "mirror" },
                { from: IDS.INS, to: IDS.IK, label: "Klass Pointer" }
            ]
        },

        {
            line: 14,
            phase: "å¯¹è±¡åˆå§‹åŒ– - å®ä¾‹ä»£ç å—",
            description: "æ‰§è¡Œå®ä¾‹ä»£ç å—ï¼šcount1++ã€‚æ³¨æ„ï¼šä¿®æ”¹çš„æ˜¯å †ä¸­ Classï¼ˆmirrorï¼‰é‡Œçš„é™æ€å­—æ®µã€‚",
            keyPoint: true,
            details: [
                "å®ä¾‹ä»£ç å—å…ˆäºæ„é€ å™¨",
                "count1++ï¼š0 â†’ 1",
                "é™æ€å­—æ®µå±äº Classï¼ˆmirrorï¼‰",
                "å®ä¾‹åªæ˜¯â€œé€šè¿‡ç±»â€è®¿é—®å®ƒï¼ˆè¯­ä¹‰ä¸Šä»æ˜¯é™æ€ï¼‰"
            ],
            memory: {
                metaspace: [
                    { kind: "instanceKlass", id: IDS.IK, name: "UltimateBlock.InstanceKlass", fields: IK_STATE.initPaused }
                ],
                heap: [
                    { type: 'class', id: IDS.CLS, name: 'UltimateBlock.class', fields: [
                        { name: 'mirror/metadata', value: 'â†” UltimateBlock.InstanceKlass', fieldType: 'Klass*', status: '' },
                        { name: 'singleton', value: 'null', fieldType: 'static UltimateBlock', status: '' },
                        { name: 'count1', value: '1', fieldType: 'static int', status: 'modified' },
                        { name: 'count2', value: '0', fieldType: 'static int', status: '' }
                    ] },
                    { type: 'instance', id: IDS.INS, name: 'UltimateBlock@instance', fields: [
                        { name: 'å¯¹è±¡å¤´.Klass Pointer', value: 'â†’ UltimateBlock.InstanceKlass', fieldType: 'Klass*', status: '' }
                    ] }
                ],
                stack: [
                    { name: 'main çº¿ç¨‹ â†’ <clinit>', detail: 'æš‚åœæ‰§è¡Œ', type: '' },
                    { name: 'main çº¿ç¨‹ â†’ <init>', detail: 'å®ä¾‹ä»£ç å—æ‰§è¡Œä¸­', type: 'modified' }
                ]
            },
            arrows: [
                { from: IDS.CLS, to: IDS.IK, label: "mirror" },
                { from: IDS.INS, to: IDS.IK, label: "Klass Pointer" }
            ]
        },

        {
            line: 15,
            phase: "å¯¹è±¡åˆå§‹åŒ– - å®ä¾‹ä»£ç å—",
            description: "æ‰§è¡Œå®ä¾‹ä»£ç å—ï¼šcount2++ï¼ˆ0 â†’ 1ï¼‰ã€‚",
            details: [
                "count2++ï¼š0 â†’ 1",
                "å®ä¾‹ä»£ç å—æ‰§è¡Œå®Œæ¯•",
                "æ¥ä¸‹æ¥æ‰§è¡Œæ„é€ å™¨"
            ],
            memory: {
                metaspace: [
                    { kind: "instanceKlass", id: IDS.IK, name: "UltimateBlock.InstanceKlass", fields: IK_STATE.initPaused }
                ],
                heap: [
                    { type: 'class', id: IDS.CLS, name: 'UltimateBlock.class', fields: [
                        { name: 'mirror/metadata', value: 'â†” UltimateBlock.InstanceKlass', fieldType: 'Klass*', status: '' },
                        { name: 'singleton', value: 'null', fieldType: 'static UltimateBlock', status: '' },
                        { name: 'count1', value: '1', fieldType: 'static int', status: '' },
                        { name: 'count2', value: '1', fieldType: 'static int', status: 'modified' }
                    ] },
                    { type: 'instance', id: IDS.INS, name: 'UltimateBlock@instance', fields: [
                        { name: 'å¯¹è±¡å¤´.Klass Pointer', value: 'â†’ UltimateBlock.InstanceKlass', fieldType: 'Klass*', status: '' }
                    ] }
                ],
                stack: [
                    { name: 'main çº¿ç¨‹ â†’ <clinit>', detail: 'æš‚åœæ‰§è¡Œ', type: '' },
                    { name: 'main çº¿ç¨‹ â†’ <init>', detail: 'å®ä¾‹ä»£ç å—æ‰§è¡Œä¸­', type: '' }
                ]
            },
            arrows: [
                { from: IDS.CLS, to: IDS.IK, label: "mirror" },
                { from: IDS.INS, to: IDS.IK, label: "Klass Pointer" }
            ]
        },

        {
            line: 19,
            phase: "å¯¹è±¡åˆå§‹åŒ– - æ„é€ å™¨",
            description: "æ‰§è¡Œæ„é€ å™¨ä»£ç ï¼ˆæœ¬ä¾‹ä¸ºç©ºï¼‰ã€‚å¯¹è±¡åˆå§‹åŒ–å®Œæˆã€‚",
            details: [
                "æ„é€ å™¨æ˜¯å®ä¾‹åˆå§‹åŒ–çš„æœ€åä¸€æ­¥",
                "æœ¬ä¾‹æ„é€ å™¨æ— é¢å¤–é€»è¾‘",
                "å‡†å¤‡è¿”å›å¯¹è±¡å¼•ç”¨ç»™ <clinit>"
            ],
            memory: {
                metaspace: [
                    { kind: "instanceKlass", id: IDS.IK, name: "UltimateBlock.InstanceKlass", fields: IK_STATE.initPaused }
                ],
                heap: [
                    { type: 'class', id: IDS.CLS, name: 'UltimateBlock.class', fields: [
                        { name: 'mirror/metadata', value: 'â†” UltimateBlock.InstanceKlass', fieldType: 'Klass*', status: '' },
                        { name: 'singleton', value: 'null', fieldType: 'static UltimateBlock', status: '' },
                        { name: 'count1', value: '1', fieldType: 'static int', status: '' },
                        { name: 'count2', value: '1', fieldType: 'static int', status: '' }
                    ] },
                    { type: 'instance', id: IDS.INS, name: 'UltimateBlock@instance', fields: [
                        { name: 'å¯¹è±¡å¤´.Klass Pointer', value: 'â†’ UltimateBlock.InstanceKlass', fieldType: 'Klass*', status: '' },
                        { name: 'çŠ¶æ€', value: 'åˆå§‹åŒ–å®Œæˆ âœ“', fieldType: 'Ready', status: 'new' }
                    ] }
                ],
                stack: [
                    { name: 'main çº¿ç¨‹ â†’ <clinit>', detail: 'æš‚åœæ‰§è¡Œ', type: '' },
                    { name: 'main çº¿ç¨‹ â†’ <init>', detail: 'æ„é€ å™¨æ‰§è¡Œ', type: 'modified' }
                ]
            },
            arrows: [
                { from: IDS.CLS, to: IDS.IK, label: "mirror" },
                { from: IDS.INS, to: IDS.IK, label: "Klass Pointer" }
            ]
        },

        {
            line: 4,
            phase: "è¿”å› <clinit> - å¯¹è±¡å¼•ç”¨èµ‹å€¼",
            description: "å¯¹è±¡åˆ›å»ºå®Œæˆï¼Œè¿”å›å¼•ç”¨ç»™ singletonï¼ˆé™æ€å­—æ®µåœ¨ Class mirror ä¸­ï¼‰ã€‚<clinit> ç»§ç»­æ‰§è¡Œã€‚",
            keyPoint: true,
            details: [
                "new UltimateBlock() å®Œæˆ",
                "singleton æŒ‡å‘å®ä¾‹",
                "å›åˆ° <clinit> ç»§ç»­åç»­é™æ€åˆå§‹åŒ–"
            ],
            memory: {
                metaspace: [
                    { kind: "instanceKlass", id: IDS.IK, name: "UltimateBlock.InstanceKlass", fields: IK_STATE.initRunning }
                ],
                heap: [
                    { type: 'class', id: IDS.CLS, name: 'UltimateBlock.class', fields: [
                        { name: 'mirror/metadata', value: 'â†” UltimateBlock.InstanceKlass', fieldType: 'Klass*', status: '' },
                        { name: 'singleton', value: 'â†’ UltimateBlock@instance', fieldType: 'static UltimateBlock', status: 'modified' },
                        { name: 'count1', value: '1', fieldType: 'static int', status: '' },
                        { name: 'count2', value: '1', fieldType: 'static int', status: '' }
                    ] },
                    { type: 'instance', id: IDS.INS, name: 'UltimateBlock@instance', fields: [
                        { name: 'å¯¹è±¡å¤´.Klass Pointer', value: 'â†’ UltimateBlock.InstanceKlass', fieldType: 'Klass*', status: '' },
                        { name: 'çŠ¶æ€', value: 'å·²èµ‹å€¼ç»™ singleton', fieldType: 'Referenced', status: 'modified' }
                    ] }
                ],
                stack: [
                    { name: 'main çº¿ç¨‹ â†’ <clinit>', detail: 'ç»§ç»­æ‰§è¡Œ', type: 'modified' }
                ]
            },
            arrows: [
                { from: IDS.CLS, to: IDS.IK, label: "mirror" },
                { from: IDS.INS, to: IDS.IK, label: "Klass Pointer" }
            ]
        },

        {
            line: 7,
            phase: "ç±»åˆå§‹åŒ– - å¤„ç† count1",
            description: "count1 æ— æ˜¾å¼èµ‹å€¼ï¼Œ<clinit> ä¸­ä¸ä¼šç”Ÿæˆèµ‹å€¼æŒ‡ä»¤ï¼Œä¿æŒå½“å‰å€¼ 1ã€‚",
            keyPoint: true,
            details: [
                "public static int count1;ï¼ˆæ— æ˜¾å¼èµ‹å€¼ï¼‰",
                "<clinit> ä¸­æ²¡æœ‰ count1=... æŒ‡ä»¤",
                "count1 ä¿æŒï¼š1"
            ],
            memory: {
                metaspace: [
                    { kind: "instanceKlass", id: IDS.IK, name: "UltimateBlock.InstanceKlass", fields: IK_STATE.initRunning }
                ],
                heap: [
                    { type: 'class', id: IDS.CLS, name: 'UltimateBlock.class', fields: [
                        { name: 'mirror/metadata', value: 'â†” UltimateBlock.InstanceKlass', fieldType: 'Klass*', status: '' },
                        { name: 'singleton', value: 'â†’ UltimateBlock@instance', fieldType: 'static UltimateBlock', status: '' },
                        { name: 'count1', value: '1', fieldType: 'static int (ä¿æŒ)', status: '' },
                        { name: 'count2', value: '1', fieldType: 'static int', status: '' }
                    ] },
                    { type: 'instance', id: IDS.INS, name: 'UltimateBlock@instance', fields: [
                        { name: 'å¯¹è±¡å¤´.Klass Pointer', value: 'â†’ UltimateBlock.InstanceKlass', fieldType: 'Klass*', status: '' }
                    ] }
                ],
                stack: [
                    { name: 'main çº¿ç¨‹ â†’ <clinit>', detail: 'å¤„ç† count1', type: '' }
                ]
            },
            arrows: [
                { from: IDS.CLS, to: IDS.IK, label: "mirror" },
                { from: IDS.INS, to: IDS.IK, label: "Klass Pointer" }
            ]
        },

        {
            line: 10,
            phase: "ç±»åˆå§‹åŒ– - å¤„ç† count2",
            description: "count2 æœ‰æ˜¾å¼èµ‹å€¼ (= 0)ï¼Œä¼šè¦†ç›–ä¹‹å‰å®ä¾‹ä»£ç å—æ”¹æˆçš„ 1ã€‚",
            keyPoint: true,
            details: [
                "public static int count2 = 0;ï¼ˆæœ‰æ˜¾å¼èµ‹å€¼ï¼‰",
                "æ‰§è¡Œèµ‹å€¼ï¼šcount2 = 0",
                "count2 ä» 1 è¢«è¦†ç›–ä¸º 0"
            ],
            memory: {
                metaspace: [
                    { kind: "instanceKlass", id: IDS.IK, name: "UltimateBlock.InstanceKlass", fields: IK_STATE.initRunning }
                ],
                heap: [
                    { type: 'class', id: IDS.CLS, name: 'UltimateBlock.class', fields: [
                        { name: 'mirror/metadata', value: 'â†” UltimateBlock.InstanceKlass', fieldType: 'Klass*', status: '' },
                        { name: 'singleton', value: 'â†’ UltimateBlock@instance', fieldType: 'static UltimateBlock', status: '' },
                        { name: 'count1', value: '1', fieldType: 'static int', status: '' },
                        { name: 'count2', value: '0', fieldType: 'static int (è¦†ç›–)', status: 'modified' }
                    ] },
                    { type: 'instance', id: IDS.INS, name: 'UltimateBlock@instance', fields: [
                        { name: 'å¯¹è±¡å¤´.Klass Pointer', value: 'â†’ UltimateBlock.InstanceKlass', fieldType: 'Klass*', status: '' }
                    ] }
                ],
                stack: [
                    { name: 'main çº¿ç¨‹ â†’ <clinit>', detail: 'å¤„ç† count2', type: 'modified' }
                ]
            },
            arrows: [
                { from: IDS.CLS, to: IDS.IK, label: "mirror" },
                { from: IDS.INS, to: IDS.IK, label: "Klass Pointer" }
            ]
        },

        // âœ… åç»­ main / è¾“å‡ºæ­¥éª¤ï¼šä¿ç•™ä½ åŸæ¥çš„å±•ç¤ºï¼Œä½†ä»ä¿æŒä¸‰è€…å…³ç³»ä¸ä¸¢å¤±
        {
            line: 0,
            phase: "ç±»åˆå§‹åŒ–å®Œæˆ",
            description: "<clinit> æ‰§è¡Œå®Œæ¯•ï¼Œç±»åˆå§‹åŒ–å®Œæˆã€‚æœ€ç»ˆï¼šcount1=1ï¼Œcount2=0ã€‚",
            keyPoint: true,
            details: [
                "ç±»è¿›å…¥å·²åˆå§‹åŒ–çŠ¶æ€",
                "é™æ€å­—æ®µæœ€ç»ˆå€¼ç¨³å®š",
                "å¯ä»¥æ­£å¸¸è°ƒç”¨ getInstance / main",
                "InstanceKlassï¼š_super âœ…ï¼Œvtable/itable âœ…"
            ],
            memory: {
                metaspace: [
                    { kind: "instanceKlass", id: IDS.IK, name: "UltimateBlock.InstanceKlass", fields: IK_STATE.initialized }
                ],
                heap: [
                    { type: 'class', id: IDS.CLS, name: 'UltimateBlock.class', fields: [
                        { name: 'mirror/metadata', value: 'â†” UltimateBlock.InstanceKlass', fieldType: 'Klass*', status: '' },
                        { name: 'singleton', value: 'â†’ UltimateBlock@instance', fieldType: 'static UltimateBlock', status: '' },
                        { name: 'count1', value: '1', fieldType: 'static int (æœ€ç»ˆ)', status: '' },
                        { name: 'count2', value: '0', fieldType: 'static int (æœ€ç»ˆ)', status: '' }
                    ] },
                    { type: 'instance', id: IDS.INS, name: 'UltimateBlock@instance', fields: [
                        { name: 'å¯¹è±¡å¤´.Klass Pointer', value: 'â†’ UltimateBlock.InstanceKlass', fieldType: 'Klass*', status: '' },
                        { name: 'çŠ¶æ€', value: 'å·²èµ‹å€¼ç»™ singleton', fieldType: 'Referenced', status: '' }
                    ] }
                ],
                stack: [
                    { name: 'main çº¿ç¨‹', detail: 'main æ–¹æ³•', type: 'modified' }
                ]
            },
            arrows: [
                { from: IDS.CLS, to: IDS.IK, label: "mirror" },
                { from: IDS.INS, to: IDS.IK, label: "Klass Pointer" }
            ]
        },

        {
            line: 29,
            phase: "æ‰§è¡Œ main - è°ƒç”¨ getInstance()",
            description: "main è°ƒç”¨ getInstance() è¿”å› singletonã€‚objï¼ˆæ ˆï¼‰æŒ‡å‘å®ä¾‹ï¼ˆå †ï¼‰ã€‚å®ä¾‹å¯¹è±¡å¤´ Klass Pointer ä»æŒ‡å‘ InstanceKlassï¼ˆå…ƒç©ºé—´ï¼‰ã€‚",
            details: [
                "obj = getInstance()",
                "obj å­˜åœ¨æ ˆçš„å±€éƒ¨å˜é‡è¡¨",
                "obj æŒ‡å‘å †ä¸­å®ä¾‹å¯¹è±¡",
                "å®ä¾‹å¯¹è±¡å¤´ï¼šKlass Pointer â†’ InstanceKlass"
            ],
            memory: {
                metaspace: [
                    { kind: "instanceKlass", id: IDS.IK, name: "UltimateBlock.InstanceKlass", fields: IK_STATE.initialized }
                ],
                heap: [
                    { type: 'class', id: IDS.CLS, name: 'UltimateBlock.class', fields: [
                        { name: 'mirror/metadata', value: 'â†” UltimateBlock.InstanceKlass', fieldType: 'Klass*', status: '' },
                        { name: 'singleton', value: 'â†’ UltimateBlock@instance', fieldType: 'static UltimateBlock', status: '' },
                        { name: 'count1', value: '1', fieldType: 'static int', status: '' },
                        { name: 'count2', value: '0', fieldType: 'static int', status: '' }
                    ] },
                    { type: 'instance', id: IDS.INS, name: 'UltimateBlock@instance', fields: [
                        { name: 'å¯¹è±¡å¤´.Klass Pointer', value: 'â†’ UltimateBlock.InstanceKlass', fieldType: 'Klass*', status: '' },
                        { name: 'çŠ¶æ€', value: 'è¢« obj å¼•ç”¨', fieldType: 'Referenced', status: 'modified' }
                    ] }
                ],
                stack: [
                    { name: 'main çº¿ç¨‹ â†’ main æ–¹æ³•', detail: 'getInstance() è°ƒç”¨', type: '' },
                    { name: 'obj å±€éƒ¨å˜é‡', detail: 'â†’ UltimateBlock@instance', type: 'new' }
                ]
            },
            arrows: [
                { from: IDS.CLS, to: IDS.IK, label: "mirror" },
                { from: IDS.INS, to: IDS.IK, label: "Klass Pointer" }
            ]
        },

        {
            line: 30,
            phase: "æ‰§è¡Œ main - æ‰“å° count1",
            description: "è¾“å‡º count1ã€‚è®¿é—®é™æ€å­—æ®µä»å±äº Classï¼ˆmirrorï¼‰ã€‚",
            details: [
                'println("count1=" + obj.count1)',
                "é™æ€å­—æ®µ count1 å±äº Classï¼ˆmirrorï¼‰",
                "è¾“å‡ºï¼šcount1=1"
            ],
            memory: {
                metaspace: [
                    { kind: "instanceKlass", id: IDS.IK, name: "UltimateBlock.InstanceKlass", fields: IK_STATE.initialized }
                ],
                heap: [
                    { type: 'class', id: IDS.CLS, name: 'UltimateBlock.class', fields: [
                        { name: 'mirror/metadata', value: 'â†” UltimateBlock.InstanceKlass', fieldType: 'Klass*', status: '' },
                        { name: 'count1', value: '1', fieldType: 'static int', status: 'modified' },
                        { name: 'count2', value: '0', fieldType: 'static int', status: '' },
                        { name: 'singleton', value: 'â†’ UltimateBlock@instance', fieldType: 'static UltimateBlock', status: '' }
                    ] },
                    { type: 'instance', id: IDS.INS, name: 'UltimateBlock@instance', fields: [
                        { name: 'å¯¹è±¡å¤´.Klass Pointer', value: 'â†’ UltimateBlock.InstanceKlass', fieldType: 'Klass*', status: '' }
                    ] }
                ],
                stack: [
                    { name: 'main çº¿ç¨‹ â†’ main æ–¹æ³•', detail: 'println() æ‰§è¡Œ', type: '' },
                    { name: 'obj å±€éƒ¨å˜é‡', detail: 'â†’ UltimateBlock@instance', type: '' },
                    { name: 'æ§åˆ¶å°è¾“å‡º', detail: 'count1=1', type: 'new' }
                ]
            },
            arrows: [
                { from: IDS.CLS, to: IDS.IK, label: "mirror" },
                { from: IDS.INS, to: IDS.IK, label: "Klass Pointer" }
            ]
        },

        {
            line: 31,
            phase: "æ‰§è¡Œ main - æ‰“å° count2",
            description: "è¾“å‡º count2ï¼š0ã€‚",
            details: [
                'println("count2=" + obj.count2)',
                "è¾“å‡ºï¼šcount2=0",
                "main æ–¹æ³•æ‰§è¡Œå®Œæ¯•"
            ],
            memory: {
                metaspace: [
                    { kind: "instanceKlass", id: IDS.IK, name: "UltimateBlock.InstanceKlass", fields: IK_STATE.initialized }
                ],
                heap: [
                    { type: 'class', id: IDS.CLS, name: 'UltimateBlock.class', fields: [
                        { name: 'mirror/metadata', value: 'â†” UltimateBlock.InstanceKlass', fieldType: 'Klass*', status: '' },
                        { name: 'count1', value: '1', fieldType: 'static int', status: '' },
                        { name: 'count2', value: '0', fieldType: 'static int', status: 'modified' },
                        { name: 'singleton', value: 'â†’ UltimateBlock@instance', fieldType: 'static UltimateBlock', status: '' }
                    ] },
                    { type: 'instance', id: IDS.INS, name: 'UltimateBlock@instance', fields: [
                        { name: 'å¯¹è±¡å¤´.Klass Pointer', value: 'â†’ UltimateBlock.InstanceKlass', fieldType: 'Klass*', status: '' }
                    ] }
                ],
                stack: [
                    { name: 'main çº¿ç¨‹ â†’ main æ–¹æ³•', detail: 'println() æ‰§è¡Œ', type: '' },
                    { name: 'obj å±€éƒ¨å˜é‡', detail: 'â†’ UltimateBlock@instance', type: '' },
                    { name: 'æ§åˆ¶å°è¾“å‡º', detail: 'count2=0', type: 'modified' }
                ]
            },
            arrows: [
                { from: IDS.CLS, to: IDS.IK, label: "mirror" },
                { from: IDS.INS, to: IDS.IK, label: "Klass Pointer" }
            ]
        },

        {
            line: 0,
            phase: "ç¨‹åºæ‰§è¡Œå®Œæˆ",
            description: "main ç»“æŸï¼Œç¨‹åºé€€å‡ºã€‚æœ€ç»ˆè¾“å‡ºï¼šcount1=1, count2=0ã€‚",
            keyPoint: true,
            details: [
                "ç¨‹åºæ‰§è¡Œå®Œæˆ âœ“",
                "count2 åœ¨å®ä¾‹ä»£ç å—ä¸­ ++ åˆ° 1",
                "ä½†éšåè¢«æ˜¾å¼èµ‹å€¼ (=0) è¦†ç›–",
                "æ‰€ä»¥æœ€ç»ˆ count2=0"
            ],
            memory: {
                metaspace: [
                    { kind: "instanceKlass", id: IDS.IK, name: "UltimateBlock.InstanceKlass", fields: IK_STATE.initialized }
                ],
                heap: [
                    { type: 'class', id: IDS.CLS, name: 'UltimateBlock.class', fields: [
                        { name: 'mirror/metadata', value: 'â†” UltimateBlock.InstanceKlass', fieldType: 'Klass*', status: '' },
                        { name: 'singleton', value: 'â†’ UltimateBlock@instance', fieldType: 'static UltimateBlock', status: '' },
                        { name: 'count1', value: '1', fieldType: 'static int (æœ€ç»ˆ)', status: '' },
                        { name: 'count2', value: '0', fieldType: 'static int (æœ€ç»ˆ)', status: '' }
                    ] },
                    { type: 'instance', id: IDS.INS, name: 'UltimateBlock@instance', fields: [
                        { name: 'å¯¹è±¡å¤´.Klass Pointer', value: 'â†’ UltimateBlock.InstanceKlass', fieldType: 'Klass*', status: '' },
                        { name: 'çŠ¶æ€', value: 'ç¨‹åºç»“æŸ', fieldType: 'Completed', status: '' }
                    ] }
                ],
                stack: [
                    { name: 'ç¨‹åºçŠ¶æ€', detail: 'æ‰§è¡Œå®Œæˆ âœ“', type: 'modified' }
                ]
            },
            arrows: [
                { from: IDS.CLS, to: IDS.IK, label: "mirror" },
                { from: IDS.INS, to: IDS.IK, label: "Klass Pointer" }
            ]
        }
    ];

    // çŠ¶æ€å˜é‡
    let currentStep = 0;
    let isPlaying = false;
    let playTimer = null;
    let playSpeed = 1200;

    function init() {
        renderCode();
        renderTimeline();
        goToStep(0);
    }

    // æ¸²æŸ“ä»£ç 
    function renderCode() {
        const lines = sourceCode.split('\n');
        const html = lines.map((line, index) => {
            return `
                <div class="code-line" data-line="${index + 1}">
                    <span class="line-num">${index + 1}</span>
                    <span class="line-code">${escapeHtml(line)}</span>
                </div>
            `;
        }).join('');
        document.getElementById('codeContent').innerHTML = html;
    }

    // æ¸²æŸ“æ—¶é—´è½´
    function renderTimeline() {
        const html = steps.map((step, index) => {
            const classes = ['timeline-marker'];
            if (step.keyPoint) classes.push('key-point');
            return `<div class="${classes.join(' ')}" data-step="${index}"></div>`;
        }).join('');
        document.getElementById('timelineMarkers').innerHTML = html;

        document.querySelectorAll('.timeline-marker').forEach((marker, index) => {
            marker.addEventListener('click', () => {
                stopPlay();
                goToStep(index);
            });
        });
    }

    // è·³è½¬æ­¥éª¤
    function goToStep(step) {
        currentStep = Math.max(0, Math.min(step, steps.length - 1));

        updateCodeHighlight();
        updateMemory();
        updateDescription();
        updateProgress();
        updateButtons();

        // âœ… ç®­å¤´æ¸²æŸ“ï¼šç­‰ DOM æ¸²æŸ“åå†ç”»
        setTimeout(() => {
            renderArrows(steps[currentStep].arrows || []);
        }, 80);
    }

    // æ›´æ–°ä»£ç é«˜äº®
    function updateCodeHighlight() {
        const currentLine = steps[currentStep].line;
        document.querySelectorAll('.code-line').forEach((line, index) => {
            const lineNum = index + 1;
            line.classList.remove('active', 'executed');

            if (currentLine > 0) {
                if (lineNum === currentLine) line.classList.add('active');
                else if (lineNum < currentLine) line.classList.add('executed');
            }
        });

        if (currentLine > 0) {
            const activeLine = document.querySelector('.code-line.active');
            if (activeLine) activeLine.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }
    }

    // æ›´æ–°å†…å­˜æ˜¾ç¤º
    function updateMemory() {
        const memory = steps[currentStep].memory;

        renderMetaspace(memory.metaspace);
        renderHeap(memory.heap);
        renderStack(memory.stack);

        highlightActiveRegions(memory);
    }

    // âœ… æ¸²æŸ“å…ƒç©ºé—´ï¼ˆä»¥â€œInstanceKlass å¡ç‰‡â€çš„æ–¹å¼å‘ˆç°ï¼Œä¾¿äº data-id è¿çº¿ï¼‰
    function renderMetaspace(items) {
        const container = document.getElementById('metaspaceContent');
        if (!items || items.length === 0) {
            container.innerHTML = '<div class="empty-message">ç­‰å¾…ç±»åŠ è½½...</div>';
            return;
        }

        const html = items.map(obj => {
            const fieldsHtml = (obj.fields || []).map(field => `
                <div class="memory-item appear ${field.status || ''}">
                    <div class="item-name">${field.name}</div>
                    <div class="item-value">${field.value}</div>
                    <div class="item-type">${field.fieldType || 'Metadata'}</div>
                </div>
            `).join('');

            return `
                <div class="meta-klass" data-id="${obj.id || obj.name}">
                    <div class="object-header">${obj.name}</div>
                    ${fieldsHtml}
                </div>
            `;
        }).join('');

        container.innerHTML = html;

        setTimeout(() => {
            container.querySelectorAll('.memory-item').forEach((item, index) => {
                setTimeout(() => item.classList.add('appear'), index * 40);
            });
        }, 10);
    }

    // æ¸²æŸ“å †
    function renderHeap(objects) {
        const container = document.getElementById('heapContent');
        if (!objects || objects.length === 0) {
            container.innerHTML = '<div class="empty-message">ç­‰å¾…å¯¹è±¡åˆ›å»º...</div>';
            return;
        }

        const html = objects.map(obj => {
            const containerClass = obj.type === 'instance' ? 'object-instance' : 'class-object';
            const fieldsHtml = (obj.fields || []).map(field => `
                <div class="memory-item appear ${field.status || ''}">
                    <div class="item-name">${field.name}</div>
                    <div class="item-value">${field.value}</div>
                    <div class="item-type">${field.fieldType}</div>
                </div>
            `).join('');

            return `
                <div class="${containerClass}" data-id="${obj.id || obj.name}">
                    <div class="object-header">${obj.name}</div>
                    ${fieldsHtml}
                </div>
            `;
        }).join('');

        container.innerHTML = html;

        setTimeout(() => {
            container.querySelectorAll('.memory-item').forEach((item, index) => {
                setTimeout(() => item.classList.add('appear'), index * 40);
            });
        }, 10);
    }

    // æ¸²æŸ“æ ˆ
    function renderStack(frames) {
        const container = document.getElementById('stackContent');
        if (!frames || frames.length === 0) {
            container.innerHTML = '<div class="empty-message">ç­‰å¾…æ–¹æ³•è°ƒç”¨...</div>';
            return;
        }

        const html = frames.map(frame => `
            <div class="stack-frame appear ${frame.type || ''}">
                <div class="frame-name">${frame.name}</div>
                <div class="frame-detail">${frame.detail}</div>
            </div>
        `).join('');
        container.innerHTML = html;

        setTimeout(() => {
            container.querySelectorAll('.stack-frame').forEach((item, index) => {
                setTimeout(() => item.classList.add('appear'), index * 40);
            });
        }, 10);
    }

    function highlightActiveRegions(memory) {
        document.getElementById('metaspaceRegion').classList.toggle('highlight', (memory.metaspace || []).length > 0);
        document.getElementById('heapRegion').classList.toggle('highlight', (memory.heap || []).length > 0);
        document.getElementById('stackRegion').classList.toggle('highlight', (memory.stack || []).length > 0);
    }

    // æ›´æ–°æè¿°
    function updateDescription() {
        const step = steps[currentStep];
        document.getElementById('phaseNumber').textContent = currentStep + 1;
        document.getElementById('phaseTitle').textContent = step.phase;
        document.getElementById('phaseDescription').textContent = step.description;

        const detailsHtml = (step.details || []).map(detail => `<li>${detail}</li>`).join('');
        document.getElementById('detailList').innerHTML = detailsHtml;
    }

    // æ›´æ–°è¿›åº¦
    function updateProgress() {
        const progress = (currentStep / (steps.length - 1)) * 100;
        document.getElementById('progressFill').style.width = progress + '%';
        document.getElementById('currentPhase').textContent = steps[currentStep].phase;
        document.getElementById('stepCount').textContent = `æ­¥éª¤ ${currentStep + 1}/${steps.length}`;

        document.querySelectorAll('.timeline-marker').forEach((marker, index) => {
            marker.classList.remove('completed', 'active');
            if (index < currentStep) marker.classList.add('completed');
            else if (index === currentStep) marker.classList.add('active');
        });
    }

    function updateButtons() {
        document.getElementById('prevBtn').disabled = currentStep === 0;
        document.getElementById('nextBtn').disabled = currentStep === steps.length - 1;
    }

    // æ’­æ”¾æ§åˆ¶
    function togglePlay() { isPlaying ? stopPlay() : startPlay(); }

    function startPlay() {
        if (currentStep === steps.length - 1) goToStep(0);

        isPlaying = true;
        document.getElementById('playIcon').textContent = 'â¸';
        document.getElementById('playText').textContent = 'æš‚åœ';

        playTimer = setInterval(() => {
            if (currentStep < steps.length - 1) goToStep(currentStep + 1);
            else stopPlay();
        }, playSpeed);
    }

    function stopPlay() {
        isPlaying = false;
        document.getElementById('playIcon').textContent = 'â–¶';
        document.getElementById('playText').textContent = 'æ’­æ”¾';
        if (playTimer) { clearInterval(playTimer); playTimer = null; }
    }

    function nextStep() { stopPlay(); if (currentStep < steps.length - 1) goToStep(currentStep + 1); }
    function prevStep() { stopPlay(); if (currentStep > 0) goToStep(currentStep - 1); }
    function reset() { stopPlay(); goToStep(0); }

    // å·¥å…·å‡½æ•°
    function escapeHtml(text) {
        const div = document.createElement('div');
        div.textContent = text;
        return div.innerHTML;
    }

    /**
     * âœ… ç”»ç®­å¤´ï¼šæ ¹æ® data-id å®šä½å…ƒç´ è¿çº¿
     */
    function renderArrows(arrows) {
        const svg = document.getElementById('connectionSvg');
        svg.innerHTML = `
            <defs>
                <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
                    <polygon points="0 0, 10 3, 0 6" fill="var(--accent-blue)"></polygon>
                </marker>
            </defs>
        `;

        if (!arrows || arrows.length === 0) return;

        arrows.forEach(arrow => {
            const fromEl = document.querySelector(`[data-id="${arrow.from}"]`);
            const toEl = document.querySelector(`[data-id="${arrow.to}"]`);
            if (!fromEl || !toEl) return;

            const fromRect = fromEl.getBoundingClientRect();
            const toRect = toEl.getBoundingClientRect();

            const x1 = fromRect.left + fromRect.width / 2;
            const y1 = fromRect.top + fromRect.height / 2;
            const x2 = toRect.left + toRect.width / 2;
            const y2 = toRect.top + toRect.height / 2;

            const midX = (x1 + x2) / 2;
            const midY = (y1 + y2) / 2 - 60;

            const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
            path.setAttribute('d', `M ${x1} ${y1} Q ${midX} ${midY} ${x2} ${y2}`);
            path.setAttribute('class', 'arrow');
            path.setAttribute('marker-end', 'url(#arrowhead)');
            svg.appendChild(path);

            const text = document.createElementNS('http://www.w3.org/2000/svg', 'text');
            text.setAttribute('x', midX);
            text.setAttribute('y', midY - 6);
            text.setAttribute('class', 'arrow-label');
            text.setAttribute('text-anchor', 'middle');
            text.textContent = arrow.label || '';
            svg.appendChild(text);

            setTimeout(() => {
                path.classList.add('visible');
                text.classList.add('visible');
            }, 10);
        });
    }

    // äº‹ä»¶ç›‘å¬
    document.getElementById('playBtn').addEventListener('click', togglePlay);
    document.getElementById('nextBtn').addEventListener('click', nextStep);
    document.getElementById('prevBtn').addEventListener('click', prevStep);
    document.getElementById('resetBtn').addEventListener('click', reset);

    document.getElementById('speedSelect').addEventListener('change', (e) => {
        playSpeed = parseInt(e.target.value);
        if (isPlaying) { stopPlay(); startPlay(); }
    });

    document.addEventListener('keydown', (e) => {
        if (e.code === 'Space') { e.preventDefault(); togglePlay(); }
        else if (e.code === 'ArrowRight') { e.preventDefault(); nextStep(); }
        else if (e.code === 'ArrowLeft') { e.preventDefault(); prevStep(); }
        else if (e.code === 'KeyR') { e.preventDefault(); reset(); }
    });

    window.addEventListener('resize', () => {
        renderArrows(steps[currentStep].arrows || []);
    });

    // åˆå§‹åŒ–
    init();
</script>
</body>
</html>
