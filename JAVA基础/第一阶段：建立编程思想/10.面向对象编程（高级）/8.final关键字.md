`final` æ˜¯ Java è¯­è¨€ä¸­ä¿è¯"ç¨³å®šæ€§"çš„åŸºçŸ³ã€‚ä½ å¯ä»¥æŠŠå®ƒç†è§£ä¸ºä»£ç ä¸–ç•Œçš„**å°å°æ¡**â€”â€”ä¸€æ—¦è´´ä¸Šï¼Œå°±ä¸è®¸å†æ”¹åŠ¨ã€‚å®ƒæ˜¯ç¼–å†™å®‰å…¨ã€å¥å£®ä»£ç ï¼ˆå°¤å…¶æ˜¯å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼‰çš„æ ¸å¿ƒå·¥å…·ã€‚

---

## ç¬¬1éƒ¨åˆ†ï¼šå»ºç«‹è®¤çŸ¥ï¼ˆWhat & Whyï¼‰

### ğŸ“¦ 1.1 æ ¸å¿ƒè¯­æ³• *ğŸ’¡ æ ¸å¿ƒå¿…å­¦*

**ç›®æ ‡**ï¼šæŒæ¡ `final` åœ¨ä¸‰ä¸ªä¸åŒä½ç½®çš„å«ä¹‰ã€‚

`final` å¯ä»¥ä¿®é¥°å˜é‡ã€æ–¹æ³•å’Œç±»ï¼Œå«ä¹‰å±‚å±‚é€’è¿›ï¼š

1. **ä¿®é¥°å˜é‡**ï¼š**æ•°å€¼ä¸å¯å˜**ï¼ˆå¦‚æœæ˜¯å¼•ç”¨ï¼Œåˆ™æ˜¯åœ°å€ä¸å¯å˜ï¼‰ã€‚
2. **ä¿®é¥°æ–¹æ³•**ï¼š**é€»è¾‘ä¸å¯å˜**ï¼ˆå­ç±»ä¸èƒ½ä¿®æ”¹è¿™ä¸ªæ–¹æ³•çš„å®ç°ï¼‰ã€‚
3. **ä¿®é¥°ç±»**ï¼š**å½¢æ€ä¸å¯å˜**ï¼ˆè¿™ä¸ªç±»æ–­å­ç»å­™ï¼Œä¸èƒ½æœ‰å­ç±»ï¼‰ã€‚

**åŸºç¡€ä»£ç ç¤ºä¾‹**ï¼š

```java
/**
 * final çš„ä¸‰ç§ç”¨æ³•æ¼”ç¤º
 */
// 3. ä¿®é¥°ç±»ï¼šã€æ–­å­ç»å­™ã€‘
// å«ä¹‰ï¼šè¿™ä¸ªç±»ä¸å…è®¸è¢«ç»§æ‰¿ã€‚
// å…¸å‹ä¾‹å­ï¼šString ç±»å°±æ˜¯ final çš„ï¼Œé˜²æ­¢æœ‰äººç»§æ‰¿åä¿®æ”¹å­—ç¬¦ä¸²çš„é€»è¾‘å¯¼è‡´å®‰å…¨æ¼æ´ã€‚
public final class ImmutableConfig {

    // 1. ä¿®é¥°å˜é‡ï¼šã€ä¸€æ¬¡èµ‹å€¼ï¼Œç»ˆèº«ä¸å˜ã€‘
    // å«ä¹‰ï¼šå˜é‡ä¸€æ—¦åˆå§‹åŒ–ï¼Œå°±ä¸èƒ½å†æŒ‡å‘å…¶ä»–æ•°æ®ã€‚
    final int MAX_USERS = 1000; 

    // 2. ä¿®é¥°æ–¹æ³•ï¼šã€ç¦æ­¢ç¯¡æ”¹ã€‘
    // å«ä¹‰ï¼šå­ç±»ç»§æ‰¿è¿™ä¸ªç±»çš„åŒæ—¶ç»§æ‰¿è¿™ä¸ªæ–¹æ³•ï¼Œä½†ä¸èƒ½é‡å†™ï¼ˆOverrideï¼‰è¿™ä¸ªæ–¹æ³•ã€‚
    public final void checkSecurity() {
        System.out.println("æ‰§è¡Œæ ¸å¿ƒå®‰å…¨æ£€æŸ¥...");
    }
}

```

> **æ³¨æ„ï¼š**
> 1. ä¸€èˆ¬æ¥è¯´ï¼Œå¦‚æœä¸€ä¸ªç±»å·²ç»æ˜¯ final ç±»äº†ï¼Œå°±æ²¡æœ‰å¿…è¦å†å°†æ–¹æ³•ä¿®é¥°æˆ final æ–¹æ³•äº†
> 2. final ä¸èƒ½ä¿®é¥°æ„é€ æ–¹æ³•
> 3. åŒ…è£…ç±»ï¼ˆInteger, Double, Float, Booleanç­‰éƒ½æ˜¯ finalï¼‰ï¼Œ String ä¹Ÿæ˜¯ final ç±»

---

### ğŸ”— 1.2 å…³è”æ¦‚å¿µ *ğŸ’¡ æ ¸å¿ƒå¿…å­¦*

**ç›®æ ‡**ï¼šç†è§£ä½¿ç”¨ `final` æ—¶å¿…é¡»çŸ¥é“çš„è¿å¸¦æ¦‚å¿µã€‚

#### 1. å¼•ç”¨ä¸å¯å˜ vs å†…å®¹ä¸å¯å˜ï¼ˆå…³é”®éš¾ç‚¹ï¼‰

è¿™æ˜¯åˆå­¦è€…æœ€å®¹æ˜“æ··æ·†çš„æ¦‚å¿µã€‚`final` é”ä½çš„æ˜¯**å˜é‡å¼•ç”¨çš„åœ°å€**ï¼Œè€Œä¸æ˜¯**å¯¹è±¡å†…éƒ¨çš„æ•°æ®**ã€‚

```java
public class FinalReferenceDemo {
    public static void main(String[] args) {
        // final ä¿®é¥°å¼•ç”¨ç±»å‹
        final StringBuilder sb = new StringBuilder("Java");
        
        // âŒ é”™è¯¯ï¼šä¸èƒ½æ”¹å˜å¼•ç”¨æŒ‡å‘ï¼ˆç¼–è¯‘å™¨æŠ¥é”™ï¼‰
        // sb = new StringBuilder("Python"); 
        
        // âœ… æ­£ç¡®ï¼šå¯ä»¥ä¿®æ”¹å¯¹è±¡å†…éƒ¨çš„æ•°æ®
        // å°±åƒä½ ç»“å©šäº†ï¼ˆfinalï¼‰ï¼Œé…å¶è¿™ä¸ªäººä¸èƒ½å˜ï¼ˆå¼•ç”¨ï¼‰ï¼Œ
        // ä½†æ˜¯é…å¶çš„å‘å‹ã€è¡£æœï¼ˆå†…éƒ¨çŠ¶æ€ï¼‰æ˜¯å¯ä»¥å˜çš„ã€‚
        sb.append(" 17"); 
        System.out.println(sb); // è¾“å‡ºï¼šJava 17
    }
}

```

#### 2. ç©ºç™½ Final (Blank Final)

ç¼–è¯‘å™¨å…è®¸ä½ å£°æ˜ `final` å˜é‡æ—¶ä¸ç«‹å³èµ‹å€¼ï¼Œä½†**å¿…é¡»**ä¿è¯åœ¨æ„é€ å™¨ç»“æŸå‰å®Œæˆèµ‹å€¼ã€‚

* ä¿®é¥°éé™æ€å±æ€§æ—¶ï¼šå¯ä»¥åœ¨å®šä¹‰æ—¶ã€æ„é€ å™¨ã€ä»£ç å—ä¸­èµ‹å€¼
* ä¿®é¥°é™æ€å±æ€§ï¼šå¯ä»¥åœ¨å®šä¹‰æ—¶ã€é™æ€ä»£ç å—ä¸­èµ‹å€¼

```java
public class User {
    final int id; // å£°æ˜æ—¶æœªèµ‹å€¼ï¼ˆç©ºç™½ finalï¼‰

    public User(int id) {
        // ç¼–è¯‘å™¨å¼ºåˆ¶æ£€æŸ¥ï¼šè¿™é‡Œåœ¨æ„é€ å™¨ä¸­åˆå§‹åŒ–
        this.id = id; 
    }
}

```

#### 3. ç¼–è¯‘æœŸå¸¸é‡ (Compile-time Constant)

å¦‚æœ `final` å˜é‡åœ¨å£°æ˜æ—¶å°±èµ‹å€¼äº†å…·ä½“çš„å­—é¢é‡ï¼ˆå¦‚æ•°å­—ã€å­—ç¬¦ä¸²ï¼‰ï¼Œç¼–è¯‘å™¨ä¼šæŠŠå®ƒå½“ä½œå¸¸é‡å¤„ç†ï¼Œç›´æ¥æ›¿æ¢åˆ°ä»£ç ä¸­ï¼ˆä¼˜åŒ–ï¼‰ã€‚

```java
final int A = 10;
final int B = 20;
// ç¼–è¯‘åï¼Œè¿™è¡Œä»£ç ä¼šç›´æ¥å˜æˆ int C = 30; 
// è¿è¡Œæ—¶ä¸éœ€è¦è®¡ç®— A + B
int C = A + B; 

```

---

### ğŸš€ 1.3 å¿«é€Ÿä¸Šæ‰‹ *ğŸ’¡ æ ¸å¿ƒå¿…å­¦*

**ç›®æ ‡**ï¼šç¼–å†™ä¸€ä¸ªç®€å•çš„åœ†é¢ç§¯è®¡ç®—å™¨ï¼Œä½“éªŒ `final` å¸¦æ¥çš„ç¡®å®šæ€§ã€‚

```java
public class CircleCalculator {
    // ä½¿ç”¨ final å®šä¹‰æ•°å­¦å¸¸é‡ï¼Œä¿è¯è®¡ç®—æ ‡å‡†ç»Ÿä¸€
    // static final æ˜¯å¸¸é‡çš„æ ‡å‡†å†™æ³•ï¼ˆå°†åœ¨2.2èŠ‚è¯¦ç»†è®²è§£ï¼‰
    static final double PI = 3.1415926;

    public static void main(String[] args) {
        double radius = 5.0;
        
        // è®¡ç®—é€»è¾‘
        double area = PI * radius * radius;
        
        System.out.println("åœ†çš„åŠå¾„: " + radius);
        System.out.println("åœ†çš„é¢ç§¯: " + area);
        
        // å°è¯•ä¿®æ”¹ PI (å–æ¶ˆæ³¨é‡Šä¼šæŠ¥é”™)
        // PI = 3.14; // âŒ ç¼–è¯‘é”™è¯¯ï¼šæ— æ³•ä¸ºæœ€ç»ˆå˜é‡ PI åˆ†é…å€¼
    }
}

```

---

### ğŸ’¡ 1.4 å®ƒè§£å†³äº†ä»€ä¹ˆé—®é¢˜ *ğŸ’¡ æ ¸å¿ƒå¿…å­¦*

**ç›®æ ‡**ï¼šç†è§£ä¸ºä»€ä¹ˆ Java è®¾è®¡è€…è¦å¼•å…¥è¿™ä¸ªå…³é”®å­—ã€‚

**1. å®‰å…¨æ€§ (Security)**
å¦‚æœæ²¡æœ‰ `final`ï¼Œé»‘å®¢å¯ä»¥ç»§æ‰¿ `String` ç±»ï¼Œé‡å†™ `equals()` æˆ– `hashCode()` æ–¹æ³•ï¼Œæ¬ºéª—å®‰å…¨æ£€æŸ¥ç³»ç»Ÿã€‚Java å°† `String` è®¾ä¸º `final`ï¼Œå½»åº•æœç»äº†è¿™ç§æ”»å‡»å‘é‡ã€‚

**2. çº¿ç¨‹å®‰å…¨ (Thread Safety)**
åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­ï¼Œå…±äº«å˜é‡çš„ä¿®æ”¹æ˜¯ä¸‡æ¶ä¹‹æºã€‚`final` å˜é‡å¤©ç„¶å…·å¤‡éƒ¨åˆ†çº¿ç¨‹å®‰å…¨æ€§ï¼ˆåˆå§‹åŒ–åä¸å¯å˜ï¼‰ï¼Œå¤§å¤§é™ä½äº†å¹¶å‘ç¼–ç¨‹çš„å¤æ‚åº¦ã€‚

**è®¾è®¡æ”¶ç›Šå¯¹æ¯”**ï¼š

```
+----------------+--------------------------+---------------------------+
| ç»´åº¦           | æ²¡æœ‰ final               | ä½¿ç”¨ final                |
+----------------+--------------------------+---------------------------+
| ä»£ç æ„å›¾       | æ¨¡ç³Šï¼ˆè¿™å€¼ä»¥åä¼šå˜å—ï¼Ÿï¼‰ | æ¸…æ™°ï¼ˆè¿™æ˜¯ä¸€ä¸ªå¸¸é‡/é…ç½®ï¼‰ |
| ç»´æŠ¤æˆæœ¬       | é«˜ï¼ˆéœ€è¿½è¸ªæ‰€æœ‰ä¿®æ”¹ç‚¹ï¼‰   | ä½ï¼ˆåªæœ‰ä¸€å¤„èµ‹å€¼ï¼‰        |
| å¤šçº¿ç¨‹é£é™©     | é«˜ï¼ˆéœ€åŒæ­¥é”ä¿æŠ¤ï¼‰       | ä½ï¼ˆè¯»æ“ä½œæ— éœ€åŠ é”ï¼‰      |
+----------------+--------------------------+---------------------------+

```

---

### âš™ï¸ 1.5 åº•å±‚åŸç† *â­ è¿›é˜¶é€‰å­¦*

**ç›®æ ‡**ï¼šç†è§£ `final` åœ¨å†…å­˜å±‚é¢çš„"é”å®š"æœºåˆ¶ã€‚

**å†…å­˜å¸ƒå±€ç¤ºæ„å›¾**ï¼š

```
Thread Stack (æ ˆ)            Heap Memory (å †)
+-------------------+       +---------------------------+
| final StringBuilder sb |----->| 0x1A2B (StringBuilder)    |
| (å¼•ç”¨è¢«é”å®š ğŸ”’)      |       |---------------------------|
| å€¼: 0x1A2B        |       | char[] value: ['J','a','v','a'] |
+-------------------+       | count: 4                  |
                            +---------------------------+
                                      ^
                                      |
         è™½ç„¶ sb çš„ç®­å¤´ä¸èƒ½ç§»å¼€ï¼ˆä¸èƒ½æŒ‡å‘åˆ«çš„å¯¹è±¡ï¼‰ï¼Œ
         ä½†å¯¹è±¡å†…éƒ¨çš„ value æ•°ç»„å†…å®¹æ˜¯å¯ä»¥è¢«ä¿®æ”¹çš„ï¼

```

**å¯è§æ€§ä¿éšœ (Java å†…å­˜æ¨¡å‹ JMM)**ï¼š      
å¯¹äº `final` åŸŸï¼Œç¼–è¯‘å™¨å’Œå¤„ç†å™¨éµå®ˆä¸€æ¡é‡æ’åºè§„åˆ™ï¼šåœ¨æ„é€ å‡½æ•°å†…å¯¹ä¸€ä¸ª `final` åŸŸçš„å†™å…¥ï¼Œä»¥åŠéšåæŠŠè¿™ä¸ªè¢«æ„é€ å¯¹è±¡çš„å¼•ç”¨èµ‹å€¼ç»™ä¸€ä¸ªå¼•ç”¨å˜é‡ï¼Œè¿™ä¸¤ä¸ªæ“ä½œä¹‹é—´ä¸èƒ½é‡æ’åºã€‚     
**ç®€å•è¯´**ï¼šåªè¦å¯¹è±¡æ„é€ å®Œæˆï¼Œå…¶ä»–çº¿ç¨‹çœ‹åˆ°çš„ `final` å˜é‡ä¸€å®šæ˜¯åˆå§‹åŒ–å¥½çš„æ­£ç¡®å€¼ï¼ˆä¸ä¼šçœ‹åˆ°åŠæˆå“çš„ `null` æˆ– `0`ï¼‰ã€‚

---

## ç¬¬2éƒ¨åˆ†ï¼šå·¥ç¨‹å®è·µï¼ˆHow to Do Rightï¼‰

### ğŸ” å‰ç½®çŸ¥è¯†æ£€æŸ¥

åœ¨æ·±å…¥å®æˆ˜å‰ï¼Œæˆ‘ä»¬éœ€è¦ç¡®è®¤ä½ å·²ç»ç†è§£ä»¥ä¸‹æ¦‚å¿µï¼š

1. **å¼•ç”¨ä¸å¯å˜**ï¼š`final` åªèƒ½ä¿è¯ç®­å¤´æŒ‡å‘ä¸å˜ï¼Œç®¡ä¸ä½å¯¹è±¡å†…éƒ¨æ•°æ®ï¼ˆè§ 1.2 èŠ‚ï¼‰ã€‚
2. **static å…³é”®å­—**ï¼šè¡¨ç¤º"å±äºç±»è€Œä¸æ˜¯å±äºå¯¹è±¡"ï¼ˆå…¨å±€å”¯ä¸€ï¼‰ã€‚`static final` å¸¸é…åˆä½¿ç”¨ä½œä¸º"å…¨å±€å¸¸é‡"ã€‚
3. **List é›†åˆ**ï¼šJava ä¸­å¸¸ç”¨çš„åˆ—è¡¨å®¹å™¨ï¼ˆå¦‚ `ArrayList`ï¼‰ï¼Œå°†åœ¨æœ¬èŠ‚ç”¨æ¥æ›¿ä»£æ•°ç»„ã€‚

---

### ğŸŒ 2.1 çœŸå®åœºæ™¯ï¼šæ”¯ä»˜çŠ¶æ€ç®¡ç† *ğŸ’¡ æ ¸å¿ƒå¿…å­¦*

**ç›®æ ‡**ï¼šåœ¨æ”¯ä»˜ç³»ç»Ÿä¸­ï¼Œé˜²æ­¢æ ¸å¿ƒä¸šåŠ¡çŠ¶æ€è¢«æ„å¤–ä¿®æ”¹ã€‚

**ä¸šåŠ¡åœºæ™¯**ï¼š
æˆ‘ä»¬éœ€è¦å®šä¹‰æ”¯ä»˜è®¢å•çš„çŠ¶æ€ï¼ˆå¾…æ”¯ä»˜ã€å·²æ”¯ä»˜ã€å¤±è´¥ï¼‰ã€‚å¦‚æœä¸ä½¿ç”¨ `final`ï¼Œæ–°æ‰‹å®¹æ˜“çŠ¯"é­”æ³•å€¼"ï¼ˆMagic Numberï¼‰é”™è¯¯ï¼Œæˆ–è€…çŠ¶æ€è¢«æ„å¤–ä¿®æ”¹ã€‚

**âŒ ç³Ÿç³•çš„å®ç°ï¼ˆFoo/Bar å¼å†™æ³•ï¼‰**ï¼š

```java
public class OrderService {
    public void processPayment(int status) {
        // 0 ä»£è¡¨ä»€ä¹ˆï¼Ÿ1 ä»£è¡¨ä»€ä¹ˆï¼Ÿæ²¡äººçŸ¥é“ï¼Œè¿™å«"é­”æ³•å€¼"
        // è€Œä¸” status å˜é‡åœ¨æ–¹æ³•å†…å¯èƒ½ä¼šè¢«ä¸å°å¿ƒä¿®æ”¹
        if (status == 1) { 
            status = 2; // ğŸ˜± å±é™©ï¼å‚æ•°è¢«ä¿®æ”¹äº†ï¼Œåç»­é€»è¾‘å¯èƒ½å‡ºé”™
            // ...å¤„ç†é€»è¾‘
        }
    }
}

```

**âœ… ä¸“ä¸šçš„å®ç°ï¼ˆå·¥ç¨‹åŒ–æ€ç»´ï¼‰**ï¼š

```java
public class OrderConstants {
    // ä½¿ç”¨ static final å®šä¹‰å…¨å±€å¸¸é‡
    // å‘½åè§„èŒƒï¼šå…¨å¤§å†™ + ä¸‹åˆ’çº¿
    public static final int ORDER_WAIT_PAY = 0;
    public static final int ORDER_PAID = 1;
    public static final int ORDER_FAILED = 2;
}

public class OrderService {
    // å‚æ•°ä½¿ç”¨ finalï¼Œé˜²æ­¢åœ¨æ–¹æ³•å†…éƒ¨è¢«æ„å¤–é‡æ–°èµ‹å€¼
    public void processPayment(final int orderStatus) {
        
        // å¯è¯»æ€§æå¤§æå‡
        if (orderStatus == OrderConstants.ORDER_PAID) {
            System.out.println("è®¢å•å·²æ”¯ä»˜ï¼Œå¼€å§‹å‘è´§...");
        }
        
        // orderStatus = 99; // âŒ ç¼–è¯‘æŠ¥é”™ï¼ç¼–è¯‘å™¨å¸®ä½ æ‹¦æˆªäº†æ½œåœ¨Bug
    }
}

```

**æ•°æ®æµè½¬å›¾**ï¼š

```
ä¸šåŠ¡ä»£ç 
   |
   v
[è¯»å– OrderConstants.ORDER_PAID] <--- (å®‰å…¨ï¼šstatic final ä¿è¯å€¼ä¸ä¼šå˜)
   |
   v
[ä¼ å…¥ processPayment(final status)]
   |
   +--- å°è¯•ä¿®æ”¹ status? ---> âŒ ç¼–è¯‘å™¨æ‹¦æˆª (final ä¿æŠ¤)
   |
   v
[æ‰§è¡Œä¸šåŠ¡é€»è¾‘]

```

---

### âœ… 2.2 å·¥ç¨‹è§„èŒƒ *ğŸ”¥ å®æˆ˜å¿…å¤‡*

åŸºäº Java 17+ çš„ä¸šç•Œæ ‡å‡†ï¼š

#### ğŸ”´ REDï¼ˆå¼ºåˆ¶è§„èŒƒï¼‰ï¼šä¸¥ç¦ `public static final` ä¿®é¥°æ•°ç»„

è¿™æ˜¯ 90% çš„åˆçº§å·¥ç¨‹å¸ˆéƒ½ä¼šçŠ¯çš„å®‰å…¨é”™è¯¯ã€‚

**é”™è¯¯ä»£ç **ï¼š

```java
public class SecurityConfig {
    // âŒ è‡´å‘½é”™è¯¯ï¼šfinal åªæ˜¯é”ä½äº†æ•°ç»„å¼•ç”¨ï¼Œæ²¡é”ä½æ•°ç»„å†…å®¹ï¼
    // ä»»ä½•äººéƒ½èƒ½ä¿®æ”¹ ROLES[0] çš„å€¼
    public static final String[] ROLES = { "ADMIN", "USER" };
}

// é»‘å®¢ä»£ç 
SecurityConfig.ROLES[0] = "HACKER"; // âœ… ç¼–è¯‘å™¨å…è®¸ï¼Œå®‰å…¨é˜²çº¿å´©æºƒ

```

**ğŸŸ¢ GREENï¼ˆæ¨èåšæ³•ï¼‰ï¼šä½¿ç”¨ä¸å¯å˜åˆ—è¡¨**

**ä¿®å¤ä»£ç **ï¼š

```java
import java.util.List;

public class SecurityConfig {
    // âœ… æ­£ç¡®åšæ³•ï¼š
    // 1. ä½¿ç”¨ private éšè—åŸå§‹æ•°ç»„/åˆ—è¡¨
    // 2. æš´éœ²ä¸€ä¸ª"ä¸å¯å˜"çš„è§†å›¾
    // List.of() æ˜¯ Java 9+ å¼•å…¥çš„ï¼Œåˆ›å»ºçš„æ˜¯çœŸæ­£çš„ä¸å¯å˜åˆ—è¡¨
    public static final List<String> ROLES = List.of("ADMIN", "USER");
}

// é»‘å®¢å°è¯•
// SecurityConfig.ROLES.set(0, "HACKER"); // âŒ è¿è¡Œæ—¶æŠ›å‡º UnsupportedOperationException

```

#### ğŸŸ¢ GREENï¼ˆæ¨èé£æ ¼ï¼‰ï¼šå‚æ•°å°½é‡ final

è™½ç„¶ä¸æ˜¯å¼ºåˆ¶ï¼Œä½†åœ¨é•¿çš„æ–¹æ³•ä¸­ï¼Œç»™å‚æ•°åŠ ä¸Š `final` å¯ä»¥æ˜ç¡®å‘Šè¯‰ç»´æŠ¤è€…ï¼š"è¿™ä¸ªå‚æ•°åœ¨æ•´ä¸ªæ–¹æ³•é‡Œéƒ½æ˜¯è¿™ä¸ªå€¼ï¼Œæ”¾å¿ƒè¯»ã€‚"

```java
// æ¨èï¼šæ˜ç¡®æ„å›¾
public void updateUser(final User user, final String newName) { ... }

```

---

### ğŸ”„ 2.3 ç‰ˆæœ¬æ¼”è¿›ï¼šä» DTO åˆ° Record *ğŸ’¡ æ ¸å¿ƒå¿…å­¦*

**ç›®æ ‡**ï¼šçœ‹ç°ä»£ Java å¦‚ä½•ä¼˜é›…åœ°å®ç°"ä¸å¯å˜æ•°æ®å¯¹è±¡"ã€‚

åœ¨ç³»ç»Ÿé—´ä¼ è¾“æ•°æ®ï¼ˆå¦‚æ•°æ®åº“ -> åç«¯ -> å‰ç«¯ï¼‰æ—¶ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ç§"åªå­˜æ•°æ®ï¼Œä¸å¯ä¿®æ”¹"çš„ç±»ï¼Œç§°ä¸º DTOï¼ˆData Transfer Objectï¼‰ã€‚

#### â³ ä¼ ç»Ÿå†™æ³•ï¼ˆJava 8 åŠä¹‹å‰ï¼‰

ä¸ºäº†å®ç°ä¸€ä¸ªä¸å¯å˜çš„ `Point` ç±»ï¼Œä½ éœ€è¦å†™ 50 è¡Œæ ·æ¿ä»£ç ã€‚

```java
public final class Point { // 1. ç±» finalï¼Œé˜²ç»§æ‰¿
    private final int x;   // 2. å˜é‡ finalï¼Œé˜²ä¿®æ”¹
    private final int y;

    public Point(int x, int y) {
        this.x = x;
        this.y = y;
    }

    // 3. åªæœ‰ Getterï¼Œæ²¡æœ‰ Setter
    public int getX() { return x; }
    public int getY() { return y; }

    // 4. è¿˜è¦æ‰‹åŠ¨é‡å†™ equals, hashCode, toString... (æ­¤å¤„çœç•¥30è¡Œ)
}

```

#### ğŸš€ ç°ä»£å†™æ³•ï¼ˆJava 17+ï¼‰ï¼šRecord ç±»å‹

Java 14 å¼•å…¥ï¼ˆ16è½¬æ­£ï¼‰çš„ `record` å…³é”®å­—ï¼Œä¸“é—¨ç”¨äºåˆ›å»º**ä¸å¯å˜æ•°æ®è½½ä½“**ã€‚å®ƒèƒŒåè‡ªåŠ¨ç”Ÿæˆäº† `final` å­—æ®µã€æ„é€ å™¨ã€Getterã€equals ç­‰æ‰€æœ‰ä»£ç ã€‚

```java
// âœ… ä¸€è¡Œä»£ç é¡¶æ›¿ä¸Šé¢ 50 è¡Œ
// è¯´æ˜ï¼šrecord é»˜è®¤å°±æ˜¯ final ç±»ï¼Œå‚æ•° x, y é»˜è®¤æ˜¯ private final å­—æ®µ
public record Point(int x, int y) {
    
    // ç´§å‡‘æ„é€ å™¨ï¼ˆCompact Constructorï¼‰
    // è¯´æ˜ï¼šè¿™æ˜¯ Record ä¸“æœ‰è¯­æ³•ï¼Œç”¨äºå‚æ•°æ ¡éªŒ
    // ç‰¹ç‚¹ï¼šä¸éœ€è¦å†™ this.x = xï¼Œç¼–è¯‘å™¨ä¼šè‡ªåŠ¨åœ¨æœ€åæ’å…¥èµ‹å€¼è¯­å¥
    public Point {
        if (x < 0 || y < 0) {
            throw new IllegalArgumentException("åæ ‡ä¸èƒ½ä¸ºè´Ÿ");
        }
    }
}

```

**æ¼”è¿›å¯¹æ¯”è¡¨**ï¼š

| å¯¹æ¯”ç»´åº¦ | ä¼ ç»Ÿ Class (Java 8) | Record (Java 17+) |
| --- | --- | --- |
| **ä»£ç è¡Œæ•°** | >50 è¡Œ | 1-10 è¡Œ |
| **ä¸å¯å˜æ€§** | éœ€æ‰‹åŠ¨åŠ  `final` | å¤©ç”Ÿä¸å¯å˜ |
| **å¯è¯»æ€§** | å……æ»¡æ ·æ¿ä»£ç  | ä»…åŒ…å«æ ¸å¿ƒé€»è¾‘ |
| **åº”ç”¨åœºæ™¯** | æ‰€æœ‰åœºæ™¯ | æ•°æ®ä¼ è¾“å¯¹è±¡ (DTO/VO) |

---

## ç¬¬3éƒ¨åˆ†ï¼šé¿å‘è¿›é˜¶ï¼ˆWhat to Avoid & Beyondï¼‰

### ğŸ” å‰ç½®çŸ¥è¯†æ£€æŸ¥

**åœ¨é˜¶æ®µ3å¼€å§‹å‰ï¼Œå¿…é¡»æ‰§è¡Œä»¥ä¸‹æ£€æŸ¥**ï¼š

1. **å¼•ç”¨ä¸å¯å˜**ï¼ˆå·²åœ¨ 1.2 èŠ‚å­¦è¿‡ï¼‰ï¼š`final` åªé”å¼•ç”¨åœ°å€ï¼Œä¸é”å†…éƒ¨æ•°æ®ã€‚
2. **Date/List**ï¼šJava ä¸­çš„æ—¥æœŸå’Œé›†åˆç±»ï¼ˆéƒ¨åˆ†æ˜¯å¯å˜çš„ï¼Œéƒ¨åˆ†æ˜¯ä¸å¯å˜çš„ï¼‰ã€‚

---

### âš ï¸ 3.1 å¸¸è§é™·é˜±åˆé›† *ğŸ”¥ å®æˆ˜å¿…å¤‡*

è¿™é‡Œé›†ä¸­äº† 99% çš„å¼€å‘è€…åœ¨èŒä¸šç”Ÿæ¶¯æ—©æœŸéƒ½ä¼šè¸©çš„é›·ã€‚

#### é™·é˜± 1ï¼š"å‡ä¸å¯å˜"å¯¹è±¡ï¼ˆThe Fake Immutable Trapï¼‰

**æŠ¥é”™ç‰¹å¾**ï¼š

* **æ— æŠ¥é”™**ï¼ˆæœ€å¯æ€•çš„åœ°æ–¹ï¼‰ï¼šä»£ç ç¼–è¯‘é€šè¿‡ï¼Œè¿è¡Œä¸å´©æºƒï¼Œä½†æ•°æ®è«åå…¶å¦™è¢«æ”¹äº†ã€‚
* äº§ç”Ÿä¸¥é‡çš„**æ•°æ®æ±¡æŸ“** Bugã€‚

**é”™è¯¯ä»£ç **ï¼š

```java
import java.util.Date;

public class Task {
    // âŒ é”™è¯¯ç¤ºèŒƒï¼šDate æ˜¯å¯å˜å¯¹è±¡ (Mutable)
    // å³ä½¿åŠ äº† finalï¼ŒDate å†…éƒ¨çš„æ—¶é—´æˆ³ä¾ç„¶èƒ½æ”¹
    private final Date createTime;

    public Task(Date createTime) {
        this.createTime = createTime; // ç›´æ¥å¼•ç”¨å¤–éƒ¨ä¼ å…¥çš„å¯¹è±¡
    }

    public Date getCreateTime() {
        return createTime; // ç›´æ¥æŠŠå†…éƒ¨å¯¹è±¡æš´éœ²å‡ºå»
    }
}

// æ”»å‡»æ¼”ç¤º
Date now = new Date();
Task task = new Task(now);
System.out.println(task.getCreateTime()); 

// ğŸ˜± å¤–éƒ¨ä¿®æ”¹äº† nowï¼ŒTask å†…éƒ¨çš„ createTime ä¹Ÿè·Ÿç€å˜äº†ï¼
// å› ä¸ºå®ƒä»¬æŒ‡å‘å †å†…å­˜ä¸­åŒä¸€ä¸ª Date å¯¹è±¡
now.setTime(0); 
System.out.println(task.getCreateTime()); // å˜æˆäº† 1970 å¹´ï¼

```

**ä¸ºä»€ä¹ˆåˆå­¦è€…å®¹æ˜“çŠ¯**ï¼šè¯¯ä»¥ä¸º `final` åŠ ä¸Šå»å°±ä¸‡äº‹å¤§å‰ï¼Œå¿½ç•¥äº†å¯¹è±¡æœ¬èº«çš„**å¯å˜æ€§**ã€‚

**ä¿®å¤æ–¹æ¡ˆ**ï¼š

```java
import java.time.Instant;

public class Task {
    // âœ… ä¿®å¤æ–¹æ¡ˆ 1ï¼ˆæ¨èï¼‰ï¼šä½¿ç”¨ Java 8+ çš„ç°ä»£æ—¶é—´ API
    // Instant æ˜¯ä¸å¯å˜ç±» (Immutable)ï¼Œç±»ä¼¼äº Stringï¼Œä¸€æ—¦åˆ›å»ºä¸å¯ä¿®æ”¹
    private final Instant createTime;

    public Task(Instant createTime) {
        this.createTime = createTime;
    }
}

// âœ… ä¿®å¤æ–¹æ¡ˆ 2ï¼ˆä¼ ç»Ÿé˜²å¾¡ï¼‰ï¼šé˜²å¾¡æ€§å¤åˆ¶ (Defensive Copy)
// å¦‚æœå¿…é¡»ç”¨ Dateï¼Œè¿›å‡ºéƒ½è¦æ‹·è´å‰¯æœ¬
/*
public Task(Date createTime) {
    this.createTime = new Date(createTime.getTime()); // å¤åˆ¶è¿›æ¥
}

public Date getCreateTime() {
    return new Date(createTime.getTime()); // å¤åˆ¶å‡ºå»
}
*/

```

---

#### é™·é˜± 2ï¼šLambda è¡¨è¾¾å¼ä¸­çš„å˜é‡é™åˆ¶

**æŠ¥é”™ç‰¹å¾**ï¼š

* ç¼–è¯‘å™¨é”™è¯¯ï¼š`Variable used in lambda expression should be final or effectively final`

**é”™è¯¯ä»£ç **ï¼š

```java
public void processOrders(List<String> orders) {
    int count = 0;
    
    // âŒ ç¼–è¯‘é”™è¯¯
    orders.forEach(order -> {
        System.out.println("å¤„ç†: " + order);
        count++; // è¯•å›¾ä¿®æ”¹å¤–éƒ¨å±€éƒ¨å˜é‡ -> æŠ¥é”™ï¼
    });
}

```

**ä»€ä¹ˆæƒ…å†µä¸‹ä¼šå‡ºé”™**ï¼šè¯•å›¾åœ¨ Lambda è¡¨è¾¾å¼ï¼ˆæˆ–åŒ¿åå†…éƒ¨ç±»ï¼‰ä¸­ä¿®æ”¹å¤–éƒ¨çš„å±€éƒ¨å˜é‡ã€‚

**åº•å±‚åŸç†**ï¼š
Lambda åªæ˜¯**æ•è·**äº†å˜é‡çš„å€¼ï¼ˆå‰¯æœ¬ï¼‰ã€‚å¦‚æœåœ¨ Lambda é‡Œæ”¹äº†å€¼ï¼Œå¤–éƒ¨çš„å˜é‡å¹¶ä¸ä¼šå˜ï¼Œè¿™ä¼šå¯¼è‡´æ•°æ®ä¸åŒæ­¥ã€‚ä¸ºäº†é˜²æ­¢è¿™ç§è¯¯è§£ï¼ŒJava å¼ºåˆ¶è¦æ±‚è¯¥å˜é‡å¿…é¡»æ˜¯ `final`ï¼ˆæˆ–äº‹å®ä¸Šçš„ finalï¼‰ã€‚

**ä¿®å¤æ–¹æ¡ˆ**ï¼š

```java
import java.util.concurrent.atomic.AtomicInteger;

public void processOrders(List<String> orders) {
    // âœ… æ–¹æ¡ˆï¼šä½¿ç”¨åŸå­ç±»å®¹å™¨ï¼ˆAtomicIntegerï¼‰
    // container æœ¬èº«å¼•ç”¨æ˜¯ final çš„ï¼Œä½†å†…éƒ¨ value å¯ä»¥å˜
    final AtomicInteger count = new AtomicInteger(0);
    
    orders.forEach(order -> {
        System.out.println("å¤„ç†: " + order);
        count.incrementAndGet(); // âœ… åˆæ³•ä¿®æ”¹å†…éƒ¨çŠ¶æ€
    });
}

```

---

### ğŸš€ 3.2 é«˜çº§æ¨¡å¼ï¼šçœŸæ­£çš„ä¸å¯å˜å¯¹è±¡ *â­ è¿›é˜¶é€‰å­¦*

**ç›®æ ‡**ï¼šä¸ä»…ä»…ä¾èµ– `final` å…³é”®å­—ï¼Œè€Œæ˜¯é€šè¿‡è®¾è®¡æ¨¡å¼æ„å»º**ç»å¯¹å®‰å…¨**çš„å¯¹è±¡ã€‚

**ä¸å¯å˜å¯¹è±¡ (Immutable Object) æ ‡å‡†**ï¼š

1. ç±»æ˜¯ `final` çš„ï¼ˆé˜²ç»§æ‰¿ï¼‰ã€‚
2. æ‰€æœ‰å­—æ®µæ˜¯ `private final` çš„ã€‚
3. **ä¸æä¾›ä»»ä½• Setter æ–¹æ³•**ã€‚
4. **æ„é€ å™¨å’Œ Getter è¿›è¡Œé˜²å¾¡æ€§å¤åˆ¶**ï¼ˆé’ˆå¯¹å¯å˜å­—æ®µï¼‰ã€‚

**ä»£ç ç¤ºä¾‹**ï¼š

```java
import java.util.ArrayList;
import java.util.List;

// 1. ç±» final
public final class ImmutableTeam {
    // 2. å­—æ®µ private final
    private final String teamName; // String æœ¬èº«ä¸å¯å˜ï¼Œå®‰å…¨
    private final List<String> members; // List æ˜¯å¯å˜çš„ï¼Œå±é™©ï¼

    public ImmutableTeam(String teamName, List<String> members) {
        this.teamName = teamName;
        // 4. é˜²å¾¡æ€§å¤åˆ¶ï¼šä¸ç›´æ¥ç”¨ä¼ å…¥çš„ Listï¼Œè€Œæ˜¯åˆ›å»ºä¸€ä¸ªæ–°çš„
        // List.copyOf (Java 10+) ç”Ÿæˆä¸€ä¸ªå½»åº•ä¸å¯å˜çš„åˆ—è¡¨å¿«ç…§
        this.members = List.copyOf(members);
    }

    public List<String> getMembers() {
        // è¿”å›çš„å·²ç»æ˜¯ä¸å¯å˜åˆ—è¡¨ï¼Œå¤–éƒ¨æ— æ³•é€šè¿‡ add/remove ä¿®æ”¹
        return members; 
    }
}

```

**è®¾è®¡æ”¶ç›Š**ï¼š

* **çº¿ç¨‹å®‰å…¨**ï¼šå¯ä»¥åœ¨å¤šçº¿ç¨‹é—´è‡ªç”±ä¼ é€’ï¼Œä¸éœ€è¦åŠ é”ã€‚
* **Hash å®‰å…¨**ï¼šéå¸¸é€‚åˆä½œä¸º `HashMap` çš„ Keyã€‚

---

### ğŸ“ 3.3 å®æˆ˜æŒ‘æˆ˜

**ç›®æ ‡**ï¼šç»¼åˆè¿ç”¨ `final`ã€ä¸å¯å˜é›†åˆå’Œé˜²å¾¡æ€§æ€ç»´ã€‚

**åœºæ™¯**ï¼š
ä½ æ­£åœ¨ç¼–å†™ä¸€ä¸ª**ç³»ç»Ÿå…¨å±€é…ç½®ç±»** `AppConfig`ã€‚è¿™ä¸ªé…ç½®ç±»åˆå§‹åŒ–åï¼Œç»å¯¹ä¸å…è®¸è¢«ä¿®æ”¹ï¼Œå¦åˆ™ä¼šå¯¼è‡´ç³»ç»Ÿå´©æºƒã€‚

**è¦æ±‚**ï¼š

1. è¯¥ç±»ä¸èƒ½è¢«ç»§æ‰¿ã€‚
2. é…ç½®é¡¹ `dbUrl` (String) å’Œ `timeout` (int) åˆå§‹åŒ–åä¸å¯å˜ã€‚
3. é…ç½®é¡¹ `allowedIps` (å­˜å‚¨å…è®¸è®¿é—®çš„ IP åˆ—è¡¨) å¿…é¡»å½»åº•å®‰å…¨ï¼Œå¤–éƒ¨ä»£ç æ‹¿åˆ°å**ä¸èƒ½å¢åŠ ä¹Ÿä¸èƒ½åˆ é™¤** IPã€‚

**è¯·ä¿®å¤ä»¥ä¸‹æ¼æ´ç™¾å‡ºçš„ä»£ç **ï¼š

```java
/**
 * âš ï¸ è¿™æ˜¯ä¸€ä¸ªæ»¡æ˜¯æ¼æ´çš„ä»£ç 
 * è¯·åŸºäºâ€œå·¥ç¨‹åŒ–æ€ç»´â€è¿›è¡Œé‡æ„
 */
public class AppConfig { // æ¼æ´1: ç±»å¯ä»¥è¢«ç»§æ‰¿
    public String dbUrl; // æ¼æ´2: å±…ç„¶æ˜¯ public ä¸”é final
    public int timeout;
    public List<String> allowedIps; // æ¼æ´3: é›†åˆå¯ä»¥è¢«ä¿®æ”¹

    public AppConfig(String dbUrl, int timeout, List<String> allowedIps) {
        this.dbUrl = dbUrl;
        this.timeout = timeout;
        this.allowedIps = allowedIps; // æ¼æ´4: ç›´æ¥å¼•ç”¨å¤–éƒ¨é›†åˆ
    }
}

```

---

ğŸ“ **è¯·æäº¤ä½ çš„ä¿®å¤ä»£ç **ã€‚

æˆ‘ä¼šåƒ Code Review ä¸€æ ·ï¼š

1. âœ… æŒ‡å‡ºä½ ç”¨å¯¹äº†å“ªäº› `final` ç‰¹æ€§ã€‚
2. âš ï¸ æŒ‡å‡ºæ˜¯å¦è¿˜æ®‹ç•™äº†"å‡ä¸å¯å˜"éšæ‚£ã€‚
3. ğŸŒŸ ç»™å‡º Java 17 æ ‡å‡†ä¸‹çš„æœ€ä¼˜è§£ï¼ˆå¯èƒ½ä¼šç”¨åˆ° Record å“¦ï¼‰ã€‚