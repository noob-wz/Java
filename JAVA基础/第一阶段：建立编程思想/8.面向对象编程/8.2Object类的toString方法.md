## ç¬¬1éƒ¨åˆ†ï¼šå»ºç«‹è®¤çŸ¥ï¼ˆWhat & Whyï¼‰

### ğŸ“¦ 1.1 æ ¸å¿ƒè¯­æ³• *ğŸ’¡ æ ¸å¿ƒå¿…å­¦*

**ç›®æ ‡**ï¼šç†è§£ `toString` çš„é»˜è®¤è¡¨ç°å’Œé‡å†™æ„ä¹‰ã€‚

**åŸºç¡€è¯­æ³•ç»“æ„**ï¼š
`toString` ä¹Ÿæ˜¯ `java.lang.Object` å®šä¹‰çš„æ–¹æ³•ã€‚

```java
// æ–¹æ³•ç­¾åï¼šè¿”å›ä¸€ä¸ª String å­—ç¬¦ä¸²
public String toString() {
    // getClass().getName()     è¿”å›ç±»çš„å…¨ç±»å(åŒ…å+ç±»å)
    // Integer.toHexString(hashCode())      å°†å¯¹è±¡çš„hashCodeå€¼è½¬æˆå­—ç¬¦ä¸²
    return getClass().getName() + "@" + Integer.toHexString(hashCode());
}

```

* **é»˜è®¤è¡Œä¸º**ï¼šå¦‚æœä½ ä¸é‡å†™å®ƒï¼Œå®ƒçš„è¾“å‡ºæ˜¯"ç±»å + @ + 16è¿›åˆ¶çš„å“ˆå¸Œç "ã€‚
  * æ ¼å¼ï¼š`getClass().getName() + "@" + Integer.toHexString(hashCode())`
  * æ•ˆæœï¼š`com.example.User@15db9742` ï¼ˆè¿™å¯¹äººç±»æ¥è¯´æ¯«æ— æ„ä¹‰ï¼‰
* **é‡å†™ç›®æ ‡**ï¼šè¿”å›å¯¹è±¡çš„**æ ¸å¿ƒçŠ¶æ€æ•°æ®**ï¼Œè®©äººä¸€çœ¼çœ‹æ‡‚å¯¹è±¡é‡Œå­˜äº†ä»€ä¹ˆï¼Œä¸€èˆ¬æ˜¯æˆå‘˜å˜é‡ã€‚

**ä»£ç å¯¹æ¯”**ï¼š

```java
public class User {
    private String name;
    private int age;

    public User(String name, int age) {
        this.name = name;
        this.age = age;
    }
    
    // âŒ æƒ…å†µAï¼šä¸é‡å†™ toString
    // è¾“å‡ºï¼šUser@6d06d69c
    
    // âœ… æƒ…å†µBï¼šé‡å†™ toString
    @Override
    public String toString() {
        return "User{name='" + name + "', age=" + age + "}";
    }
}

public class Main {
    public static void main(String[] args) {
        User user = new User("Alice", 25);
        
        // âš ï¸ æ³¨æ„ï¼šç›´æ¥è¾“å‡ºä¸€ä¸ªå¯¹è±¡æ—¶ï¼ŒtoString æ–¹æ³•é»˜è®¤ä¼šè¢«è°ƒç”¨
        System.out.println(user); 
        // ç­‰ä»·äº System.out.println(user.toString());
        // ç»“æœï¼šUser{name='Alice', age=25}
    }
}

```

---

### ğŸ’¡ 1.2 å®ƒè§£å†³äº†ä»€ä¹ˆé—®é¢˜ *ğŸ’¡ æ ¸å¿ƒå¿…å­¦*

**ç›®æ ‡**ï¼šç†è§£"å¯è¯»æ€§"åœ¨å·¥ç¨‹ä¸­çš„ä»·å€¼ã€‚

**åœºæ™¯**ï¼šå‡Œæ™¨ 3 ç‚¹ï¼Œç”Ÿäº§ç¯å¢ƒæŠ¥é”™ï¼Œä½ æ‰“å¼€æ—¥å¿—æ–‡ä»¶ã€‚

**æ²¡æœ‰ `toString` çš„æ—¥å¿—**ï¼š

```log
[ERROR] Order processing failed for object: com.app.Order@4f023edb

```

* **åæœ**ï¼šä½ ä¸çŸ¥é“æ˜¯å“ªä¸ªè®¢å•é”™äº†ï¼Œå“ªä¸ªç”¨æˆ·å—å½±å“ï¼Œé‡‘é¢æ˜¯å¤šå°‘ã€‚ä½ åªèƒ½å»çŒœï¼Œæˆ–è€…å»æ”¹ä»£ç åŠ æ—¥å¿—é‡æ–°å‘å¸ƒã€‚

**æœ‰ `toString` çš„æ—¥å¿—**ï¼š

```log
[ERROR] Order processing failed for object: Order{id='ORD-999', amount=100.0, status='PAYING'}

```

* **åæœ**ï¼šä½ ç«‹åˆ»çŸ¥é“æ˜¯è®¢å• ORD-999 å¡åœ¨äº†æ”¯ä»˜çŠ¶æ€ï¼Œé©¬ä¸Šå°±èƒ½å®šä½ä¿®å¤ã€‚

---

## ç¬¬2éƒ¨åˆ†ï¼šå·¥ç¨‹å®è·µï¼ˆHow to Do Rightï¼‰

### ğŸŒ 2.1 çœŸå®åœºæ™¯ï¼šæ•æ„Ÿæ•°æ®è„±æ• *ğŸ”¥ å®æˆ˜å¿…å¤‡*

**ç›®æ ‡**ï¼šé˜²æ­¢ `toString` æ³„éœ²ç”¨æˆ·éšç§ã€‚

**ä¸šåŠ¡åœºæ™¯**ï¼šç”¨æˆ·ç³»ç»Ÿã€‚å¦‚æœä¸åŠ å¤„ç†ï¼Œæ‰“å° `User` å¯¹è±¡ä¼šå°†å¯†ç ã€æ‰‹æœºå·ç›´æ¥æš´éœ²åœ¨æ—¥å¿—æ–‡ä»¶ä¸­ï¼Œè¿™æ˜¯ä¸¥é‡çš„å®‰å…¨äº‹æ•…ã€‚

**âŒ å±é™©ä»£ç **ï¼š

```java
@Override
public String toString() {
    // å±é™©ï¼ç›´æ¥æŠŠ password æ‰“å°å‡ºæ¥äº†
    return "User{id=" + id + ", password='" + password + "'}";
}

```

**âœ… å®‰å…¨ä»£ç **ï¼š

```java
@Override
public String toString() {
    // å¿…é¡»å¯¹æ•æ„Ÿå­—æ®µè¿›è¡Œ"è„±æ•"å¤„ç†
    return "User{" +
           "id=" + id +
           ", password='******'" + // éšè—
           ", phone='" + maskPhone(phone) + "'" + // è„±æ•å·¥å…·æ–¹æ³•
           '}';
}

private String maskPhone(String p) {
    if (p == null || p.length() < 11) return p;
    return p.substring(0, 3) + "****" + p.substring(7);
}

```

---

### ğŸ”„ 2.2 ç‰ˆæœ¬æ¼”è¿› *ğŸ’¡ æ ¸å¿ƒå¿…å­¦*

**ç›®æ ‡**ï¼šæœ€å¿«ã€æœ€ä¼˜é›…åœ°ç”Ÿæˆ `toString`ã€‚

**å¯¹æ¯”è¡¨æ ¼**ï¼š

| æ–¹æ¡ˆ | å†™æ³• (Java 8åŠä»¥å‰) | ç°ä»£å†™æ³• (Java 17+) | è¯„ä»· |
| --- | --- | --- | --- |
| **æ‰‹å†™æ‹¼æ¥** | `return "name=" + name;` | ä¸æ¨è | ç¹çï¼Œæ”¹å­—æ®µå®¹æ˜“æ¼æ”¹ |
| **StringBuilder** | `new StringBuilder()...` | ä¸æ¨è | ä»£ç å¤ªé•¿ï¼Œæ²¡å¿…è¦ |
| **IDEç”Ÿæˆ** | Alt+Insert è‡ªåŠ¨ç”Ÿæˆ | **æ¨è** | ç»å…¸ã€ç¨³å¥ã€å¯æ§ |
| **Lombok** | `@ToString` æ³¨è§£ | **æ¨è** | ä»£ç æœ€å°‘ï¼Œä½†åœ¨å›¢é˜Ÿä¸­éœ€ç»Ÿä¸€æ’ä»¶ |
| **Record** | æ—  | **ğŸ”¥ æåŠ›æ¨è** | ç¼–è¯‘å™¨è‡ªåŠ¨ç”Ÿæˆå®Œç¾çš„ toString |

**Java 17 Record æ¼”ç¤º**ï¼š

```java
// å®šä¹‰ Recordï¼Œè‡ªå¸¦ equals, hashCode, toString
public record Point(int x, int y) {}

public static void main(String[] args) {
    Point p = new Point(10, 20);
    System.out.println(p); 
    // è¾“å‡ºï¼šPoint[x=10, y=20]
    // æ ¼å¼æ ‡å‡†ï¼Œç”šè‡³åŒ…å«äº†ç±»åå’Œä¸­æ‹¬å·ï¼Œéå¸¸æ¸…æ™°
}

```

---

## ç¬¬3éƒ¨åˆ†ï¼šé¿å‘è¿›é˜¶ï¼ˆWhat to Avoidï¼‰

### âš ï¸ 3.1 è‡´å‘½é™·é˜±ï¼šå¾ªç¯å¼•ç”¨ï¼ˆStackOverflowErrorï¼‰

**è¿™æ˜¯ `toString` å¯¼è‡´ç¨‹åºå´©æºƒçš„å¤´å·åŸå› ã€‚**

**ğŸ“š åœºæ™¯**ï¼šåŒå‘å…³è”ï¼ˆUser æœ‰ Ordersï¼ŒOrder å±äº Userï¼‰ã€‚

**æ‰§è¡Œæµç¨‹**ï¼š

1. æ‰“å° User -> è°ƒç”¨ `User.toString()`
2. `User.toString()` æ‰“å° `orders` åˆ—è¡¨ -> è°ƒç”¨æ¯ä¸ª `Order.toString()`
3. `Order.toString()` æ‰“å° `user` å­—æ®µ -> è°ƒç”¨ `User.toString()`
4. **æ­»å¾ªç¯** -> æ ˆæº¢å‡ºï¼ˆStackOverflowErrorï¼‰

**å›¾è§£**ï¼š

```
User.toString()
    |
    +--> åŒ…å«: List<Order>
             |
             +--> order1.toString()
                      |
                      +--> åŒ…å«: user
                               |
                               +--> User.toString()  <-- ğŸ’¥ å›åˆ°èµ·ç‚¹

```

**âœ… ä¿®å¤æ–¹æ¡ˆ**ï¼š
åœ¨ä¸€æ–¹çš„ `toString` ä¸­ï¼Œä¸è¦åŒ…å«å¦ä¸€æ–¹ã€‚é€šå¸¸åœ¨"å¤š"çš„ä¸€æ–¹ï¼ˆOrderï¼‰æ‰“å° User æ—¶ï¼Œ**åªæ‰“å° UserID**ï¼Œè€Œä¸æ˜¯æ•´ä¸ª User å¯¹è±¡ã€‚

```java
public class Order {
    private String id;
    private User user;

    @Override
    public String toString() {
        // âœ… å®‰å…¨ï¼šåªæ‰“å° user.getId()ï¼Œä¸æ‰“å° user å¯¹è±¡æœ¬èº«
        return "Order{id='" + id + "', userId=" + (user != null ? user.getId() : "null") + "}";
    }
}

```

---

### ğŸ“ å®æˆ˜æŒ‘æˆ˜

**åœºæ™¯**ï¼šä½ æ­£åœ¨å¼€å‘ä¸€ä¸ª"é“¶è¡Œè´¦æˆ·"ç±»ã€‚

**è¦æ±‚**ï¼š

1. ç¼–å†™ `BankAccount` ç±»ï¼ŒåŒ…å« `accountNumber` (è´¦å·), `balance` (ä½™é¢), `pinCode` (æ”¯ä»˜å¯†ç )ã€‚
2. é‡å†™ `toString`ã€‚
3. **å®‰å…¨è¦æ±‚**ï¼šç»å¯¹ä¸èƒ½æ‰“å°å¯†ç ã€‚
4. **éšç§è¦æ±‚**ï¼šè´¦å·åªæ˜¾ç¤ºæœ€å 4 ä½ï¼ˆå¦‚ `******1234`ï¼‰ã€‚
5. **æ ¼å¼è¦æ±‚**ï¼šä½¿ç”¨ `StringBuilder` æˆ– `String.format` æˆ– `+` æ‹¼æ¥å‡å¯ï¼Œæ ¼å¼æ¸…æ™°ã€‚

**è¯·æäº¤ä½ çš„ä»£ç ï¼š**

```java
public class BankAccount {
    private String accountNumber;
    private double balance;
    private String pinCode;

    public BankAccount(String accountNumber, double balance, String pinCode) {
        this.accountNumber = accountNumber;
        this.balance = balance;
        this.pinCode = pinCode;
    }

    // è¯·åœ¨æ­¤å¤„å®Œæˆä»£ç ...
}

```