# 房屋出租系统 (House Renting System) - 架构设计文档

## 1. 项目概述

本项目是一个基于文本界面（Console）的房屋租赁管理软件。系统实现了对房源信息的标准化管理，核心功能包括房源的**新增 (Create)**、**查询 (Read)**、**修改 (Update)** 和 **删除 (Delete)**，即标准的 CRUD 操作。

项目采用分层架构设计，实现了界面交互、业务逻辑与数据模型的高度解耦。

---

## 2. 架构设计模式

本项目遵循 **MVC (Model-View-Controller)** 的分层思想，将系统划分为三个核心层次：

1. **视图层 (View)**：负责用户交互、界面展示。
2. **业务/服务层 (Service)**：负责业务逻辑处理、数据存储与管理。
3. **模型层 (Model)**：负责数据的定义与封装。
4. **工具层 (Utility)**：负责通用功能的封装（如输入校验）。

---

## 3. 模块详解与职责边界

### 3.1 模型层 (Model)

* **类名**：`com.houserent.model.House`
* **职责**：
  * 作为系统的**数据载体**（Data Carrier/Entity）。
  * 定义房屋的属性（编号 `id`、房主 `name`、电话 `phone`、地址 `address`、月租 `rent`、状态 `state`）。
  * 不包含任何业务逻辑，仅提供构造器、Getter/Setter 和 `toString` 方法。


### 3.2 视图层 (View)

* **类名**：`com.houserent.view.HouseView`
* **职责**：**“前台接待”**
* **显示**：负责打印菜单、提示语和操作结果（`System.out.println`）。
* **输入**：负责接收用户的键盘输入（调用 `Scanner` 或 `Utility`）。
* **交互**：将用户输入的数据封装成 `House` 对象，传递给 Service 层。


* **设计红线 (Don'ts)**：
  * **禁止**直接访问或操作数据数组。
  * **禁止**包含复杂的业务逻辑（如ID生成算法）。
  * **⚠️ 只负责数据的收集和打包**



### 3.3 业务层 (Service)

* **类名**：`com.houserent.service.HouseService`
* **职责**：**“后台管理”**
* **数据存储**：维护 `House[]` 数组，充当内存数据库。
* **逻辑处理**：实现增删改查的核心算法（如数组扩容、删除时的移位操作）。
* **状态管理**：维护 ID 自增长计数器、当前房屋数量等。

* **设计红线 (Don'ts)**：
  * **禁止**出现界面交互代码（如 `Scanner`）。
  * **禁止**直接打印日志到控制台（应通过 `return` 返回值告知 View 层结果）。
  * **⚠️ 只负责存储和管理数据**


### 3.4 工具层 (Utility)

* **类名**：`com.houserent.utils.Utility`
* **职责**：
  * 处理键盘输入的容错逻辑（如限制长度、处理非数字输入）。
  * 提供“回车跳过修改”等特定功能的底层支持。



---

## 4. 核心交互流程说明

本系统通过 **“持有引用”** 和 **“方法传参”** 的方式实现层级交互。

### 4.1 场景一：新增房源 (Add House)

这是一个典型的从 View 到 Service 的数据流向。

1. **用户** 在界面输入房源信息（姓名、电话等）。
2. **View 层** 接收输入，并 `new House(...)` 将数据打包成对象。
3. **View 层** 调用 `houseService.add(house)`，将对象作为参数传递。
4. **Service 层** 接收对象，生成唯一 ID，将其存入数组。
5. **Service 层** 返回 `boolean` 结果。
6. **View 层** 根据返回值打印“添加成功”或“失败”。

### 4.2 场景二：删除房源 (Delete House)

这是一个包含查询与修改的复合流程。

1. **View 层** 接收用户输入的 `id`。
2. **View 层** 调用 `houseService.find(id)` 确认房屋是否存在。
3. **View 层** 提示用户确认（Y/N）。
4. **View 层** 调用 `houseService.delete(id)` 下达删除指令。
5. **Service 层** 执行数组删除逻辑（元素前移），返回 `true`。

---

## 5. 代码关键设计逻辑问答 (Q&A)

### Q1: 为什么 View 层和 Service 层都有 `add` 方法？

* **View 层的 `addHouse()**`：属于**UI 逻辑**。它关注的是如何引导用户一步步输入数据，确保输入格式正确。
* **Service 层的 `add(House h)**`：属于**业务逻辑**。它关注的是数组有没有满、ID 如何生成、数据如何安全地放入内存。
* **结论**：这是**关注点分离 (Separation of Concerns)** 的体现。

**代码逻辑界定标准：** **谁持有资源，谁就负责操作该资源。**

| 动作 | 涉及的资源 | 谁拥有这个资源？ | 所以代码写在哪？ |
| --- | --- | --- | --- |
| **打印** "请输入姓名" | **控制台/屏幕** | `HouseView` | View 层 |
| **接收** 键盘输入 | **键盘/Scanner** | `HouseView` | View 层 |
| **打包** 数据成对象 | **Model 定义** | `HouseView` (虽然Model独立，但由View实例化) | View 层 |
| **生成** 唯一 ID | **ID计数器** | `HouseService` (这是业务规则) | Service 层 |
| **判断** 数组满不满 | **House[] 数组** | `HouseService` | Service 层 |
| **存入** 数组 | **House[] 数组** | `HouseService` | Service 层 |

### Q2: 为什么“退出”逻辑只写在 HouseView 中？

* 退出系统的本质是**停止界面的循环显示**。Service 层作为一个被动的“仓库管理员”，不关心系统是否正在运行，只关心数据是否被正确操作。因此，控制程序生命周期的 `loop` 变量属于视图层。
  * **特例**：如果你的退出逻辑包含 **“把数据保存到硬盘文件”**，那么 `HouseView` 的 `exit()` 方法里就需要调用 `houseService.saveData()`。但即便如此，控制循环结束的 `loop = false` 依然只属于 View。

### Q3: 什么时候 View 层需要调用 Service 层？

**交互时刻 = 控制权转移时刻**。 **“控制权转移”** 原则：

1. **存数据时**：View: “我要展示列表给用户看。” -> **交互** -> Service: “给你数据 (House[])。”
2. **取数据时**：View: “用户填好单子了，帮我存一下。” -> **交互** -> Service: “存好了 (return true)。”
3. **判数据时**：View: “用户要删 ID=5，你看看有没有？” -> **交互** -> Service: “查了一下，没有 (return null)。”

---

## 6. 数据流向图

```text
用户 (User) 
   ⬇️ (输入数据)
HouseView (界面) 
   ⬇️ (封装成 House 对象)
HouseService (业务) 
   ⬇️ (存入 House[] 数组)
内存 (Memory)

```